<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#991b1b">
    <title>Sistema Vida - Integrado vFinal</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Adicionando biblioteca QR Code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Lora:ital,wght@0,400;1,400&family=Dancing+Script:wght@600&family=Montserrat:wght@400;700&family=Bebas+Neue&family=Permanent+Marker&family=Press+Start+2P&family=Roboto:wght@400;700&family=Segoe+UI&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .font-serif { font-family: 'Merriweather', serif; }
        .font-handwriting { font-family: 'Dancing Script', cursive; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Estilos Gerais */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input, select, button { touch-action: manipulation; }

        /* Animação Rádio */
        @keyframes sound-bar {
            0% { height: 10%; }
            50% { height: 100%; }
            100% { height: 10%; }
        }
        .sound-bar {
            width: 6px;
            background-color: #FCD34D;
            border-radius: 99px;
            animation: sound-bar 0.8s infinite ease-in-out;
        }
        .sound-bar:nth-child(1) { animation-delay: 0.1s; }
        .sound-bar:nth-child(2) { animation-delay: 0.3s; }
        .sound-bar:nth-child(3) { animation-delay: 0.5s; }
        .sound-bar:nth-child(4) { animation-delay: 0.2s; }
        .sound-bar:nth-child(5) { animation-delay: 0.4s; }
        .sound-bar:nth-child(6) { animation-delay: 0.6s; }

        /* --- ESTILOS DOS JOGOS (ARCADE HUB) --- */
        .pixel-font { font-family: 'Press Start 2P', cursive; }
        .king::after { content: '♛'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; font-weight: bold; color: gold; text-shadow: 0 0 2px black, 0 0 2px black; }
        .current-player-ring { box-shadow: 0 0 10px #3b82f6; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .memory-card-container { perspective: 1000px; cursor: pointer; }
        .memory-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 0.5rem; }
        .memory-card-container.is-flipped .memory-card-inner { transform: rotateY(180deg); }
        .memory-front, .memory-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; }
        .memory-back { background-color: #3B82F6; color: white; font-size: 3rem; }
        .memory-front { background-color: #E5E7EB; color: #1F2937; font-size: 2.5rem; transform: rotateY(180deg); }
        .hangman-part { visibility: hidden; opacity: 0; stroke: #374151; stroke-width: 4; stroke-linecap: round; transition: opacity 0.5s ease-in-out, visibility 0.5s; }
        .letter-display { font-size: 2rem; font-weight: 700; width: 1.2em; height: 1.5em; display: inline-flex; align-items: center; justify-content: center; border-bottom: 4px solid #D1D5DB; margin: 0 0.1em; transition: all 0.3s ease; }
        .letter-display.revealed { border-bottom-color: #3B82F6; }
        .letter-display.new { transform: translateY(-10px) scale(1.1); color: #3B82F6; }
        .scanlines { background: repeating-linear-gradient(transparent 0px, transparent 2px, rgba(0, 0, 0, 0.3) 3px, rgba(0, 0, 0, 0.3) 4px); pointer-events: none; z-index: 10; }
        
        /* QUIZ Styles */
        .quiz-scope { --bg-gradient: radial-gradient(circle at center, #16213e, #1a1a2e); --card-bg: rgba(15, 52, 96, 0.7); --accent: #e94560; --highlight: #0f3460; --text-main: #ffffff; --correct: #00b894; --wrong: #d63031; --gold: #fdcb6e; --timer-ok: #00b894; --timer-warn: #fdcb6e; --timer-critical: #d63031; --p1: #0984e3; --p2: #a29bfe; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: var(--text-main); width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -2px); } 100% { transform: translate(1px, -2px); } }
        .shake-anim { animation: shake 0.5s; }
        .quiz-app-container { background: var(--card-bg); backdrop-filter: blur(15px); border-radius: 20px; padding: 2rem; width: 95%; max-width: 900px; box-shadow: 0 0 40px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1); position: relative; transition: transform 0.3s; }
        .quiz-screen { display: none; flex-direction: column; align-items: center; width: 100%; animation: fadeIn 0.5s ease-out; }
        .quiz-screen.active { display: flex; }
        .btn-back-quiz { align-self: flex-start; background: transparent; border: none; color: rgba(255,255,255,0.6); cursor: pointer; font-size: 1rem; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; transition: color 0.3s, transform 0.3s; padding: 0; font-weight: bold; }
        .btn-back-quiz:hover { color: var(--accent); transform: translateX(-3px); }
        .mode-selector { display: flex; gap: 15px; margin-bottom: 25px; justify-content: center; }
        .mode-btn { background: transparent; border: 2px solid var(--accent); color: var(--text-main); padding: 12px 25px; border-radius: 50px; cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: 0.3s; }
        .mode-btn.selected, .mode-btn:hover { background: var(--accent); box-shadow: 0 0 15px var(--accent); transform: scale(1.05); }
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; width: 100%; }
        .cat-card { background: var(--highlight); padding: 15px; border-radius: 15px; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; border: 1px solid rgba(255,255,255,0.05); min-height: 110px; }
        .cat-card:hover { transform: translateY(-5px); background: rgba(233, 69, 96, 0.3); border-color: var(--accent); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .cat-icon { font-size: 2.2rem; margin-bottom: 8px; }
        .cat-title { font-weight: bold; font-size: 1rem; }
        .hud { width: 100%; display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .player-score-box { text-align: center; padding: 8px 15px; border-radius: 12px; background: rgba(0,0,0,0.2); border: 2px solid transparent; opacity: 0.5; transition: 0.3s; min-width: 80px; }
        .player-score-box.active { opacity: 1; transform: scale(1.1); background: rgba(255,255,255,0.1); box-shadow: 0 0 15px currentColor; }
        .p1-style { border-color: var(--p1); color: var(--p1); } .p2-style { border-color: var(--p2); color: var(--p2); }
        .score-val { font-size: 1.4rem; font-weight: bold; display: block; }
        .combo-badge { font-size: 0.8rem; color: var(--gold); display: block; margin-top: 5px; opacity: 0; transition: opacity 0.3s; }
        .combo-badge.visible { opacity: 1; animation: pulse 1s infinite; }
        .timer-wrapper { width: 100%; margin-bottom: 20px; position: relative; }
        .timer-track { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .timer-fill { height: 100%; background: var(--timer-ok); width: 100%; transition: width 1s linear, background-color 0.3s; }
        .timer-val { position: absolute; top: -22px; right: 0; font-weight: bold; font-size: 0.9rem; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(214, 48, 49, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(214, 48, 49, 0); } 100% { box-shadow: 0 0 0 0 rgba(214, 48, 49, 0); } }
        .timer-critical { animation: pulse-red 1s infinite; }
        .question-box { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; margin-bottom: 20px; font-size: 1.3rem; text-align: center; min-height: 80px; display: flex; align-items: center; justify-content: center; border-left: 4px solid var(--accent); }
        .options-list { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .option-btn { background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border: 1px solid rgba(255,255,255,0.15); padding: 18px; border-radius: 12px; color: white; font-size: 1.05rem; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; text-align: left; padding-left: 50px; }
        .option-btn::before { content: attr(data-index); position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 25px; height: 25px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; color: var(--accent); }
        .option-btn:hover:not(:disabled) { background: rgba(255,255,255,0.2); transform: translateY(-2px); border-color: var(--accent); }
        .option-btn:disabled { opacity: 0.6; cursor: default; }
        .option-btn.correct { background: var(--correct); border-color: var(--correct); box-shadow: 0 0 20px rgba(0, 184, 148, 0.4); }
        .option-btn.wrong { background: var(--wrong); border-color: var(--wrong); }
        .option-btn.hidden { visibility: hidden; pointer-events: none; }
        .powerups-bar { margin-top: 20px; display: flex; gap: 15px; justify-content: center; }
        .power-btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .power-btn:hover:not(:disabled) { background: var(--gold); color: #000; box-shadow: 0 0 10px var(--gold); }
        .power-btn:disabled { border-color: #555; color: #555; cursor: not-allowed; text-decoration: line-through; }
        .score-board { width: 100%; background: rgba(0,0,0,0.2); border-radius: 15px; padding: 20px; margin: 20px 0; }
        .result-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 1.1rem; }
        .winner-text { font-size: 1.5rem; font-weight: bold; margin: 20px 0; text-transform: uppercase; letter-spacing: 2px; color: var(--gold); }
        .btn-restart { background: linear-gradient(to right, var(--accent), #c0392b); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4); flex: 1; }
        .btn-restart:hover { transform: scale(1.05); filter: brightness(1.2); }
        .btn-restart.secondary { background: transparent; border: 2px solid var(--gold); color: var(--gold); box-shadow: none; }
        .btn-restart.secondary:hover { background: var(--gold); color: #000; }
        
        /* Estúdio e Outros */
        .studio-root { --primary: #e11d48; --primary-light: #ffebf0; --bg-body: #f4f6f9; --bg-card: #ffffff; --text-main: #1e293b; --text-sec: #64748b; --border: #e2e8f0; --input-bg: #f8fafc; --shadow: 0 10px 40px -10px rgba(0,0,0,0.08); font-family: 'Poppins', sans-serif; color: var(--text-main); padding-bottom: 80px; }
        .studio-root[data-theme="dark"] { --primary: #fb7185; --primary-light: #2d1b20; --bg-body: #0f172a; --bg-card: #1e293b; --text-main: #f1f5f9; --text-sec: #94a3b8; --border: #334155; --input-bg: #334155; --shadow: 0 10px 40px -10px rgba(0,0,0,0.5); }
        #particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; overflow: hidden; }
        .particle { position: absolute; background: #e11d48; border-radius: 50%; opacity: 0.2; animation: floatUp linear infinite; }
        @keyframes floatUp { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 50% { opacity: 0.5; } 100% { transform: translateY(-10vh) scale(1); opacity: 0; } }
        .studio-header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
        .studio-root[data-theme="dark"] .studio-header { background: rgba(15, 23, 42, 0.8); }
        .studio-brand span:first-child { font-weight: 800; font-size: 1.1rem; color: var(--primary); display:block; line-height:1; }
        .studio-brand span:last-child { font-size: 0.65rem; color: var(--text-sec); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .streak-badge { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3); cursor: pointer; transition: transform 0.2s; }
        .streak-badge:active { transform: scale(0.95); }
        .studio-container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .tools-section { background: var(--bg-card); padding: 20px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: var(--shadow); position: relative; z-index: 1; }
        .section-title { font-size: 0.8rem; font-weight: 700; color: var(--text-sec); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .search-row { display: flex; gap: 10px; margin-bottom: 15px; position: relative; }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-sec); opacity: 0.5; }
        .search-input { flex: 1; padding: 14px 14px 14px 40px; border-radius: 16px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); outline: none; transition: 0.3s; }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }
        .btn-magic { background: linear-gradient(135deg, var(--primary), #db2777); color: white; border: none; width: 54px; border-radius: 16px; cursor: pointer; font-size: 1.2rem; box-shadow: 0 4px 15px rgba(225, 29, 72, 0.3); transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-magic:active { transform: scale(0.9); }
        .cat-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; mask-image: linear-gradient(to right, black 90%, transparent 100%); -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%); }
        .cat-chip { background: var(--input-bg); padding: 10px 18px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; color: var(--text-sec); white-space: nowrap; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; }
        .cat-chip:active { transform: scale(0.95); }
        .cat-chip.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(225, 29, 72, 0.2); }
        .emoji-bar { margin-bottom: 15px; }
        .btn-emoji-toggle { width: 100%; background: var(--input-bg); border: 1px solid var(--border); padding: 12px; border-radius: 14px; color: var(--text-sec); font-weight: 600; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-emoji-toggle:hover { background: var(--border); }
        .emoji-grid { display: none; grid-template-columns: repeat(8, 1fr); gap: 5px; background: var(--bg-card); padding: 10px; border-radius: 16px; border: 1px solid var(--border); margin-top: 10px; max-height: 180px; overflow-y: auto; }
        .emoji-grid.show { display: grid; }
        .emoji-item { font-size: 1.5rem; cursor: pointer; padding: 6px; text-align: center; border-radius: 8px; transition: 0.2s; }
        .emoji-item:hover { background: var(--input-bg); transform: scale(1.2); }
        .form-group { margin-bottom: 20px; }
        .studio-label { display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; font-weight: 700; margin-bottom: 8px; color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.5px; }
        .track-input { width: 100%; padding: 16px; border-radius: 18px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-size: 1rem; outline: none; transition: 0.3s; font-family: inherit; }
        .track-input:focus { border-color: var(--primary); background: var(--bg-card); }
        .top-nav-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .btn-back { background: none; border: none; color: var(--text-sec); font-weight: 600; display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 0; }
        .btn-inspire { background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transition: 0.2s; }
        .btn-inspire:active { transform: scale(0.95); }
        .slider-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 15px; box-shadow: var(--shadow); }
        .slider-row { display: flex; gap: 15px; }
        .slider-wrapper { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .slider-label { font-size: 0.65rem; font-weight: 800; color: var(--text-sec); text-transform: uppercase; display: flex; justify-content: space-between; }
        input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; margin-top: -7px; box-shadow: 0 2px 6px rgba(225, 29, 72, 0.4); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: var(--border); border-radius: 2px; }
        .preview-container-3d { perspective: 1000px; width: 100%; display: flex; justify-content: center; margin-bottom: 25px; }
        .card-preview-wrapper { width: 100%; aspect-ratio: 4/5; border-radius: 32px; text-align: center; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; background-color: white; box-shadow: 0 20px 60px -10px rgba(0,0,0,0.25); transition: transform 0.1s ease-out, box-shadow 0.1s ease-out; border: 1px solid rgba(255,255,255,0.2); transform-style: preserve-3d; }
        .frame-white { border: 12px solid #ffffff; }
        .frame-black { border: 12px solid #1e293b; }
        .frame-gold { border: 12px solid #d4af37; box-shadow: inset 0 0 20px rgba(184, 134, 11, 0.5); }
        .frame-wood { border: 15px solid #8b4513; border-radius: 4px !important; }
        .frame-neon-pink { border: 4px solid #ff00ff; box-shadow: 0 0 15px #ff00ff, inset 0 0 15px #ff00ff; }
        .frame-neon-blue { border: 4px solid #00ffff; box-shadow: 0 0 15px #00ffff, inset 0 0 15px #00ffff; }
        .frame-double { border: 8px solid white; outline: 4px solid rgba(0,0,0,0.1); outline-offset: -14px; }
        .frame-modern-y { border-top: 20px solid var(--primary); border-bottom: 20px solid var(--primary); }
        .frame-modern-x { border-left: 20px solid var(--primary); border-right: 20px solid var(--primary); }
        .frame-polaroid-clean { border: 15px solid white; border-bottom-width: 50px; border-radius: 2px !important; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .draggable-item { cursor: grab; touch-action: none; position: relative; z-index: 10; transition: transform 0.05s linear; user-select: none; }
        .draggable-item:active { cursor: grabbing; z-index: 50; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2)); }
        .format-bar { display: flex; gap: 8px; justify-content: center; margin-bottom: 15px; background: var(--bg-card); padding: 6px; border-radius: 20px; border: 1px solid var(--border); box-shadow: var(--shadow); }
        .fmt-btn { flex: 1; padding: 10px; border-radius: 14px; border: 1px solid transparent; background: transparent; color: var(--text-sec); font-size: 0.8rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: 0.2s; }
        .fmt-btn:hover { background: var(--input-bg); }
        .fmt-btn.active { background: var(--text-main); color: var(--bg-body); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .scroll-tools { display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; }
        .tool-row { display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding: 4px 2px 10px 2px; white-space: nowrap; }
        .tool-btn { flex: 0 0 auto; padding: 10px 18px; border-radius: 14px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-sec); font-size: 0.85rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .tool-btn:active { transform: scale(0.95); }
        .tool-btn.active { background: var(--primary-light); color: var(--primary); border-color: var(--primary); box-shadow: 0 4px 10px rgba(225, 29, 72, 0.15); }
        .preview-controls { display: flex; flex-direction: row; flex-wrap: nowrap; gap: 14px; overflow-x: auto; align-items: center; scrollbar-width: none; padding: 10px 5px 25px 5px; margin-bottom: 0; }
        .theme-btn { flex: 0 0 auto; width: 60px; height: 60px; border-radius: 18px; border: 3px solid transparent; cursor: pointer; position: relative; background-size: cover; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: rgba(255,255,255,0.9); box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.3s; }
        .theme-btn:hover { transform: translateY(-3px); }
        .theme-btn.active { border-color: var(--primary); transform: scale(1.1); box-shadow: 0 10px 25px rgba(225, 29, 72, 0.3); z-index: 10; }
        .theme-btn.upload-btn { border: 2px dashed var(--text-sec); color: var(--text-sec); box-shadow: none; background: var(--input-bg); }
        .theme-btn.magic-btn { background: linear-gradient(135deg, #a855f7, #ec4899); color: white; border: none; }
        .fmt-feed { aspect-ratio: 4/5; border-radius: 28px; }
        .fmt-square { aspect-ratio: 1/1; border-radius: 28px; }
        .fmt-story { aspect-ratio: 9/16; border-radius: 0; }
        .fmt-music { aspect-ratio: 4/5; border-radius: 24px; }
        .card-sticker { position: absolute; top: 25px; right: 25px; z-index: 10; background: rgba(255,255,255,0.95); padding: 8px 16px; border-radius: 30px; font-size: 0.75rem; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); display: none; backdrop-filter: blur(5px); transform: translateZ(20px); }
        .card-sticker.visible { display: block; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .music-overlay { position: absolute; bottom: 20px; left: 0; width: 100%; padding: 0 30px; z-index: 8; display: none; flex-direction: column; gap: 8px; transform: translateZ(10px); }
        .fmt-music .music-overlay { display: flex; }
        .fmt-music .pv-footer { display: none; }
        .music-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; position: relative; }
        .music-progress { width: 65%; height: 100%; background: white; border-radius: 2px; }
        .music-time { display: flex; justify-content: space-between; font-size: 0.6rem; color: rgba(255,255,255,0.8); font-weight: 600; margin-top: 4px; font-family: 'Montserrat', sans-serif; }
        .music-controls { display: flex; justify-content: center; gap: 20px; align-items: center; margin-top: 5px; color: white; font-size: 1.2rem; }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .filter-bw { filter: grayscale(100%); } .filter-sepia { filter: sepia(60%); } .filter-vivid { filter: saturate(1.5) contrast(1.1); }
        .font-modern .pv-title { font-family: 'Poppins', sans-serif; } 
        .font-classic .pv-title { font-family: 'Playfair Display', serif; } 
        .font-hand .pv-title { font-family: 'Dancing Script', cursive; font-size: 2.6rem; }
        .font-bold .pv-title { font-family: 'Bebas Neue', sans-serif; font-size: 3.5rem; letter-spacing: 1px; }
        .font-marker .pv-title { font-family: 'Permanent Marker', cursive; font-size: 2.2rem; }
        .align-left .pv-msg { text-align: left; } .align-center .pv-msg { text-align: center; }
        .card-overlay { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 1; pointer-events: none; transition: 0.3s; transform: translateZ(0); }
        .dimmer-light { background: rgba(0,0,0,0.2); } .dimmer-heavy { background: rgba(0,0,0,0.5); }
        .text-glow .pv-title, .text-glow .pv-msg, .text-glow .pv-verse { text-shadow: 0 0 10px rgba(255,255,255,0.8), 0 0 20px rgba(255,255,255,0.5); }
        .t-clean { background: white; color: #1e293b; } .t-clean .pv-title { color: #e11d48; }
        .t-dark { background: #0f172a; color: white; } .t-dark .pv-msg { background: rgba(255,255,255,0.1); color: #e2e8f0; border: 1px solid rgba(255,255,255,0.1); } .t-dark .pv-title { color: #818cf8; }
        .t-gold { background: linear-gradient(135deg, #FDEB71 0%, #F8D800 100%); color: #5c4a08; } .t-gold .pv-msg { background: rgba(255,255,255,0.6); color: #423602; }
        .t-ocean { background: linear-gradient(to top, #30cfd0 0%, #330867 100%); color: white; } .t-ocean .pv-msg { background: rgba(255,255,255,0.15); color:white; border: 1px solid rgba(255,255,255,0.2); }
        .t-nature { background: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%); color: #14532d; } .t-nature .pv-msg { background: rgba(255,255,255,0.7); }
        .t-sunset { background: linear-gradient(to right, #fa709a 0%, #fee140 100%); color: #7f1d1d; } .t-sunset .pv-msg { background: rgba(255,255,255,0.8); }
        .t-royal { background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%); color: white; } .t-royal .pv-msg { background: rgba(255,255,255,0.15); color:white; border: 1px solid rgba(255,255,255,0.2); }
        .card-content-layer { position: relative; z-index: 5; width: 100%; transition: font-size 0.2s; text-shadow: 0 2px 10px rgba(0,0,0,0.05); transform: translateZ(30px); }
        .pv-title { font-size: 1.8rem; font-weight: 800; margin-bottom: 12px; line-height: 1.1; letter-spacing: -0.5px; }
        .pv-ref { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 6px; font-weight: 600; }
        .pv-verse { font-style: italic; opacity: 0.9; margin-bottom: 15px; display: block; font-size: 0.9em; }
        .pv-msg { padding: 30px; border-radius: 24px; font-size: 0.95rem; line-height: 1.7; margin-bottom: 30px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); color: #333; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: 0.3s; min-height: 100px; }
        .pv-footer { font-size: 0.7rem; opacity: 0.75; text-transform: uppercase; margin-top: auto; display: flex; align-items: center; justify-content: center; gap: 6px; font-weight: 600; letter-spacing: 0.5px; cursor: pointer; }
        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-action { border: none; padding: 18px; border-radius: 18px; font-weight: 600; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: 0.2s; font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-action:active { transform: scale(0.96); }
        .btn-share { background: #25D366; grid-column: span 2; box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3); }
        .btn-audio { background: #f43f5e; color: white; grid-column: span 2; }
        .btn-save { background: #3b82f6; } .btn-print { background: #64748b; } .btn-copy { background: #94a3b8; }
        .bottom-nav { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; max-width: 380px; height: 70px; background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 40px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; box-shadow: 0 15px 40px rgba(0,0,0,0.3); padding: 0 10px; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .studio-root[data-theme="light"] .bottom-nav { background: rgba(255,255,255,0.9); border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 15px 40px rgba(0,0,0,0.1); }
        .nav-item { background: none; border: none; color: rgba(255,255,255,0.4); cursor: pointer; width: 55px; height: 55px; border-radius: 50%; font-size: 1.3rem; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .studio-root[data-theme="light"] .nav-item { color: #94a3b8; }
        .nav-item.active { background: var(--primary); color: white; transform: translateY(-8px); box-shadow: 0 8px 20px rgba(225, 29, 72, 0.4); }
        #toast { visibility: hidden; background: #1e293b; color: #fff; text-align: center; border-radius: 50px; padding: 12px 24px; position: fixed; z-index: 2000; left: 50%; top: 20px; transform: translateX(-50%); font-size: 0.95rem; font-weight: 600; opacity: 0; transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; white-space: nowrap; }
        #toast.show { visibility: visible; opacity: 1; top: 40px; }
        @media print {
            header, .sticky-tabs, .no-print, .calculator-widget, .main-header-nav, .bottom-nav, .actions-grid, .preview-controls, .studio-tools, .top-nav-bar, .format-bar, .slider-box, .scroll-tools { display: none !important; }
            body { background-color: white; }
            .print-container { box-shadow: none; border: none; padding: 0; }
            #card-capture, #card-capture * { visibility: visible !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            #screen-preview { display: block !important; position: absolute; left: 0; top: 0; width: 100%; margin: 0; }
            .card-preview-wrapper { box-shadow: none; border: none; width: 100% !important; margin: 0 auto; filter: none !important; border-radius: 0; transform: none !important; }
            .preaching-print-only { display: block !important; width: 100%; overflow: visible; white-space: pre-wrap; font-family: 'Merriweather', serif; font-size: 12pt; line-height: 1.5; color: black; margin-bottom: 10px; text-align: justify; }
            .preaching-input { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // =================================================================
        // LÓGICAS DOS JOGOS (Damas, Forca, Memória, Velha, Quiz e Aero)
        // Integradas do arquivo 6x1jogos.html
        // =================================================================

        // 1. DAMAS
        function initDamas(container) {
            container.innerHTML = `
                <div class="w-full max-w-2xl mx-auto">
                    <div id="damas-board-container" class="aspect-square w-full max-w-lg mx-auto bg-gray-900 border-4 border-gray-700 rounded-lg shadow-2xl overflow-hidden mb-4">
                        <div id="damas-board" class="grid grid-cols-8 grid-rows-8 w-full h-full"></div>
                    </div>
                    <h1 class="text-3xl lg:text-4xl font-bold text-center text-white mb-4">Jogo de Damas</h1>
                    <div class="flex flex-col sm:flex-row justify-between items-center bg-gray-700 p-3 rounded-lg shadow-lg mb-4">
                        <div class="flex gap-2 mb-2 sm:mb-0">
                            <button id="damas-new-game-2p" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md shadow-md transition-colors duration-200">Novo Jogo (2P)</button>
                            <button id="damas-new-game-ia" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-md shadow-md transition-colors duration-200">Novo Jogo (IA)</button>
                        </div>
                        <div id="damas-status-message" class="text-lg font-semibold text-center text-white">Comece um novo jogo!</div>
                        <div id="damas-timer-display" class="text-2xl font-mono font-bold text-gray-300 w-24 text-center" title="Tempo restante">00:45</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4 text-center">
                        <div id="damas-p1-score-box" class="bg-gray-700 p-4 rounded-lg shadow-inner border-4 border-transparent transition-colors duration-300">
                            <h2 class="text-xl font-bold text-red-400">JOGADOR 1 (Pretas)</h2>
                            <p class="text-3xl font-mono text-white" id="damas-player1-score">12</p>
                        </div>
                        <div id="damas-p2-score-box" class="bg-gray-700 p-4 rounded-lg shadow-inner border-4 border-transparent transition-colors duration-300">
                            <h2 class="text-xl font-bold text-gray-300">JOGADOR 2 (Brancas)</h2>
                            <p class="text-3xl font-mono text-white" id="damas-player2-score">12</p>
                        </div>
                    </div>
                </div>
                <div id="damas-game-over-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[150] hidden">
                    <div class="bg-gray-800 rounded-lg shadow-xl p-6 md:p-8 text-center">
                        <h2 id="damas-winner-message" class="text-3xl font-bold mb-6 text-white"></h2>
                        <button id="damas-play-again-button" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-lg font-semibold rounded-lg shadow-md transition-colors duration-200">Jogar Novamente</button>
                    </div>
                </div>
            `;
            const EMPTY=0, P1=1, P2=2, P1_KING=3, P2_KING=4, BOARD_SIZE=8;
            let board=[], currentPlayer=P1, gameMode='2P', selectedPiece=null, validMoves=[], mustCaptureMoves=[], isChainCapture=false, gameOver=true;
            let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            let turnTimerID=null, turnTimeLeft=45;
            const boardEl=container.querySelector('#damas-board'), statusEl=container.querySelector('#damas-status-message'), timerEl=container.querySelector('#damas-timer-display'), p1ScoreEl=container.querySelector('#damas-player1-score'), p2ScoreEl=container.querySelector('#damas-player2-score'), p1Box=container.querySelector('#damas-p1-score-box'), p2Box=container.querySelector('#damas-p2-score-box'), modalEl=container.querySelector('#damas-game-over-modal'), winnerMsgEl=container.querySelector('#damas-winner-message');

            function initGame(mode) {
                gameMode=mode; currentPlayer=P1; selectedPiece=null; validMoves=[]; mustCaptureMoves=[]; isChainCapture=false; gameOver=false;
                stopTurnTimer();
                board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(EMPTY));
                for(let r=0; r<BOARD_SIZE; r++) for(let c=0; c<BOARD_SIZE; c++) if((r+c)%2===1) { if(r<3) board[r][c]=P2; else if(r>4) board[r][c]=P1; }
                renderBoard(); updateStatus(); findAllPlayerMoves(currentPlayer); updateScore(); modalEl.classList.add('hidden'); startTurnTimer(); updatePlayerHighlight();
                if(audioCtx.state === 'suspended') audioCtx.resume();
            }
            function renderBoard() {
                boardEl.innerHTML='';
                for(let r=0; r<BOARD_SIZE; r++) for(let c=0; c<BOARD_SIZE; c++) {
                    const cell=document.createElement('div'), isDark=(r+c)%2===1;
                    cell.className=`w-full h-full flex items-center justify-center relative ${isDark?'bg-gray-700 cursor-pointer':'bg-gray-400'}`;
                    const pieceType=board[r][c];
                    if(pieceType!==EMPTY) {
                        const piece=document.createElement('div');
                        piece.className=`w-[70%] h-[70%] rounded-full shadow-lg transition-all duration-150 ${(pieceType===P1||pieceType===P1_KING)?'bg-gray-900 border-2 border-gray-600':'bg-gray-200 border-2 border-gray-400'}`;
                        if(!gameOver && isPlayerPiece(pieceType, currentPlayer)) piece.classList.add('current-player-ring');
                        if(pieceType===P1_KING||pieceType===P2_KING) { piece.classList.add('king'); piece.classList.add(pieceType===P1_KING?'text-gray-200':'text-gray-900'); }
                        cell.appendChild(piece);
                    }
                    if(selectedPiece && selectedPiece.row===r && selectedPiece.col===c) cell.classList.add('bg-yellow-500','opacity-80');
                    if(validMoves.some(m=>m.toRow===r && m.toCol===c)) { const h=document.createElement('div'); h.className='absolute w-1/3 h-1/3 bg-green-500 rounded-full opacity-50'; cell.appendChild(h); }
                    if(isDark) cell.onclick=()=>onCellClick(r, c);
                    boardEl.appendChild(cell);
                }
            }
            function onCellClick(row, col) {
                if(gameOver) return;
                if(gameMode==='IA' && currentPlayer===P2) return;
                const move=validMoves.find(m=>m.toRow===row && m.toCol===col);
                if(move) { executeMove(move); return; }
                if(isChainCapture) return;
                selectedPiece=null; validMoves=[];
                const pieceType=board[row][col];
                if(isPlayerPiece(pieceType, currentPlayer)) {
                    if(mustCaptureMoves.length>0 && !mustCaptureMoves.some(m=>m.fromRow===row && m.fromCol===col)) return;
                    selectedPiece={row, col, type:pieceType};
                    validMoves=(mustCaptureMoves.length>0)?mustCaptureMoves.filter(m=>m.fromRow===row && m.fromCol===col):findAllMovesForPiece(row, col, pieceType, false);
                }
                renderBoard();
            }
            function executeMove(move) {
                const {fromRow, fromCol, toRow, toCol, captured}=move, pieceType=board[fromRow][fromCol];
                board[toRow][toCol]=pieceType; board[fromRow][fromCol]=EMPTY;
                if(captured) { board[captured.row][captured.col]=EMPTY; playSoundCapture(); } else playSoundMove();
                if(pieceType===P1 && toRow===0) board[toRow][toCol]=P1_KING;
                if(pieceType===P2 && toRow===BOARD_SIZE-1) board[toRow][toCol]=P2_KING;
                isChainCapture=false;
                if(captured) {
                    const newCaptures=findAllMovesForPiece(toRow, toCol, board[toRow][toCol], true);
                    if(newCaptures.length>0) { isChainCapture=true; selectedPiece={row:toRow, col:toCol, type:board[toRow][toCol]}; validMoves=newCaptures; mustCaptureMoves=newCaptures; startTurnTimer(); renderBoard(); }
                }
                if(!isChainCapture) { selectedPiece=null; validMoves=[]; switchTurn(); } else if(gameMode==='IA' && currentPlayer===P2) setTimeout(makeAIMove, 500);
                updateScore();
            }
            function switchTurn() {
                if(gameOver) return;
                currentPlayer=(currentPlayer===P1)?P2:P1; updateStatus(); startTurnTimer(); updatePlayerHighlight(); renderBoard(); findAllPlayerMoves(currentPlayer);
                if(mustCaptureMoves.length===0 && findAllSimpleMoves(currentPlayer).length===0) { showGameOver((currentPlayer===P1)?"Brancas (P2) Venceram!":"Pretas (P1) Venceram!"); return; }
                if(gameMode==='IA' && currentPlayer===P2 && !gameOver) setTimeout(makeAIMove, 500);
            }
            function showGameOver(msg) { gameOver=true; stopTurnTimer(); updatePlayerHighlight(); renderBoard(); winnerMsgEl.textContent=msg; modalEl.classList.remove('hidden'); }
            function makeAIMove() {
                if(gameOver) return; statusEl.textContent="IA está pensando...";
                setTimeout(()=>{
                    const {bestMove}=minimax(board, 3, true, P2);
                    if(bestMove) executeMove(bestMove); else showGameOver("Pretas (P1) Venceram! (IA travada)");
                }, 0);
            }
            function minimax(simBoard, depth, isMax, player) {
                if(depth===0) return {score:evaluateBoard(simBoard), bestMove:null};
                const allMoves=getAllPossibleMovesForPlayer(simBoard, player);
                if(allMoves.length===0) return {score:isMax?-Infinity:Infinity, bestMove:null};
                let bestMove=null, bestScore=isMax?-Infinity:Infinity;
                for(const move of allMoves) {
                    const {newBoard, isChain}=simulateMove(simBoard, move);
                    let score;
                    if(isChain) score=minimax(newBoard, depth-1, isMax, player).score;
                    else score=minimax(newBoard, depth-1, !isMax, (player===P1)?P2:P1).score;
                    if(isMax) { if(score>bestScore) { bestScore=score; bestMove=move; } } else { if(score<bestScore) { bestScore=score; bestMove=move; } }
                }
                return {score:bestScore, bestMove};
            }
            function evaluateBoard(b) {
                let s=0; for(let r=0; r<8; r++) for(let c=0; c<8; c++) { const p=b[r][c]; if(p===P1) s-=1; if(p===P2) s+=1; if(p===P1_KING) s-=3; if(p===P2_KING) s+=3; } return s;
            }
            function getAllPossibleMovesForPlayer(simBoard, player) {
                let moves=[], captures=[];
                const realBoard=board; board=simBoard; 
                for(let r=0; r<8; r++) for(let c=0; c<8; c++) {
                    const p=simBoard[r][c];
                    if(!isPlayerPiece(p, player)) continue;
                    moves.push(...findAllMovesForPiece(r, c, p, false)); captures.push(...findAllMovesForPiece(r, c, p, true));
                }
                board=realBoard; return captures.length>0?captures:moves;
            }
            function simulateMove(simBoard, move) {
                const newBoard=simBoard.map(r=>[...r]), {fromRow, fromCol, toRow, toCol, captured}=move;
                let p=newBoard[fromRow][fromCol]; newBoard[toRow][toCol]=p; newBoard[fromRow][fromCol]=EMPTY;
                if(captured) newBoard[captured.row][captured.col]=EMPTY;
                if(p===P1 && toRow===0) newBoard[toRow][toCol]=P1_KING; if(p===P2 && toRow===7) newBoard[toRow][toCol]=P2_KING;
                let isChain=false;
                if(captured) { const realBoard=board; board=newBoard; if(findAllMovesForPiece(toRow, toCol, newBoard[toRow][toCol], true).length>0) isChain=true; board=realBoard; }
                return {newBoard, isChain};
            }
            function findAllPlayerMoves(player) {
                mustCaptureMoves=[]; for(let r=0; r<8; r++) for(let c=0; c<8; c++) if(isPlayerPiece(board[r][c], player)) mustCaptureMoves.push(...findAllMovesForPiece(r, c, board[r][c], true));
            }
            function findAllSimpleMoves(player) {
                let m=[]; for(let r=0; r<8; r++) for(let c=0; c<8; c++) if(isPlayerPiece(board[r][c], player)) m.push(...findAllMovesForPiece(r, c, board[r][c], false)); return m;
            }
            function findAllMovesForPiece(r, c, type, capturesOnly) {
                let moves=[], opp=(currentPlayer===P1)?[P2, P2_KING]:[P1, P1_KING], dirs=(type===P1_KING||type===P2_KING)?[[-1,-1],[-1,1],[1,-1],[1,1]]:(type===P1?[[-1,-1],[-1,1]]:[[1,-1],[1,1]]);
                if(!capturesOnly) {
                    if(type===P1_KING||type===P2_KING) { for(const [dr, dc] of dirs) { let cr=r+dr, cc=c+dc; while(isValidPos(cr, cc) && board[cr][cc]===EMPTY) { moves.push({fromRow:r, fromCol:c, toRow:cr, toCol:cc}); cr+=dr; cc+=dc; } } }
                    else { for(const [dr, dc] of dirs) if(isValidPos(r+dr, c+dc) && board[r+dr][c+dc]===EMPTY) moves.push({fromRow:r, fromCol:c, toRow:r+dr, toCol:c+dc}); }
                }
                const capDirs=[[-1,-1],[-1,1],[1,-1],[1,1]];
                if(type===P1_KING||type===P2_KING) {
                    for(const [dr, dc] of capDirs) { let cr=r+dr, cc=c+dc; while(isValidPos(cr, cc)) { if(isPlayerPiece(board[cr][cc], currentPlayer)) break; if(opp.includes(board[cr][cc])) { let jr=cr+dr, jc=cc+dc; if(isValidPos(jr, jc) && board[jr][jc]===EMPTY) { while(isValidPos(jr, jc) && board[jr][jc]===EMPTY) { moves.push({fromRow:r, fromCol:c, toRow:jr, toCol:jc, captured:{row:cr, col:cc}}); jr+=dr; jc+=dc; } } break; } cr+=dr; cc+=dc; } }
                } else {
                    for(const [dr, dc] of capDirs) { const nr=r+dr, nc=c+dc, jr=r+dr*2, jc=c+dc*2; if(isValidPos(jr, jc) && opp.includes(board[nr][nc]) && board[jr][jc]===EMPTY) moves.push({fromRow:r, fromCol:c, toRow:jr, toCol:jc, captured:{row:nr, col:nc}}); }
                }
                return moves;
            }
            function isValidPos(r, c) { return r>=0 && r<8 && c>=0 && c<8; }
            function isPlayerPiece(p, pl) { return (pl===P1 && (p===P1||p===P1_KING)) || (pl===P2 && (p===P2||p===P2_KING)); }
            function updateStatus() { statusEl.textContent=gameOver?"Fim de Jogo":`Vez de: ${(currentPlayer===P1)?"Pretas (P1)":"Brancas (P2)"}`; }
            function updateScore() { let s1=0, s2=0; for(let r=0; r<8; r++) for(let c=0; c<8; c++) { if(board[r][c]===P1||board[r][c]===P1_KING) s1++; if(board[r][c]===P2||board[r][c]===P2_KING) s2++; } p1ScoreEl.innerText=s1; p2ScoreEl.innerText=s2; }
            function updatePlayerHighlight() { p1Box.className=`bg-gray-700 p-4 rounded-lg shadow-inner border-4 transition-colors duration-300 ${currentPlayer===P1 && !gameOver ? 'border-yellow-400 animate-pulse' : 'border-transparent'}`; p2Box.className=`bg-gray-700 p-4 rounded-lg shadow-inner border-4 transition-colors duration-300 ${currentPlayer===P2 && !gameOver ? 'border-yellow-400 animate-pulse' : 'border-transparent'}`; }
            function startTurnTimer() { stopTurnTimer(); turnTimeLeft=45; updateTimerDisplay(); turnTimerID=setInterval(()=>{ if(gameOver) { stopTurnTimer(); return; } turnTimeLeft--; updateTimerDisplay(); if(turnTimeLeft===0) showGameOver((currentPlayer===P1?"Brancas":"Pretas") + " Venceram por tempo!"); }, 1000); }
            function stopTurnTimer() { if(turnTimerID) clearInterval(turnTimerID); turnTimerID=null; }
            function updateTimerDisplay() { timerEl.innerText=`00:${turnTimeLeft.toString().padStart(2,'0')}`; timerEl.className=`text-2xl font-mono font-bold w-24 text-center ${turnTimeLeft<=5?'text-red-500 animate-pulse':(turnTimeLeft<=10?'text-yellow-400':'text-gray-300')}`; }
            function playSoundMove() { const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.frequency.setValueAtTime(800, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+0.1); o.start(); o.stop(audioCtx.currentTime+0.1); }
            function playSoundCapture() { const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.frequency.setValueAtTime(400, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+0.15); o.start(); o.stop(audioCtx.currentTime+0.15); }
            container.querySelector('#damas-new-game-2p').onclick=()=>initGame('2P'); container.querySelector('#damas-new-game-ia').onclick=()=>initGame('IA'); container.querySelector('#damas-play-again-button').onclick=()=>initGame(gameMode);
            initGame('2P');
            return ()=>{ stopTurnTimer(); };
        }

        // =================================================================
        // JOGO 2: FORCA
        // =================================================================
        function initForca(container) {
            container.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl text-gray-800">
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="flex-1 text-center">
                            <svg class="w-32 h-32 mx-auto mb-2" viewBox="0 0 100 120">
                                <line x1="10" y1="115" x2="90" y2="115" stroke="#6B7280" stroke-width="4" />
                                <line x1="30" y1="115" x2="30" y2="10" stroke="#6B7280" stroke-width="4" />
                                <line x1="30" y1="10" x2="70" y2="10" stroke="#6B7280" stroke-width="4" />
                                <line x1="70" y1="10" x2="70" y2="25" stroke="#6B7280" stroke-width="4" />
                                <circle id="hp1" class="hangman-part" cx="70" cy="35" r="10" />
                                <line id="hp2" class="hangman-part" x1="70" y1="45" x2="70" y2="75" />
                                <line id="hp3" class="hangman-part" x1="70" y1="55" x2="55" y2="45" />
                                <line id="hp4" class="hangman-part" x1="70" y1="55" x2="85" y2="45" />
                                <line id="hp5" class="hangman-part" x1="70" y1="75" x2="55" y2="95" />
                                <line id="hp6" class="hangman-part" x1="70" y1="75" x2="85" y2="95" />
                            </svg>
                            <div class="text-red-500 font-bold mb-2" id="forca-mistakes">Erros: 0/6</div>
                            <div class="text-blue-600 font-bold mb-4" id="forca-timer">Tempo: 2:00</div>
                            <div id="forca-word" class="flex flex-wrap justify-center gap-2 mb-4 text-3xl font-bold min-h-[3rem]"></div>
                        </div>
                        <div class="flex-1">
                            <div id="forca-hint" class="text-center font-bold text-green-600 h-8 mb-2"></div>
                            <div id="forca-keyboard" class="flex flex-wrap justify-center gap-1"></div>
                            <button id="forca-restart" class="w-full mt-4 bg-blue-500 text-white font-bold py-2 rounded">Nova Palavra</button>
                        </div>
                    </div>
                </div>
            `;
            const categories = {'FRUTAS':['BANANA','UVA'],'ANIMAIS':['GATO','CACHORRO'],'PAISES':['BRASIL','JAPAO']};
            let selectedWord='', currentCat='', guessed=[], wrong=[], gameActive=true, timer=null, timeLeft=120;
            function startGame() {
                const cats=Object.keys(categories); currentCat=cats[Math.floor(Math.random()*cats.length)];
                const words=categories[currentCat]; selectedWord=words[Math.floor(Math.random()*words.length)];
                guessed=Array(selectedWord.length).fill(null); wrong=[]; gameActive=true; timeLeft=120;
                updateDisplay(); createKeyboard(); startTimer(); container.querySelector('#forca-hint').innerText='';
                for(let i=1; i<=6; i++) { const el=container.querySelector(`#hp${i}`); el.style.visibility='hidden'; el.style.opacity=0; }
            }
            function createKeyboard() {
                const kb=container.querySelector('#forca-keyboard'); kb.innerHTML='';
                'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').forEach(l=>{
                    const btn=document.createElement('button'); btn.innerText=l; btn.className="w-8 h-8 bg-blue-100 hover:bg-blue-200 text-blue-900 rounded font-bold transition";
                    btn.onclick=()=>handleGuess(l, btn); kb.appendChild(btn);
                });
            }
            function handleGuess(l, btn) {
                if(!gameActive||btn.disabled) return;
                btn.disabled=true; btn.classList.add('bg-gray-300','cursor-not-allowed'); btn.classList.remove('bg-blue-100');
                if(selectedWord.includes(l)) {
                    const synth=new Tone.Synth().toDestination(); synth.triggerAttackRelease("C5","8n");
                    selectedWord.split('').forEach((char, i)=>{ if(char===l) guessed[i]=l; });
                } else {
                    const synth=new Tone.Synth().toDestination(); synth.triggerAttackRelease("A2","8n");
                    wrong.push(l); const part=container.querySelector(`#hp${wrong.length}`); if(part) { part.style.visibility='visible'; part.style.opacity=1; }
                }
                if(wrong.length===3) container.querySelector('#forca-hint').innerText="Dica: "+currentCat;
                updateDisplay(); checkWin();
            }
            function updateDisplay() {
                container.querySelector('#forca-word').innerHTML=guessed.map(l=>`<span class="letter-display ${l?'revealed':''}">${l||'_'}</span>`).join('');
                container.querySelector('#forca-mistakes').innerText=`Erros: ${wrong.length}/6`;
            }
            function checkWin() { if(!guessed.includes(null)) finish(true); else if(wrong.length>=6) finish(false); }
            function finish(win) {
                gameActive=false; clearInterval(timer);
                container.querySelector('#forca-hint').innerText=win?"VOCÊ VENCEU!":"GAME OVER: "+selectedWord;
                container.querySelector('#forca-hint').className=win?"text-center font-bold text-green-500 text-xl":"text-center font-bold text-red-500 text-xl";
            }
            function startTimer() {
                if(timer) clearInterval(timer); const el=container.querySelector('#forca-timer');
                timer=setInterval(()=>{
                    if(!gameActive) return; timeLeft--;
                    const m=Math.floor(timeLeft/60), s=timeLeft%60;
                    el.innerText=`Tempo: ${m}:${s.toString().padStart(2,'0')}`;
                    if(timeLeft<=0) finish(false);
                }, 1000);
            }
            container.querySelector('#forca-restart').onclick=startGame; startGame();
            return ()=>{ if(timer) clearInterval(timer); };
        }

        // =================================================================
        // JOGO 3: MEMÓRIA
        // =================================================================
        function initMemoria(container) {
            container.innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-2xl text-center w-full max-w-lg text-gray-800">
                    <h2 class="text-3xl font-bold text-blue-600 mb-4">Memória Musical</h2>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Jogadas: <span id="mem-moves">0</span></h3>
                    <div id="mem-grid" class="grid grid-cols-4 gap-3 mb-6 justify-center"></div>
                    <button id="mem-restart" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg">Reiniciar</button>
                </div>
            `;
            const emojis=['🐶','🐱','🐭','🐹','🐰','🦊','🐻','🐼'], sounds={'🐶':'C4','🐱':'D4','🐭':'E4','🐹':'F4','🐰':'G4','🦊':'A4','🐻':'B4','🐼':'C5'};
            let cards=[], flipped=[], matched=0, moves=0, lock=false; let synth=new Tone.Synth().toDestination();
            function init() {
                const grid=container.querySelector('#mem-grid'); grid.innerHTML='';
                cards=[...emojis, ...emojis].sort(()=>Math.random()-0.5); flipped=[]; matched=0; moves=0; lock=false;
                container.querySelector('#mem-moves').innerText='0';
                cards.forEach(emoji=>{
                    const card=document.createElement('div'); card.className="memory-card-container w-20 h-20";
                    card.innerHTML=`<div class="memory-card-inner"><div class="memory-back">?</div><div class="memory-front">${emoji}</div></div>`;
                    card.onclick=()=>flip(card, emoji); grid.appendChild(card);
                });
            }
            function flip(card, emoji) {
                if(lock||card.classList.contains('is-flipped')||flipped.includes(card)) return;
                try{ synth.triggerAttackRelease(sounds[emoji], "8n"); }catch(e){}
                card.classList.add('is-flipped'); flipped.push(card);
                if(flipped.length===2) { moves++; container.querySelector('#mem-moves').innerText=moves; lock=true; checkMatch(); }
            }
            function checkMatch() {
                const [c1, c2]=flipped, e1=c1.querySelector('.memory-front').innerText, e2=c2.querySelector('.memory-front').innerText;
                if(e1===e2) {
                    matched++; flipped=[]; lock=false;
                    if(matched===8) { const s=new Tone.PolySynth().toDestination(); s.triggerAttackRelease(["C4","E4","G4","C5"],"4n"); }
                } else { setTimeout(()=>{ c1.classList.remove('is-flipped'); c2.classList.remove('is-flipped'); flipped=[]; lock=false; }, 1000); }
            }
            container.querySelector('#mem-restart').onclick=init; init(); return ()=>{};
        }

        // =================================================================
        // JOGO 4: VELHA
        // =================================================================
        function initVelha(container) {
            container.innerHTML = `
                <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-2xl border border-gray-700 p-8 text-white">
                    <h1 class="text-3xl font-bold text-center text-blue-400 mb-6">Jogo da Velha</h1>
                    <div class="text-center mb-4"><h2 class="text-lg font-semibold text-gray-300">Melhor de 3</h2><div class="text-4xl font-bold text-white flex justify-center items-center space-x-4"><span id="score-x" class="text-red-400">0</span><span>x</span><span id="score-o" class="text-green-400">0</span></div></div>
                    <div class="flex justify-between mb-4 space-x-4"><div class="text-center w-1/2"><label for="player-x" class="block text-sm text-gray-400">Jogador X</label><input type="text" id="player-x" value="Janio" class="bg-gray-700 border border-gray-600 rounded p-2 text-center text-red-400 font-semibold w-full"></div><div class="text-center w-1/2"><label for="player-o" class="block text-sm text-gray-400">Jogador O</label><input type="text" id="player-o" value="Iis" class="bg-gray-700 border border-gray-600 rounded p-2 text-center text-green-400 font-semibold w-full"></div></div>
                    <div id="velha-status-message" class="text-center text-xl font-semibold text-yellow-400 h-12 mb-4"></div>
                    <div id="velha-board" class="grid grid-cols-3 gap-3 mb-6"></div>
                    <button id="velha-restart-button" class="w-full bg-blue-600 text-white p-4 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors">Reiniciar Jogo</button>
                </div>
            `;
            const board=container.querySelector('#velha-board'), status=container.querySelector('#velha-status-message'), restart=container.querySelector('#velha-restart-button'), scoreXEl=container.querySelector('#score-x'), scoreOEl=container.querySelector('#score-o'), pX=container.querySelector('#player-x'), pO=container.querySelector('#player-o');
            let synthX, synthO; try{ synthX=new Tone.Synth().toDestination(); synthO=new Tone.Synth().toDestination(); }catch(e){}
            let currentPlayer='x', gameActive=true, gameState=Array(9).fill(""), scoreX=0, scoreO=0;
            const winning=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            function init() {
                board.innerHTML=''; gameState.fill(""); gameActive=true;
                if(scoreX===2||scoreO===2) { scoreX=0; scoreO=0; updateScore(); status.textContent="Nova série iniciada!"; } else status.textContent=`Vez de ${getName(currentPlayer)}`;
                currentPlayer='x';
                for(let i=0; i<9; i++) {
                    const cell=document.createElement('div'); cell.className='tic-cell w-24 h-24 bg-gray-700 rounded-lg flex items-center justify-center text-5xl font-bold cursor-pointer transition-all duration-300';
                    cell.onclick=()=>click(i, cell); board.appendChild(cell);
                }
            }
            function click(i, cell) {
                if(gameState[i]!==""||!gameActive) return;
                gameState[i]=currentPlayer; cell.textContent=currentPlayer==='x'?'X':'O';
                cell.className=`tic-cell w-24 h-24 bg-gray-700 rounded-lg flex items-center justify-center text-5xl font-bold cursor-pointer transition-all duration-300 ${currentPlayer==='x'?'text-red-400':'text-green-400'}`;
                playSound(currentPlayer);
                if(checkWin()) {
                    gameActive=false; (currentPlayer==='x')?scoreX++:scoreO++; updateScore();
                    if(scoreX===2) status.textContent=`${getName('x')} venceu a série!`; else if(scoreO===2) status.textContent=`${getName('o')} venceu a série!`; else status.textContent=`${getName(currentPlayer)} venceu a rodada!`;
                } else if(!gameState.includes("")) { gameActive=false; status.textContent="Empate!"; }
                else { currentPlayer=currentPlayer==='x'?'o':'x'; status.textContent=`Vez de ${getName(currentPlayer)}`; }
            }
            function checkWin() { return winning.some(c=>gameState[c[0]]&&gameState[c[0]]===gameState[c[1]]&&gameState[c[0]]===gameState[c[2]]); }
            function playSound(p) { try{ if(Tone.context.state!=='running') Tone.start(); if(p==='x') synthX.triggerAttackRelease("C4","8n"); else synthO.triggerAttackRelease("G4","8n"); }catch(e){} }
            function updateScore() { scoreXEl.textContent=scoreX; scoreOEl.textContent=scoreO; }
            function getName(p) { return (p==='x'?pX.value:pO.value).trim() || (p==='x'?'Jogador X':'Jogador O'); }
            restart.onclick=init; init(); return ()=>{};
        }

        // =================================================================
        // JOGO 5: QUIZ (Super Pack - Perguntas Aleatórias)
        // =================================================================
        function initQuiz(container) {
            container.innerHTML=`
                <div class="quiz-scope"><div class="quiz-app-container" id="quiz-main-container">
                    <div id="screen-menu" class="quiz-screen active">
                        <h1 style="margin:0 0 15px 0;text-shadow:3px 3px 6px rgba(0,0,0,0.5);">🎩 MAGIC QUIZ ULTIMATE</h1>
                        <p style="color:#ccc;margin-bottom:20px;">Teste seus conhecimentos com ajuda mágica!</p>
                        <div class="mode-selector"><button class="mode-btn selected" id="btn-solo" onclick="quizAPI.setMode('solo')">👤 Solo</button><button class="mode-btn" id="btn-duo" onclick="quizAPI.setMode('duo')">👥 Duelo (2 Jogadores)</button></div>
                        <div class="category-grid">
                            <div class="cat-card" onclick="quizAPI.startGame('biblia')"><span class="cat-icon">📜</span><span class="cat-title">Bíblia Sagrada</span></div>
                            <div class="cat-card" onclick="quizAPI.startGame('frutas')"><span class="cat-icon">🍇</span><span class="cat-title">Frutas & Comida</span></div>
                            <div class="cat-card" onclick="quizAPI.startGame('carros')"><span class="cat-icon">🏎️</span><span class="cat-title">Carros & Motores</span></div>
                            <div class="cat-card" onclick="quizAPI.startGame('mundo')"><span class="cat-icon">🌍</span><span class="cat-title">Mundo & Geo</span></div>
                            <div class="cat-card" onclick="quizAPI.startGame('matematica')"><span class="cat-icon">📐</span><span class="cat-title">Matemática</span></div>
                            <div class="cat-card" onclick="quizAPI.startGame('geral')"><span class="cat-icon">🎲</span><span class="cat-title">Mistura Total</span></div>
                        </div>
                    </div>
                    <div id="screen-game" class="quiz-screen">
                        <button class="btn-back-quiz" onclick="quizAPI.returnToMenu()">⬅ Voltar ao Menu</button>
                        <div class="hud"><div id="hud-p1" class="player-score-box p1-style active"><span style="font-size:0.8rem">JOGADOR 1</span><span class="score-val" id="score-p1">0</span><span class="combo-badge" id="combo-p1">COMBO x2!</span></div><div id="hud-p2" class="player-score-box p2-style" style="display:none;"><span style="font-size:0.8rem">JOGADOR 2</span><span class="score-val" id="score-p2">0</span><span class="combo-badge" id="combo-p2">COMBO x2!</span></div></div>
                        <div class="timer-wrapper"><div class="timer-val" id="timer-text">30s</div><div class="timer-track"><div class="timer-fill" id="timer-bar"></div></div></div>
                        <div class="question-box" id="question-text">Preparando pergunta mágica...</div>
                        <div class="options-list" id="options-container"></div>
                        <div class="powerups-bar"><button class="power-btn" id="btn-5050" onclick="quizAPI.usePowerUp('5050')" title="Elimina 2 erradas">✂️ 50/50</button><button class="power-btn" id="btn-skip" onclick="quizAPI.usePowerUp('skip')" title="Pula pergunta">⏭️ Pular</button></div>
                    </div>
                    <div id="screen-end" class="quiz-screen">
                        <h1 style="color:var(--gold);">FIM DE JOGO!</h1><div class="winner-text" id="winner-display"></div>
                        <div class="score-board"><div class="result-row"><span style="color:var(--p1)">Jogador 1</span><span id="final-p1">0 pts</span></div><div class="result-row" id="final-row-p2"><span style="color:var(--p2)">Jogador 2</span><span id="final-p2">0 pts</span></div><div class="result-row"><span>Total de Perguntas</span><span id="final-total">15</span></div></div>
                        <div style="display:flex;gap:15px;width:100%;justify-content:center;"><button class="btn-restart" onclick="quizAPI.returnToMenu()">🔄 Rejogar</button><button class="btn-restart secondary" onclick="quizAPI.returnToMenu()">⬅ Menu</button></div>
                    </div>
                </div></div>`;
            
            // --- SUPER PACK DE PERGUNTAS (150+ Perguntas Únicas) ---
            const database={
                biblia:[
                    {q:"Quem construiu a Arca?",opt:["Moisés","Noé","Abraão","Davi"],a:1},{q:"Quem derrotou o gigante Golias?",opt:["Sansão","Salomão","Davi","Saul"],a:2},{q:"Qual o primeiro livro da Bíblia?",opt:["Mateus","Gênesis","Êxodo","Apocalipse"],a:1},{q:"Quem foi engolido por um grande peixe?",opt:["Jonas","Pedro","Paulo","Elias"],a:0},{q:"Onde Jesus nasceu?",opt:["Nazaré","Jerusalém","Belém","Roma"],a:2},{q:"Quem traiu Jesus?",opt:["Pedro","Judas Iscariotes","Tomé","Lucas"],a:1},{q:"Quantos mandamentos foram dados a Moisés?",opt:["7","10","12","5"],a:1},{q:"Quem abriu o Mar Vermelho?",opt:["Noé","Elias","Moisés","Josué"],a:2},{q:"Qual a mãe de Jesus?",opt:["Marta","Maria","Isabel","Rute"],a:1},{q:"Rei conhecido por sua sabedoria?",opt:["Davi","Saul","Salomão","Herodes"],a:2},{q:"Quantos discípulos tinha Jesus?",opt:["10","11","12","13"],a:2},{q:"Quem foi lançado na cova dos leões?",opt:["Daniel","José","Samuel","Isaías"],a:0},{q:"Esposa de Isaque?",opt:["Sara","Rebeca","Raquel","Lia"],a:1},{q:"Quem negou Jesus 3 vezes?",opt:["João","Judas","Pedro","Tiago"],a:2},{q:"Primeiro milagre de Jesus?",opt:["Andar sobre águas","Cura do cego","Água em Vinho","Ressurreição"],a:2},
                    {q:"Quem foi o primeiro homem?",opt:["Abel","Caim","Adão","Noé"],a:2},{q:"Quem foi a esposa de Abraão?",opt:["Sara","Rebeca","Raquel","Lia"],a:0},{q:"Quem escreveu o Apocalipse?",opt:["Paulo","Pedro","João","Lucas"],a:2},{q:"Cidade destruída por fogo e enxofre?",opt:["Jericó","Sodoma","Nínive","Babilônia"],a:1},{q:"O que Davi usou para matar Golias?",opt:["Espada","Lança","Funda e Pedra","Arco e Flecha"],a:2},{q:"Quem foi vendido pelos irmãos como escravo?",opt:["José","Benjamim","Judá","Rúben"],a:0},{q:"Qual mar Jesus acalmou a tempestade?",opt:["Mar Morto","Mar Vermelho","Mar da Galileia","Mar Mediterrâneo"],a:2},{q:"Quem subiu aos céus numa carruagem de fogo?",opt:["Eliseu","Elias","Enoque","Isaías"],a:1},{q:"Quem era irmão de Moisés?",opt:["Arão","Josué","Calebe","Hur"],a:0},{q:"Quantos dias e noites choveu no dilúvio?",opt:["7","40","150","100"],a:1},
                    {q:"Qual é o livro mais longo da Bíblia?",opt:["Gênesis","Salmos","Isaías","Apocalipse"],a:1},{q:"Quem lutou com um anjo?",opt:["Moisés","Jacó","Abraão","Pedro"],a:1},{q:"O que significa o nome Emanuel?",opt:["Deus é amor","Deus conosco","Deus salvou","Luz do mundo"],a:1},{q:"Quem foi o homem mais forte da Bíblia?",opt:["Davi","Golias","Sansão","Gideão"],a:2},{q:"Qual profeta foi alimentado por corvos?",opt:["Elias","Eliseu","Samuel","Jonas"],a:0},
                    {q:"Onde Adão e Eva viveram?",opt:["Jardim do Éden","Canaã","Egito","Ur"],a:0},{q:"Quem batizou Jesus?",opt:["Pedro","João Batista","Tiago","Paulo"],a:1},{q:"Qual o menor livro da Bíblia?",opt:["2 João","3 João","Judas","Obadias"],a:0},{q:"Quem escreveu a maior parte do Novo Testamento?",opt:["Pedro","João","Paulo","Lucas"],a:2},{q:"Quantas pragas foram enviadas ao Egito?",opt:["7","10","12","5"],a:1},{q:"Quem era o rei da Babilônia?",opt:["Ciro","Dario","Nabucodonosor","Xerxes"],a:2},{q:"O que Sansão não podia cortar?",opt:["Unhas","Cabelo","Barba","Sobrancelhas"],a:1},{q:"Qual o nome da esposa de Moisés?",opt:["Zípora","Miriam","Raabe","Rute"],a:0},{q:"Quem viu a sarça ardente?",opt:["Abraão","Jacó","Moisés","Josué"],a:2},{q:"Onde Jesus transformou água em vinho?",opt:["Nazaré","Caná","Jericó","Betânia"],a:1}
                ],
                frutas:[
                    {q:"Qual fruta é a 'proibida' nas lendas?",opt:["Pera","Maçã","Uva","Figo"],a:1},{q:"Fruta amarela e curva?",opt:["Banana","Melão","Pera","Abacaxi"],a:0},{q:"Fruta conhecida por ter vitamina C?",opt:["Maçã","Laranja","Uva","Pêssego"],a:1},{q:"O tomate é tecnicamente...",opt:["Legume","Fruta","Verdura","Raiz"],a:1},{q:"Fruta que tem coroa mas não é rei?",opt:["Abacaxi","Romã","Coco","Morango"],a:0},{q:"Qual fruta é usada para fazer vinho?",opt:["Cereja","Ameixa","Uva","Amora"],a:2},{q:"Açaí vem de qual tipo de planta?",opt:["Palmeira","Rasteira","Arbusto","Raiz"],a:0},{q:"Qual a cor do Limão Siciliano?",opt:["Verde","Laranja","Amarelo","Vermelho"],a:2},{q:"Fruta do Conde também é chamada de?",opt:["Pinha","Jaca","Graviola","Atemoia"],a:0},{q:"O Guaraná é originário de onde?",opt:["Cerrado","Amazônia","Pampas","Caatinga"],a:1},{q:"Qual fruta tem as sementes do lado de fora?",opt:["Melancia","Morango","Manga","Goiaba"],a:1},{q:"Ameixa seca é feita de qual fruta?",opt:["Uva","Tâmara","Ameixa","Damasco"],a:2},
                    {q:"Fruta verde por fora e vermelha por dentro?",opt:["Melão","Melancia","Goiaba","Abacate"],a:1},{q:"Fruta envenenada da Branca de Neve?",opt:["Pera","Maçã","Banana","Laranja"],a:1},{q:"Fruta rica em potássio?",opt:["Banana","Limão","Maçã","Uva"],a:0},{q:"Fruta principal do guacamole?",opt:["Tomate","Abacate","Manga","Pêssego"],a:1},{q:"Fruta que é composta principalmente de água?",opt:["Banana","Melancia","Abacate","Coco"],a:1},{q:"Fruta que dá em cachos?",opt:["Uva","Melancia","Jaca","Melão"],a:0},{q:"Ameixa seca vem de qual fruta?",opt:["Ameixa","Uva","Tâmara","Figo"],a:0},{q:"O grão de café é tecnicamente uma...",opt:["Semente","Fruta","Raiz","Legume"],a:1},{q:"Fruta laranja por dentro e por fora?",opt:["Mamão","Melancia","Banana","Coco"],a:0},{q:"Fruta azeda usada na caipirinha?",opt:["Limão","Laranja","Maracujá","Abacaxi"],a:0},
                    {q:"Fruta que tem 'olhos'?",opt:["Coco","Abacaxi","Kiwi","Morango"],a:0},{q:"Qual destas é uma fruta cítrica?",opt:["Banana","Tangerina","Maçã","Pera"],a:1},{q:"A uva passa é feita de...",opt:["Ameixa","Uva","Tâmara","Damasco"],a:1},{q:"Fruta conhecida como 'fruta do dragão'?",opt:["Lichia","Pitaia","Romã","Caqui"],a:1},{q:"Qual fruta é a base do chocolate?",opt:["Cacau","Café","Coco","Cupuaçu"],a:0},
                    {q:"Fruta que 'chora' ao ser cortada?",opt:["Cebola","Limão","Jaca","Melão"],a:0},{q:"O que é o 'Coração de Bananeira'?",opt:["Fruta","Flor","Raiz","Semente"],a:1},{q:"Fruta símbolo da Nova Zelândia?",opt:["Kiwi","Maçã","Uva","Pêssego"],a:0},{q:"Qual fruta tem o nome de uma cor?",opt:["Laranja","Limão","Manga","Caju"],a:0},{q:"Azeitona é...",opt:["Legume","Verdura","Fruta","Raiz"],a:2},{q:"Fruta espinhosa por fora?",opt:["Jaca","Melancia","Manga","Banana"],a:0},{q:"Maior fruta do mundo (em árvore)?",opt:["Jaca","Melancia","Abóbora","Coco"],a:0},{q:"Fruta usada para fazer sidra?",opt:["Maçã","Uva","Pera","Pêssego"],a:0}
                ],
                carros:[
                    {q:"Marca do carro com um cavalo no logo?",opt:["Jaguar","Ferrari","Lamborghini","Peugeot"],a:1},{q:"Quem fabricava o Fusca?",opt:["Ford","Fiat","Volkswagen","Chevrolet"],a:2},{q:"O que significa ABS?",opt:["Aceleração Básica","Sistema de Freio","Airbag System","Audio Bass"],a:1},{q:"Qual país é sede da Fiat?",opt:["França","Alemanha","Itália","Espanha"],a:2},{q:"Carro famoso do filme 'De Volta para o Futuro'?",opt:["Mustang","Camaro","DeLorean","Corvette"],a:2},{q:"Símbolo da Audi tem quantas argolas?",opt:["3","4","5","2"],a:1},{q:"Combustível feito da cana-de-açúcar?",opt:["Gasolina","Diesel","Etanol","Gás"],a:2},{q:"Qual é o carro do Batman?",opt:["Batmobile","Batmóvel","Batcar","DarkRide"],a:1},{q:"País de origem da Volvo?",opt:["Suécia","Suíça","Alemanha","EUA"],a:0},{q:"Qual peça é usada para trocar marchas?",opt:["Volante","Freio","Embreagem","Acelerador"],a:2},{q:"Qual a cor clássica das Ferraris?",opt:["Amarelo","Preto","Vermelho","Azul"],a:2},{q:"Modelo de carro mais vendido da história?",opt:["Fusca","Golf","Corolla","Civic"],a:2},
                    {q:"Marca com logotipo de estrela de 3 pontas?",opt:["Mercedes-Benz","BMW","Audi","Subaru"],a:0},{q:"Carro famoso do agente 007?",opt:["Ferrari","Aston Martin","Porsche","Jaguar"],a:1},{q:"O que significa a sigla SUV?",opt:["Super Ultra Vehicle","Sport Utility Vehicle","Speed Urban Van","Street Utility Van"],a:1},{q:"Parte do carro onde se guarda a bagagem?",opt:["Porta-luvas","Capô","Porta-malas","Teto"],a:2},{q:"Líquido comum para limpar o para-brisa?",opt:["Óleo","Água com detergente","Gasolina","Fluido de freio"],a:1},{q:"Marca de luxo da Toyota?",opt:["Lexus","Infiniti","Acura","Genesis"],a:0},{q:"Um dos carros mais rápidos do mundo?",opt:["Fusca","Bugatti Veyron","Fiat Uno","Gol"],a:1},{q:"O que o tacômetro mede (RPM)?",opt:["Velocidade","Combustível","Rotações por Minuto","Temperatura"],a:2},{q:"Pedal da esquerda em carros manuais?",opt:["Freio","Acelerador","Embreagem","Descanso"],a:2},{q:"Marca famosa pelo modelo 911?",opt:["Ferrari","Porsche","Lamborghini","Bugatti"],a:1},
                    {q:"Qual empresa criou o Mustang?",opt:["Chevrolet","Dodge","Ford","Pontiac"],a:2},{q:"País de origem da marca Hyundai?",opt:["Japão","China","Coreia do Sul","Tailândia"],a:2},{q:"Símbolo de um touro dourado?",opt:["Ferrari","Porsche","Lamborghini","Maserati"],a:2},{q:"Quantos cilindros tem um motor V8?",opt:["6","8","10","12"],a:1},{q:"O que significa 'GT' em carros?",opt:["Grande Turbo","Gran Turismo","Gas Total","Gear Top"],a:1},
                    {q:"Marca que tem um leão no logotipo?",opt:["Peugeot","Jaguar","Citroën","Renault"],a:0},{q:"O que é um carro híbrido?",opt:["Só elétrico","Só gasolina","Elétrico e Combustão","Solar"],a:2},{q:"Marca famosa pelo modelo Fusca?",opt:["Ford","Fiat","VW","Toyota"],a:2},{q:"Qual peça filtra o ar do motor?",opt:["Filtro de Ar","Radiador","Carburador","Vela"],a:0},{q:"Qual a função do radiador?",opt:["Esfriar o motor","Acelerar","Frear","Ligar o rádio"],a:0},{q:"Marca de luxo da Honda?",opt:["Acura","Lexus","Infiniti","Genesis"],a:0},{q:"O que é 4x4?",opt:["4 Portas","Tração nas 4 rodas","4 Marchas","4 Passageiros"],a:1},{q:"País de origem da Rolls-Royce?",opt:["EUA","Alemanha","Reino Unido","Itália"],a:2}
                ],
                mundo:[
                    {q:"Capital da França?",opt:["Londres","Berlim","Paris","Madri"],a:2},{q:"Onde ficam as Pirâmides de Gizé?",opt:["México","Egito","Peru","China"],a:1},{q:"Moeda usada no Japão?",opt:["Dólar","Won","Iene","Yuan"],a:2},{q:"Maior país do mundo em área?",opt:["EUA","China","Brasil","Rússia"],a:3},{q:"Qual oceano banha o Brasil?",opt:["Pacífico","Índico","Atlântico","Ártico"],a:2},{q:"Quem descobriu a América?",opt:["Cabral","Colombo","Vasco da Gama","Magalhães"],a:1},{q:"Capital da Austrália?",opt:["Sydney","Melbourne","Camberra","Perth"],a:2},{q:"País conhecido pelo formato de bota?",opt:["Portugal","Espanha","Grécia","Itália"],a:3},{q:"Continente com maior número de países?",opt:["Ásia","Europa","África","América"],a:2},{q:"Presidente do Brasil que construiu Brasília?",opt:["Vargas","Kubitschek (JK)","Lula","FHC"],a:1},{q:"Onde fica a Torre de Pisa?",opt:["França","Itália","Espanha","Alemanha"],a:1},{q:"Qual é o 'Planeta Vermelho'?",opt:["Vênus","Marte","Júpiter","Saturno"],a:1},
                    {q:"Capital da Argentina?",opt:["Santiago","Buenos Aires","Lima","Bogotá"],a:1},{q:"Onde fica a Grande Muralha?",opt:["Japão","Coreia","China","Mongólia"],a:2},{q:"Maior rio do mundo em extensão?",opt:["Nilo","Amazonas","Mississippi","Yangtze"],a:1},{q:"Continente coberto de gelo?",opt:["África","Antártida","Europa","Oceania"],a:1},{q:"País famoso pelo Tango?",opt:["Brasil","Espanha","Argentina","México"],a:2},{q:"Onde fica Machu Picchu?",opt:["Brasil","Chile","Peru","Bolívia"],a:2},{q:"Capital da Rússia?",opt:["São Petersburgo","Moscou","Kiev","Minsk"],a:1},{q:"País conhecido como Terra do Sol Nascente?",opt:["China","Coreia do Sul","Japão","Tailândia"],a:2},{q:"Maior deserto quente do mundo?",opt:["Atacama","Gobi","Saara","Kalahari"],a:2},{q:"Capital da Alemanha?",opt:["Munique","Frankfurt","Berlim","Hamburgo"],a:2},
                    {q:"Qual é o menor país do mundo?",opt:["Mônaco","Vaticano","Malta","Nauru"],a:1},{q:"Em que continente fica o Egito?",opt:["Ásia","Europa","África","América"],a:2},{q:"Capital do Canadá?",opt:["Toronto","Vancouver","Ottawa","Montreal"],a:2},{q:"Monte mais alto do mundo?",opt:["K2","Everest","Kilimanjaro","Aconcágua"],a:1},{q:"País famoso pelos cangurus?",opt:["Nova Zelândia","Austrália","África do Sul","Brasil"],a:1},
                    {q:"Capital da Espanha?",opt:["Barcelona","Madri","Sevilha","Valência"],a:1},{q:"Onde fica o Taj Mahal?",opt:["Índia","Tailândia","Turquia","Paquistão"],a:0},{q:"Língua mais falada no mundo?",opt:["Inglês","Espanhol","Mandarim","Hindi"],a:2},{q:"Capital dos EUA?",opt:["Nova York","Washington D.C.","Los Angeles","Chicago"],a:1},{q:"País com formato de 'ilha comprida'?",opt:["Chile","Japão","Cuba","Itália"],a:0},{q:"Onde fica o Coliseu?",opt:["Atenas","Roma","Paris","Londres"],a:1},{q:"Rio que atravessa Londres?",opt:["Sena","Tâmisa","Danúbio","Reno"],a:1},{q:"Capital da China?",opt:["Xangai","Hong Kong","Pequim","Cantão"],a:2}
                ],
                matematica:[
                    {q:"Quanto é 7 x 8?",opt:["54","56","48","64"],a:1},{q:"Raiz quadrada de 81?",opt:["7","8","9","10"],a:2},{q:"Quantos gramas tem 1kg?",opt:["100","500","1000","10000"],a:2},{q:"Quanto é meia dúzia?",opt:["6","12","5","10"],a:0},{q:"Ângulo reto tem quantos graus?",opt:["45","90","180","360"],a:1},{q:"10% de 500 é?",opt:["5","50","100","25"],a:1},{q:"Qual é o único número primo par?",opt:["1","2","4","0"],a:1},{q:"Quanto é 15 + 15?",opt:["20","25","30","40"],a:2},{q:"Lados de um hexágono?",opt:["5","6","7","8"],a:1},{q:"Dobro de 1024?",opt:["2000","2048","2056","2100"],a:1},{q:"O que pesa mais: 1kg de chumbo ou 1kg de pena?",opt:["Chumbo","Pena","Iguais","Depende"],a:2},{q:"Resultado de 100 dividido por 4?",opt:["20","25","24","10"],a:1},
                    {q:"Quanto é 8 x 8?",opt:["64","56","72","81"],a:0},{q:"Metade de 50?",opt:["20","25","30","15"],a:1},{q:"Quanto é 100 - 35?",opt:["55","65","75","45"],a:1},{q:"Quantos lados tem um triângulo?",opt:["3","4","5","6"],a:0},{q:"Quantos minutos tem 1 hora?",opt:["100","50","60","30"],a:2},{q:"Quanto é 10 elevado a 2?",opt:["20","100","200","1000"],a:1},{q:"O algarismo romano V vale quanto?",opt:["1","5","10","50"],a:1},{q:"Próximo número primo depois do 7?",opt:["9","10","11","13"],a:2},{q:"Soma dos ângulos internos de um triângulo?",opt:["90","180","360","270"],a:1},{q:"Quanto são 3 dúzias?",opt:["24","30","36","48"],a:2},
                    {q:"Qual é o valor aproximado de Pi?",opt:["3,14","3,41","3,12","3,15"],a:0},{q:"Quanto é 5 fatorial (5!)?",opt:["120","60","24","100"],a:0},{q:"Raiz quadrada de 144?",opt:["10","11","12","14"],a:2},{q:"Triplo de 15?",opt:["30","45","60","50"],a:1},{q:"Qual número não é primo?",opt:["2","3","5","9"],a:3},
                    {q:"Quanto é 9 x 9?",opt:["81","72","64","90"],a:0},{q:"Quantos lados tem um pentágono?",opt:["4","5","6","7"],a:1},{q:"Metade de 250?",opt:["100","120","125","150"],a:2},{q:"1/2 em porcentagem?",opt:["25%","50%","75%","100%"],a:1},{q:"Quanto é 12 x 12?",opt:["124","134","144","154"],a:2},{q:"Soma de 1 a 5 (1+2+3+4+5)?",opt:["10","15","20","25"],a:1},{q:"Qual é o cubo de 2?",opt:["4","6","8","10"],a:2},{q:"Ângulo de uma volta completa?",opt:["180","270","360","90"],a:2}
                ]
            };
            let state={mode:'solo',questions:[],currentIdx:0,p1:{score:0,combo:0,powerups:{'5050':true,'skip':true}},p2:{score:0,combo:0,powerups:{'5050':true,'skip':true}},turn:1,timer:null,timeLeft:30,maxTime:30};
            const quizAPI={
                setMode:(m)=>{state.mode=m; container.querySelector('#btn-solo').classList.toggle('selected',m==='solo'); container.querySelector('#btn-duo').classList.toggle('selected',m==='duo');},
                startGame:(cat)=>{
                    state.p1={score:0,combo:0,powerups:{'5050':true,'skip':true}}; state.p2={score:0,combo:0,powerups:{'5050':true,'skip':true}};
                    state.currentIdx=0; state.turn=1;
                    let list=[]; if(cat==='geral') Object.values(database).forEach(arr=>list.push(...arr)); else list=database[cat]||[];
                    // CORRIGIDO: Embaralha TODAS as perguntas do banco e pega as primeiras 15.
                    // Isso garante que cada jogo tenha um conjunto diferente de perguntas.
                    state.questions=list.sort(()=>Math.random()-0.5).slice(0, 15); 
                    container.querySelector('#hud-p2').style.display=state.mode==='duo'?'block':'none'; container.querySelector('#final-row-p2').style.display=state.mode==='duo'?'flex':'none';
                    quizAPI.switchScreen('screen-game'); quizAPI.updateHUD(); quizAPI.nextQuestion();
                },
                switchScreen:(id)=>{container.querySelectorAll('.quiz-screen').forEach(s=>s.classList.remove('active'));container.querySelector('#'+id).classList.add('active');},
                returnToMenu:()=>{clearInterval(state.timer); quizAPI.switchScreen('screen-menu');},
                nextQuestion:()=>{
                    if(state.currentIdx>=state.questions.length){quizAPI.endGame();return;}
                    state.timeLeft=state.maxTime; quizAPI.startTimer(); quizAPI.updateTurnUI(); quizAPI.updatePowerUpButtons();
                    const q=state.questions[state.currentIdx]; container.querySelector('#question-text').innerText=q.q;
                    const div=container.querySelector('#options-container'); div.innerHTML='';
                    q.opt.forEach((txt,i)=>{
                        const btn=document.createElement('button'); btn.className='option-btn'; btn.innerText=txt; btn.setAttribute('data-index',["A","B","C","D"][i]); btn.setAttribute('id','opt-'+i);
                        btn.onclick=()=>quizAPI.answer(i,btn); div.appendChild(btn);
                    });
                },
                startTimer:()=>{
                    clearInterval(state.timer); const bar=container.querySelector('#timer-bar'), txt=container.querySelector('#timer-text');
                    bar.className='timer-fill'; bar.style.width='100%'; bar.style.backgroundColor='var(--timer-ok)';
                    state.timer=setInterval(()=>{
                        state.timeLeft--; const pct=(state.timeLeft/state.maxTime)*100; bar.style.width=pct+'%'; txt.innerText=state.timeLeft+'s';
                        if(state.timeLeft<=10) bar.style.backgroundColor='var(--timer-warn)';
                        if(state.timeLeft<=5){bar.style.backgroundColor='var(--timer-critical)';bar.classList.add('timer-critical');}
                        if(state.timeLeft<=0) quizAPI.timeOut();
                    },1000);
                },
                timeOut:()=>{clearInterval(state.timer); quizAPI.playSound('wrong'); const p=state.turn===1?state.p1:state.p2; p.combo=0; const cIdx=state.questions[state.currentIdx].a; container.querySelectorAll('.option-btn')[cIdx].classList.add('correct'); container.querySelectorAll('.option-btn').forEach(b=>b.disabled=true); quizAPI.shakeScreen(); setTimeout(()=>quizAPI.advanceTurn(),2000);},
                answer:(idx,btn)=>{
                    clearInterval(state.timer); const q=state.questions[state.currentIdx], isCorrect=(idx===q.a), p=state.turn===1?state.p1:state.p2;
                    container.querySelectorAll('.option-btn').forEach(b=>b.disabled=true);
                    if(isCorrect){ btn.classList.add('correct'); quizAPI.playSound('correct'); p.combo++; let pts=100+(state.timeLeft*2); if(p.combo>1) pts+=(p.combo*50); p.score+=Math.floor(pts); }
                    else { btn.classList.add('wrong'); quizAPI.playSound('wrong'); p.combo=0; container.querySelector('#opt-'+q.a).classList.add('correct'); quizAPI.shakeScreen(); }
                    quizAPI.updateHUD(); setTimeout(()=>quizAPI.advanceTurn(),2000);
                },
                advanceTurn:()=>{ if(state.mode==='duo') state.turn=state.turn===1?2:1; state.currentIdx++; quizAPI.nextQuestion(); },
                usePowerUp:(type)=>{
                    const p=state.turn===1?state.p1:state.p2; if(!p.powerups[type]) return;
                    quizAPI.playSound('powerup'); p.powerups[type]=false; quizAPI.updatePowerUpButtons();
                    if(type==='skip'){clearInterval(state.timer); const fb=document.createElement('div'); fb.innerText="PULOU!"; fb.style.cssText="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:3rem;color:var(--gold);font-weight:bold;text-shadow:0 0 10px black;z-index:100;"; container.querySelector('#quiz-main-container').appendChild(fb); setTimeout(()=>{fb.remove();quizAPI.advanceTurn();},1000);}
                    else if(type==='5050'){const q=state.questions[state.currentIdx], w=[0,1,2,3].filter(i=>i!==q.a).sort(()=>Math.random()-0.5).slice(0,2); w.forEach(idx=>{const el=container.querySelector('#opt-'+idx); if(el){el.style.opacity='0';el.disabled=true;}});}
                },
                updatePowerUpButtons:()=>{const p=state.turn===1?state.p1:state.p2; container.querySelector('#btn-5050').disabled=!p.powerups['5050']; container.querySelector('#btn-skip').disabled=!p.powerups['skip'];},
                updateHUD:()=>{container.querySelector('#score-p1').innerText=state.p1.score; container.querySelector('#score-p2').innerText=state.p2.score; const c1=container.querySelector('#combo-p1'), c2=container.querySelector('#combo-p2'); if(state.p1.combo>1){c1.innerText=`COMBO x${state.p1.combo} 🔥`;c1.classList.add('visible');}else c1.classList.remove('visible'); if(state.p2.combo>1){c2.innerText=`COMBO x${state.p2.combo} 🔥`;c2.classList.add('visible');}else c2.classList.remove('visible');},
                updateTurnUI:()=>{const h1=container.querySelector('#hud-p1'), h2=container.querySelector('#hud-p2'); if(state.mode==='duo'){if(state.turn===1){h1.classList.add('active');h2.classList.remove('active');}else{h1.classList.remove('active');h2.classList.add('active');}}else h1.classList.add('active');},
                shakeScreen:()=>{const c=container.querySelector('#quiz-main-container'); c.classList.add('shake-anim'); setTimeout(()=>c.classList.remove('shake-anim'),500);},
                endGame:()=>{
                    clearInterval(state.timer); quizAPI.switchScreen('screen-end');
                    container.querySelector('#final-p1').innerText=state.p1.score; container.querySelector('#final-p2').innerText=state.p2.score; container.querySelector('#final-total').innerText=state.questions.length;
                    const wd=container.querySelector('#winner-display');
                    if(state.mode==='duo'){if(state.p1.score>state.p2.score){wd.innerText="🏆 JOGADOR 1 VENCEU!";wd.style.color="var(--p1)";}else if(state.p2.score>state.p1.score){wd.innerText="🏆 JOGADOR 2 VENCEU!";wd.style.color="var(--p2)";}else{wd.innerText="🤝 EMPATE ÉPICO!";wd.style.color="#fff";}}else{wd.innerText="FIM DA JORNADA!";wd.style.color="var(--gold)";}
                },
                playSound:(t)=>{try{const now=Tone.now(); if(t==='correct'){const o=new Tone.Oscillator(600,"triangle").toDestination().start(now).stop(now+0.5);o.frequency.rampTo(1200,0.1);}else if(t==='wrong'){const o=new Tone.Oscillator(150,"sawtooth").toDestination().start(now).stop(now+0.4);o.frequency.rampTo(80,0.3);}else if(t==='powerup'){const o=new Tone.Oscillator(800,"sine").toDestination().start(now).stop(now+0.3);o.frequency.rampTo(1500,0.2);}}catch(e){}}
            };
            window.quizAPI=quizAPI; return ()=>{if(state.timer)clearInterval(state.timer); window.quizAPI=undefined;};
        }

        // =================================================================
        // JOGO 6: AERO STRIKER ULTIMATE
        // =================================================================
        function initAeroStriker(container) {
            // Estilos específicos do Aero Striker (Scoped ID)
            const css = `
                <style>
                    #aero-game-wrapper {
                        background-color: #050510; color: #00ffff; font-family: 'Courier New', Courier, monospace;
                        display: flex; flex-direction: column; align-items: center; justify-content: center;
                        width: 100%; height: 100%; overflow: hidden; user-select: none; -webkit-user-select: none; touch-action: none;
                        position: relative;
                    }
                    #aero-h1 { text-transform: uppercase; text-shadow: 0 0 10px #00ffff; margin: 5px 0; font-size: 18px; text-align: center; letter-spacing: 2px; z-index: 10; }
                    #aero-game-container {
                        position: relative; box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); border: 2px solid #00ffff;
                        background-color: #001111; width: 95vw; max-width: 450px; height: auto; aspect-ratio: 3/4;
                        overflow: hidden; touch-action: none; margin: 0 auto;
                    }
                    #aero-gameCanvas { display: block; background-color: transparent; width: 100%; height: 100%; }
                    #aero-game-container::after {
                        content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
                        background: repeating-linear-gradient(transparent 0px, transparent 2px, rgba(0, 0, 0, 0.4) 3px, rgba(0, 0, 0, 0.4) 4px);
                        pointer-events: none; z-index: 2;
                    }
                    #aero-ui { margin-top: 5px; text-align: center; font-size: 12px; color: #ccffff; width: 95vw; max-width: 450px; display: flex; justify-content: space-between; margin: 5px auto; }
                    #aero-mobile-controls {
                        display: flex; width: 100%; max-width: 450px; justify-content: space-between; padding: 10px 20px;
                        box-sizing: border-box; margin-top: 15px; margin-bottom: 20px; align-items: center; margin-left: auto; margin-right: auto;
                    }
                    .aero-d-pad-container { position: relative; width: 140px; height: 140px; opacity: 0.8; }
                    .aero-d-btn {
                        position: absolute; width: 45px; height: 45px; background-color: rgba(0, 60, 60, 0.6);
                        border: 2px solid #00ffff; color: #00ffff; display: flex; align-items: center; justify-content: center;
                        font-size: 24px; border-radius: 8px; cursor: pointer;
                    }
                    .aero-d-btn:active { background-color: rgba(0, 255, 255, 0.4); transform: scale(0.95); }
                    #aero-btn-up { top: 0; left: 47px; } #aero-btn-down { bottom: 0; left: 47px; }
                    #aero-btn-left { top: 47px; left: 0; } #aero-btn-right { top: 47px; right: 0; }
                    .aero-btn-fire {
                        width: 80px; height: 80px; background-color: rgba(60, 0, 0, 0.6); border: 3px solid #ff3333;
                        border-radius: 50%; color: #ff3333; display: flex; align-items: center; justify-content: center;
                        font-size: 24px; font-weight: bold; box-shadow: 0 0 15px rgba(255, 51, 51, 0.4); cursor: pointer;
                    }
                    .aero-btn-fire:active { background-color: rgba(255, 51, 51, 0.6); transform: scale(0.95); }
                    .aero-tutorial-text { font-size: 10px; color: #888; margin-top: 5px; text-align: center; width: 100%; }
                </style>
            `;

            container.innerHTML = css + `
                <div id="aero-game-wrapper">
                    <h1 id="aero-h1">AERO STRIKER</h1>
                    <div id="aero-ui">
                        <span>SCORE: <span id="aero-score">0</span></span>
                        <span>HIGH: <span id="aero-high">0</span></span>
                        <span>VIDAS: <span id="aero-lives">3</span></span>
                    </div>
                    <div id="aero-game-container">
                        <canvas id="aero-gameCanvas" width="450" height="600"></canvas>
                    </div>
                    <div class="aero-tutorial-text">ARRASTE O DEDO NA TELA PARA MOVER</div>
                    <div id="aero-mobile-controls">
                        <div class="aero-d-pad-container">
                            <div class="aero-d-btn" id="aero-btn-up">▲</div>
                            <div class="aero-d-btn" id="aero-btn-left">◄</div>
                            <div class="aero-d-btn" id="aero-btn-right">►</div>
                            <div class="aero-d-btn" id="aero-btn-down">▼</div>
                        </div>
                        <div class="aero-btn-fire" id="aero-btn-fire">TIRO</div>
                    </div>
                </div>
            `;

            const canvas = container.querySelector('#aero-gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreEl = container.querySelector('#aero-score');
            const livesEl = container.querySelector('#aero-lives');
            const highEl = container.querySelector('#aero-high');

            let gameState = 'playing';
            let score = 0;
            let highScore = localStorage.getItem('aero_highscore') || 0;
            highEl.innerText = highScore;
            let lives = 3, frameCount = 0, powerLevel = 1;
            let boss = null, nextBossScore = 1000, enemyBullets = [];
            let bullets = [], enemies = [], particles = [], stars = [], powerups = [];
            let animationId;
            let audioCtx = null;

            function initAudio() {
                try {
                    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    if (audioCtx.state === 'suspended') audioCtx.resume();
                } catch (e) {}
            }

            function playSound(type) {
                if (!audioCtx) initAudio();
                if (!audioCtx || audioCtx.state === 'suspended') return;
                try {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    const now = audioCtx.currentTime;
                    if (type === 'shoot') {
                        osc.type = 'triangle';
                        let freq = powerLevel === 1 ? 600 : (powerLevel === 2 ? 500 : 400);
                        osc.frequency.setValueAtTime(freq, now);
                        osc.frequency.linearRampToValueAtTime(freq/2, now + 0.1);
                        gain.gain.setValueAtTime(0.08, now);
                        gain.gain.linearRampToValueAtTime(0, now + 0.1);
                        osc.start(now); osc.stop(now + 0.1);
                    } else if (type === 'explosion') {
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(100, now);
                        osc.frequency.exponentialRampToValueAtTime(10, now + 0.4);
                        gain.gain.setValueAtTime(0.2, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                        osc.start(now); osc.stop(now + 0.4);
                    } else if (type === 'powerup') {
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(400, now);
                        osc.frequency.linearRampToValueAtTime(1200, now + 0.3);
                        gain.gain.setValueAtTime(0.1, now);
                        gain.gain.linearRampToValueAtTime(0, now + 0.3);
                        osc.start(now); osc.stop(now + 0.3);
                    } else if (type === 'boss_hit') {
                        osc.type = 'square';
                        osc.frequency.setValueAtTime(150, now);
                        gain.gain.setValueAtTime(0.1, now);
                        gain.gain.linearRampToValueAtTime(0, now + 0.1);
                        osc.start(now); osc.stop(now + 0.1);
                    }
                } catch (e) {}
            }

            const player = {
                x: canvas.width / 2 - 20, y: canvas.height - 80, w: 40, h: 40, speed: 5, color: '#00ffff',
                draw: function() {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x + 18, this.y, 4, 40);
                    ctx.fillRect(this.x, this.y + 20, 40, 8);
                    ctx.fillRect(this.x + 12, this.y + 34, 16, 4);
                    ctx.fillStyle = '#ff3333'; ctx.fillRect(this.x + 18, this.y + 38, 4, 4);
                    if (powerLevel >= 2) { ctx.fillStyle = '#ffff00'; ctx.fillRect(this.x + 4, this.y + 20, 4, 10); ctx.fillRect(this.x + 32, this.y + 20, 4, 10); }
                }
            };

            function initStars() {
                stars = [];
                for(let i=0; i<50; i++) stars.push({x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2, speed: 1 + Math.random() * 3});
            }

            const keys = { ArrowUp:false, ArrowDown:false, ArrowLeft:false, ArrowRight:false, ' ':false };
            const handleKeyDown = e => { if(keys.hasOwnProperty(e.key)) keys[e.key] = true; if(e.key === ' ') fireBullet(); };
            const handleKeyUp = e => { if(keys.hasOwnProperty(e.key)) keys[e.key] = false; };
            
            const setupTouchBtn = (id, k) => {
                const el = container.querySelector('#' + id);
                const hStart = (e) => { e.preventDefault(); keys[k] = true; initAudio(); };
                const hEnd = (e) => { e.preventDefault(); keys[k] = false; };
                el.addEventListener('touchstart', hStart, {passive:false});
                el.addEventListener('touchend', hEnd, {passive:false});
                el.addEventListener('mousedown', hStart);
                el.addEventListener('mouseup', hEnd);
            };

            const fireHandler = (e)=>{ e.preventDefault(); if(gameState==='gameover') resetGame(); else fireBullet(); initAudio(); };
            const dragHandler = (e) => {
                e.preventDefault(); if(gameState !== 'playing') return;
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                let touchX = (touch.clientX - rect.left) * scaleX;
                let touchY = (touch.clientY - rect.top) * scaleY;
                player.x = touchX - player.w / 2;
                player.y = touchY - player.h - 20; 
                if(player.x < 0) player.x = 0; if(player.x > canvas.width - player.w) player.x = canvas.width - player.w;
                if(player.y < 0) player.y = 0; if(player.y > canvas.height - player.h) player.y = canvas.height - player.h;
            };

            function spawnBoss() {
                boss = { x: canvas.width / 2 - 60, y: -120, w: 120, h: 100, hp: 50 + (score / 50), maxHp: 50 + (score / 50), dx: 2, dy: 1, state: 'entering' };
                enemies.forEach(e => createExplosion(e.x+e.w/2, e.y+e.h/2)); enemies = [];
            }
            function spawnEnemy() {
                if (boss) return; 
                const size = 30;
                enemies.push({x: Math.random()*(canvas.width-size), y: -size, w: size, h: size, speed: 3+Math.random()*2+(score*0.001), type: Math.random()>0.8?'fast':'normal'});
            }
            function fireBullet() {
                if(gameState !== 'playing') return;
                if(bullets.length > 20) return;
                if (powerLevel === 1) bullets.push({x: player.x+18, y:player.y, w:4, h:10, speed:10, vx:0});
                else if (powerLevel === 2) { bullets.push({x: player.x+5, y:player.y+10, w:4, h:10, speed:10, vx:0}); bullets.push({x: player.x+31, y:player.y+10, w:4, h:10, speed:10, vx:0}); }
                else { bullets.push({x: player.x+18, y:player.y, w:6, h:12, speed:10, vx:0}); bullets.push({x: player.x+5, y:player.y+10, w:4, h:10, speed:9, vx:-1.5}); bullets.push({x: player.x+31, y:player.y+10, w:4, h:10, speed:9, vx:1.5}); }
                playSound('shoot');
            }
            function bossLogic() {
                if (!boss) return;
                if (boss.state === 'entering') { boss.y += 2; if (boss.y >= 50) boss.state = 'fighting'; }
                else {
                    boss.x += boss.dx; if (boss.x <= 0 || boss.x + boss.w >= canvas.width) boss.dx *= -1;
                    if (Math.random() < 0.05) enemyBullets.push({x: boss.x + boss.w/2, y: boss.y + boss.h, w: 8, h: 8, vx: (Math.random()-0.5)*4, vy: 5});
                }
                ctx.fillStyle = '#aa0000'; ctx.fillRect(boss.x + 20, boss.y, boss.w - 40, boss.h); 
                ctx.fillStyle = '#ff0000'; ctx.fillRect(boss.x, boss.y + 20, boss.w, 40); 
                ctx.fillStyle = '#ffff00'; ctx.fillRect(boss.x + 30, boss.y + 60, 10, 10); ctx.fillRect(boss.x + boss.w - 40, boss.y + 60, 10, 10);
                ctx.fillStyle = '#333'; ctx.fillRect(boss.x, boss.y - 10, boss.w, 5);
                ctx.fillStyle = '#0f0'; ctx.fillRect(boss.x, boss.y - 10, boss.w * (boss.hp / boss.maxHp), 5);
                for (let i = bullets.length - 1; i >= 0; i--) {
                    if (!boss) break;
                    let b = bullets[i];
                    if (b.x > boss.x && b.x < boss.x + boss.w && b.y > boss.y && b.y < boss.y + boss.h) {
                        boss.hp--; bullets.splice(i, 1); playSound('boss_hit'); createExplosion(b.x, b.y, '#fff');
                        if (boss.hp <= 0) {
                            createExplosion(boss.x + boss.w/2, boss.y + boss.h/2, '#ff0000', 50);
                            score += 500; scoreEl.innerText = score; nextBossScore += 1000;
                            spawnPowerUp(boss.x + boss.w/2, boss.y + boss.h/2); boss = null; playSound('explosion'); break; 
                        }
                    }
                }
            }
            function createExplosion(x, y, color='#ffaa00', count=10) { for(let i=0; i<count; i++) particles.push({x: x, y: y, vx: (Math.random()-0.5)*8, vy: (Math.random()-0.5)*8, life: 30+Math.random()*10, color: color}); }
            function spawnPowerUp(x, y) { powerups.push({x:x, y:y, w:20, h:20, speed:2}); }
            function checkRectCollision(r1, r2) { return (r1.x < r2.x + r2.w && r1.x + r1.w > r2.x && r1.y < r2.y + r2.h && r1.y + r1.h > r2.y); }
            function hitPlayer() { lives--; livesEl.innerText = lives; powerLevel = 1; playSound('explosion'); if(lives <= 0) gameOver(); }
            function gameOver() {
                gameState = 'gameover';
                if (score > highScore) { highScore = score; localStorage.setItem('aero_highscore', highScore); highEl.innerText = highScore; }
            }
            function resetGame() {
                score = 0; lives = 3; powerLevel = 1; scoreEl.innerText = score; livesEl.innerText = lives;
                enemies = []; bullets = []; particles = []; powerups = []; enemyBullets = [];
                boss = null; nextBossScore = 1000; player.x = canvas.width/2 - 20; player.y = canvas.height - 80;
                gameState = 'playing';
            }
            function update() {
                if(gameState !== 'playing') {
                    if(gameState === 'gameover') {
                        ctx.fillStyle = 'rgba(0,0,0,0.8)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#f33'; ctx.textAlign = 'center'; ctx.font = 'bold 40px Courier New'; ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2);
                        ctx.fillStyle = '#fff'; ctx.font = '16px Courier New'; ctx.fillText('Toque no TIRO para Reiniciar', canvas.width/2, canvas.height/2 + 40); ctx.textAlign = 'start';
                    }
                    animationId = requestAnimationFrame(update); return;
                }
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#fff'; stars.forEach(s => { s.y += s.speed; if(s.y > canvas.height) s.y = 0; ctx.fillRect(s.x, s.y, s.size, s.size); });
                if (keys.ArrowUp && player.y > 0) player.y -= player.speed;
                if (keys.ArrowDown && player.y < canvas.height - player.h) player.y += player.speed;
                if (keys.ArrowLeft && player.x > 0) player.x -= player.speed;
                if (keys.ArrowRight && player.x < canvas.width - player.w) player.x += player.speed;
                player.draw();
                if (!boss && score >= nextBossScore) spawnBoss();
                bossLogic(); frameCount++; if(frameCount % 40 === 0) spawnEnemy();
                for(let i=enemies.length-1; i>=0; i--) {
                    let e = enemies[i]; e.y += e.speed;
                    const mainC = e.type==='fast'?'#f0f':'#f33';
                    ctx.fillStyle = mainC; ctx.fillRect(e.x, e.y, 5, e.h-15); ctx.fillRect(e.x+e.w-5, e.y, 5, e.h-15); 
                    ctx.fillStyle = '#800'; ctx.fillRect(e.x+5, e.y, e.w-10, e.h-10); ctx.fillStyle = '#111'; ctx.fillRect(e.x+10, e.y+10, e.w-20, 10); 
                    ctx.fillStyle = '#0f0'; ctx.fillRect(e.x+12, e.y+12, 4, 4); ctx.fillRect(e.x+e.w-16, e.y+12, 4, 4); ctx.fillStyle = mainC; ctx.beginPath(); ctx.moveTo(e.x+5, e.y+e.h-10); ctx.lineTo(e.x+e.w/2, e.y+e.h); ctx.lineTo(e.x+e.w-5, e.y+e.h-10); ctx.fill(); 
                    if(checkRectCollision(player, e)) { hitPlayer(); createExplosion(e.x+e.w/2, e.y+e.h/2); enemies.splice(i, 1); continue; }
                    for(let j=bullets.length-1; j>=0; j--) {
                        let b = bullets[j];
                        if(checkRectCollision(b, e)) { createExplosion(e.x+e.w/2, e.y+e.h/2); if(Math.random()<0.1) spawnPowerUp(e.x, e.y); enemies.splice(i, 1); bullets.splice(j, 1); score += e.type==='fast'?50:20; scoreEl.innerText = score; playSound('explosion'); break; }
                    }
                    if(e.y > canvas.height) enemies.splice(i, 1);
                }
                ctx.fillStyle = '#ffaa00';
                for(let i=enemyBullets.length-1; i>=0; i--) { let eb = enemyBullets[i]; eb.x += eb.vx; eb.y += eb.vy; ctx.fillRect(eb.x, eb.y, eb.w, eb.h); if(checkRectCollision(player, eb)) { hitPlayer(); enemyBullets.splice(i, 1); createExplosion(player.x, player.y); continue; } if(eb.y > canvas.height) enemyBullets.splice(i, 1); }
                ctx.fillStyle = '#ff0';
                for(let i=bullets.length-1; i>=0; i--) { let b = bullets[i]; b.y -= b.speed; if(b.vx) b.x += b.vx; ctx.fillRect(b.x, b.y, b.w, b.h); if(b.y < 0 || b.x < 0 || b.x > canvas.width) bullets.splice(i, 1); }
                for(let i=powerups.length-1; i>=0; i--) { let p = powerups[i]; p.y += p.speed; ctx.fillStyle = frameCount%20<10?'#ff0':'#f00'; ctx.fillRect(p.x, p.y, p.w, p.h); ctx.fillStyle='#000'; ctx.font='bold 16px Courier New'; ctx.fillText("P", p.x+5, p.y+16); if(checkRectCollision(player, p)) { if(powerLevel<3) powerLevel++; score+=100; scoreEl.innerText=score; playSound('powerup'); powerups.splice(i, 1); } else if (p.y > canvas.height) powerups.splice(i, 1); }
                for(let i=particles.length-1; i>=0; i--) { let p = particles[i]; p.x += p.vx; p.y += p.vy; p.life--; ctx.fillStyle = p.color; ctx.globalAlpha = p.life/30; ctx.fillRect(p.x, p.y, 4, 4); ctx.globalAlpha = 1; if(p.life<=0) particles.splice(i,1); }
                animationId = requestAnimationFrame(update);
            }

            // Inicia Listeners
            window.addEventListener('keydown', handleKeyDown);
            window.addEventListener('keyup', handleKeyUp);
            setupTouchBtn('aero-btn-up', 'ArrowUp');
            setupTouchBtn('aero-btn-down', 'ArrowDown');
            setupTouchBtn('aero-btn-left', 'ArrowLeft');
            setupTouchBtn('aero-btn-right', 'ArrowRight');
            const bFire = container.querySelector('#aero-btn-fire');
            bFire.addEventListener('touchstart', fireHandler, {passive:false});
            bFire.addEventListener('mousedown', fireHandler);
            canvas.addEventListener('touchmove', dragHandler, {passive:false});

            initStars();
            update();

            // Cleanup Function
            return () => {
                cancelAnimationFrame(animationId);
                window.removeEventListener('keydown', handleKeyDown);
                window.removeEventListener('keyup', handleKeyUp);
                if (audioCtx) audioCtx.close();
            };
        }

        const nameDatabase = { 
            // --- TÍTULOS DE JESUS E DEUS (Seu pedido especial) ---
            "jesus": "Yahweh Salva. Títulos: Cristo, Emanuel, Cordeiro de Deus, Leão de Judá, Luz do Mundo.",
            "yeshua": "Salvação. Nome hebraico original de Jesus.",
            "cristo": "O Ungido (do grego Christós). Título real e sacerdotal de Jesus.",
            "messias": "O Ungido (do hebraico Mashiach). O libertador prometido.",
            "emanuel": "Deus conosco. Título profético de Jesus (Isaías 7:14).",
            "cordeiro": "Símbolo do sacrifício perfeito de Jesus (Cordeiro de Deus).",
            "leão": "Símbolo de realeza e poder (Leão da Tribo de Judá).",
            "alfa": "O Princípio. Primeira letra do alfabeto grego (título de Cristo).",
            "ômega": "O Fim. Última letra do alfabeto grego (título de Cristo).",
            "nazareno": "Aquele que é de Nazaré ou 'O Consagrado' (Netzer: Ramo).",
            "redentor": "Aquele que resgata, que paga a dívida.",
            "salvador": "Aquele que salva do perigo ou pecado.",
            "rabi": "Mestre, Grande Mestre (título dado a Jesus).",
            "adonai": "Meu Senhor (título reverente a Deus).",
            "elohim": "Deus (Plural de majestade, o Criador Poderoso).",
            "jeová": "Eu Sou o que Sou (transliteração de YHWH).",
            "yahweh": "O Eterno, Aquele que É (Nome pessoal de Deus).",
            "aba": "Pai, Paizinho (expressão de intimidade com Deus).",
            "shalom": "Paz, integridade, bem-estar completo.",
            "hosana": "Salva-nos agora! (Grito de louvor).",
            "maranata": "O Senhor Vem! (Vem, Senhor Jesus).",

            // --- LISTA GERAL DE A a Z ---
            
            // A
            "aarão": "O iluminado, montanhês ou inspirado.",
            "abel": "Sopro, respiração, efêmero.",
            "abigail": "Alegria do pai.",
            "abner": "Pai da luz.",
            "abraão": "Pai de multidões.",
            "ada": "Ornamento, beleza.",
            "adão": "Homem, terra vermelha (humanidade).",
            "adriel": "Rebanho de Deus.",
            "ágata": "Boa, bondosa.",
            "alan": "Pedra, rocha ou harmonia.",
            "alana": "Bela, harmoniosa.",
            "alice": "De linhagem nobre, verdadeira.",
            "aline": "Nobre, protetora.",
            "amanda": "Digna de ser amada.",
            "amélia": "Trabalhadora, diligente.",
            "ana": "Cheia de graça e compaixão.",
            "andré": "Viril, corajoso (primeiro discípulo chamado).",
            "anita": "Graciosa.",
            "anthony": "De valor inestimável.",
            "antonella": "Valiosa.",
            "antônio": "Digno de apreço.",
            "aquiles": "Lábios finos ou espírito de vida.",
            "arthur": "Urso corajoso, nobre.",
            "augusto": "Sagrado, consagrado.",
            "aurora": "O nascer do sol.",
            "ayla": "Luz da lua, carvalho.",

            // B
            "bárbara": "Estrangeira.",
            "bartolomeu": "Filho do agricultor.",
            "beatriz": "A que traz felicidade.",
            "bela": "Formosa, pura.",
            "benício": "Abençoado, homem bom.",
            "benjamin": "Filho da felicidade (Mão direita).",
            "bento": "Abençoado, louvado.",
            "bernardo": "Forte como um urso.",
            "betina": "Promessa de Deus.",
            "bianca": "Branca, pura.",
            "breno": "Chefe, líder.",
            "bruna": "Morena, protegida.",
            "bruno": "Marrom, protegido.",

            // C
            "caio": "Alegre, feliz.",
            "calebe": "Leal, fiel como um cão, de todo coração.",
            "camila": "Mensageira perfeita.",
            "carlos": "Homem livre, guerreiro.",
            "carolina": "Doce, mulher do povo.",
            "catarina": "Pura, casta.",
            "cauã": "Gavião (origem Tupi).",
            "cecília": "Sábia, guardiã dos músicos.",
            "césar": "Imperador.",
            "clara": "Brilhante, luminosa.",
            "clarice": "A que é brilhante.",
            "cláudio": "Coxeante (perseverante).",
            "cristiano": "Seguidor de Cristo.",
            "cristina": "Ungida por Deus.",

            // D
            "daniel": "Deus é meu juiz.",
            "daniela": "Deus é meu juiz.",
            "danilo": "Deus é meu juiz.",
            "davi": "Amado, predileto (Rei de Israel).",
            "débora": "Abelha (trabalhadora e doce).",
            "diego": "Aquele que ensina.",
            "diogo": "Aquele que doutrina.",
            "douglas": "Águas escuras.",

            // E
            "eduardo": "Guardião das riquezas.",
            "elena": "Tocha, luz.",
            "elias": "O Senhor é o meu Deus (Profeta de Fogo).",
            "elisa": "Promessa divina.",
            "elisabete": "Deus é juramento.",
            "eliseu": "Deus é salvação (Sucessor de Elias).",
            "eloá": "Deus.",
            "emanuela": "Deus conosco.",
            "emília": "Rival, zelosa.",
            "enzo": "Senhor do lar, príncipe.",
            "erick": "Líder eterno.",
            "esther": "Estrela (Rainha que salvou seu povo).",
            "ester": "Estrela, secreta.",
            "estevão": "Coroado (Primeiro mártir).",
            "eva": "Mãe da vida, a que vive.",
            "ezequiel": "Deus fortalece.",

            // F
            "fabiana": "Prosperidade (fava).",
            "fábio": "Prosperidade.",
            "felipe": "Amigo dos cavalos (Guerreiro).",
            "fernanda": "Ousada pela paz.",
            "fernando": "Ousado pela paz.",
            "flávia": "Dourada.",
            "francisco": "Homem livre.",
            "frederico": "Príncipe da paz.",

            // G
            "gabriel": "Fortaleza de Deus (Arcanjo mensageiro).",
            "gabriela": "Mulher forte de Deus.",
            "gael": "Belo e generoso.",
            "george": "Trabalhador da terra.",
            "giovanna": "Deus é gracioso.",
            "giovanni": "Deus é gracioso.",
            "guilherme": "Protetor decidido.",
            "gustavo": "Protegido por Deus.",

            // H
            "heitor": "Aquele que guarda.",
            "helena": "A reluzente.",
            "heloísa": "Guerreira famosa.",
            "henrique": "Senhor do lar.",
            "hugo": "Mente, espírito.",

            // I
            "iago": "Aquele que suplanta.",
            "igor": "Guerreiro do senhor.",
            "inácio": "Ardente.",
            "isaac": "Ele ri (Filho da promessa).",
            "isabel": "Deus é juramento.",
            "isabela": "Consagrada a Deus.",
            "isadora": "Dádiva de Ísis.",
            "isaías": "Salvação do Senhor.",
            "isaque": "Riso, alegria.",
            "isis": "Dona do trono.",
            "israel": "O que luta com Deus (Nome de Jacó).",
            "ícaro": "Seguidor.",

            // J
            "jacó": "Aquele que segura o calcanhar (Suplantador).",
            "jade": "Pedra preciosa.",
            "jaime": "Aquele que suplanta.",
            "jair": "Ele ilumina.",
            "jean": "Deus é cheio de graça.",
            "jeremias": "O Senhor exalta (Profeta chorão).",
            "jessica": "Deus contempla.",
            "joana": "Deus é gracioso.",
            "joão": "Deus é misericordioso.",
            "joaquim": "Jeová estabeleceu.",
            "jonas": "Pomba (Símbolo de paz/espírito).",
            "jonathan": "Dádiva de Deus.",
            "jorge": "Trabalhador da terra.",
            "josé": "Deus acrescentará (Sonhador).",
            "josué": "Deus é salvação (Sucessor de Moisés).",
            "judas": "Louvado (Apesar do traidor, é nome de tribo).",
            "julia": "Cheia de juventude.",
            "juliana": "Jovem.",
            "júlio": "Jovem.",

            // K
            "kauã": "Gavião.",
            "kelly": "Guerreira.",
            "kevin": "Amado.",

            // L
            "laís": "A popular.",
            "lara": "Da cidadela.",
            "larissa": "Adorável.",
            "laura": "Vitoriosa.",
            "lavínia": "Pureza.",
            "lázaro": "Deus ajudou.",
            "leandro": "Homem-leão.",
            "leonardo": "Valente como leão.",
            "letícia": "Alegria.",
            "levi": "Unido, ligado (Tribo sacerdotal).",
            "lívia": "Clara, pálida.",
            "liz": "Juramento de Deus.",
            "lorena": "Guerreira famosa.",
            "lorenzo": "Vitorioso.",
            "luan": "Guerreiro ou Lua.",
            "luana": "Guerreira gloriosa.",
            "lucas": "Luminoso (Médico amado).",
            "lúcia": "Luminosa.",
            "luciano": "Nascido na luz.",
            "luís": "Guerreiro glorioso.",
            "luiz": "Guerreiro famoso.",
            "luiza": "Guerreira gloriosa.",
            "luna": "Lua.",

            // M
            "madalena": "Da cidade de Magdala (Torre).",
            "maitê": "Amada.",
            "manuela": "Deus conosco.",
            "marcela": "Pequena guerreira.",
            "marcelo": "Pequeno guerreiro.",
            "marcos": "Guerreiro (Autor do Evangelho).",
            "maria": "Soberana, pura, amada de Deus.",
            "mariana": "Soberana cheia de graça.",
            "marina": "A que vem do mar.",
            "mário": "Homem viril.",
            "marta": "Senhora, dona de casa.",
            "mateus": "Dom de Deus (Publicano).",
            "matheus": "Dádiva de Deus.",
            "maurício": "Mouro.",
            "maya": "Água, mãe.",
            "melissa": "Abelha.",
            "micael": "Quem é como Deus?",
            "michel": "Quem é como Deus?",
            "miguel": "Quem é como Deus? (Arcanjo guerreiro).",
            "milena": "Querida.",
            "mirella": "Admirável.",
            "moisés": "Tirado das águas.",
            "murilo": "Pequeno muro.",

            // N
            "natália": "Nascimento (Natal).",
            "natan": "Dádiva (Profeta).",
            "natanael": "Deus deu.",
            "nicolas": "Vitorioso.",
            "nicole": "Vencedora com o povo.",
            "nina": "Graciosa.",
            "noah": "Descanso, conforto (Noé).",
            "noé": "Repouso, consolação.",

            // O
            "olívia": "Azeitona (Paz).",
            "olavo": "Sobrevivente.",
            "otávio": "O oitavo.",

            // P
            "patrícia": "Nobre.",
            "paula": "Pequena.",
            "paulo": "Pequeno (Apóstolo dos gentios).",
            "pedro": "Rocha, Pedra (Cefas).",
            "pietra": "Pedra.",
            "pietro": "Pedra.",
            "priscila": "Antiga, venerável.",

            // R
            "rafael": "Deus cura (Arcanjo).",
            "rafaela": "Deus cura.",
            "raimundo": "Conselheiro.",
            "raquel": "Ovelha mansa.",
            "raul": "Lobo combatente.",
            "ravi": "Sol.",
            "rebeca": "A que une, laço.",
            "renan": "Amigo.",
            "renata": "Renascida.",
            "renato": "Renascido.",
            "ricardo": "Rei forte.",
            "rita": "Pérola.",
            "roberta": "Gloriosa.",
            "roberto": "Famoso.",
            "rodrigo": "Governante famoso.",
            "rogério": "Lança famosa.",
            "romeu": "Peregrino.",
            "rosa": "Bela flor.",
            "rute": "Amiga fiel.",

            // S
            "sabrina": "Princesa.",
            "samuel": "Do nome de Deus / Ouvido por Deus.",
            "sandra": "Protetora.",
            "santiago": "Santo Tiago.",
            "sarah": "Princesa.",
            "saulo": "Desejado (Antigo nome de Paulo).",
            "sebastião": "Venerável.",
            "sérgio": "Guardião.",
            "silas": "Da floresta.",
            "sofia": "Sabedoria.",
            "sophia": "Sabedoria.",
            "stella": "Estrela.",
            "suzana": "Lírio.",

            // T
            "tainá": "Estrela.",
            "talita": "Menina, levanta-te.",
            "tatiane": "Do pai.",
            "teresa": "Colhedora.",
            "thales": "Florescer.",
            "theo": "Deus.",
            "thiago": "Aquele que suplanta.",
            "thomas": "Gêmeo.",
            "tiago": "O que vem do calcanhar.",
            "timóteo": "O que honra a Deus.",
            "tobias": "Deus é bom.",

            // V
            "valentina": "Valente, saudável.",
            "valéria": "Forte.",
            "vanessa": "Borboleta.",
            "vera": "Verdadeira.",
            "vicente": "Vencedor.",
            "vinícius": "Voz agradável.",
            "vitor": "Vencedor.",
            "vitória": "Vencedora.",
            "viviane": "Viva.",

            // W, Y, Z
            "wagner": "Construtor.",
            "walter": "Comandante.",
            "wellington": "Do lugar próspero.",
            "wesley": "Do prado oeste.",
            "william": "Protetor.",
            "yasmin": "Jasmim.",
            "yuri": "Luz de Deus.",
            "zacarias": "Deus lembrou.",
            "zara": "Flor.",
            "zoe": "Vida."
        };

        function formatarEMV(id, value) { const length = ('00' + value.length).slice(-2); return `${id}${length}${value}`; }
        function simplificarTexto(text) { return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\s]/g, ''); }
        function crc16(data) { let crc = 0xFFFF; for (let i = 0; i < data.length; i++) { crc ^= data.charCodeAt(i) << 8; for (let j = 0; j < 8; j++) { crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1; } } return ('0000' + (crc & 0xFFFF).toString(16).toUpperCase()).slice(-4); }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, Component } = React;

        // --- DADOS E CONFIGURAÇÕES ---
        const NAV_ITEMS = [
            { id: 'home', label: 'Início', icon: 'fa-home' },
            { id: 'bible', label: 'Bíblia', icon: 'fa-book-bible' },
            { id: 'financial', label: 'Financeiro', icon: 'fa-sack-dollar' },
            { id: 'studio', label: 'Estúdio', icon: 'fa-wand-magic-sparkles' },
            { id: 'games', label: 'Jogos', icon: 'fa-gamepad' },
            { id: 'preaching', label: 'Pregação', icon: 'fa-person-chalkboard' },
            { id: 'names', label: 'Nomes', icon: 'fa-signature' },
            { id: 'qrcode', label: 'QR Code', icon: 'fa-qrcode' },
            { id: 'radio', label: 'Rádio', icon: 'fa-radio' },
            { id: 'notes', label: 'Diário', icon: 'fa-book-open' }
        ];

        const GAMES_LIST = [
            { id: 'damas', label: 'Damas', icon: 'fa-chess-board', color: 'bg-blue-900', text: 'text-blue-400' },
            { id: 'forca', label: 'Forca', icon: 'fa-font', color: 'bg-red-900', text: 'text-red-400' },
            { id: 'memoria', label: 'Memória', icon: 'fa-brain', color: 'bg-yellow-900', text: 'text-yellow-400' },
            { id: 'velha', label: 'Velha', icon: 'fa-times', color: 'bg-green-900', text: 'text-green-400' },
            { id: 'quiz', label: 'Quiz', icon: 'fa-question', color: 'bg-purple-900', text: 'text-purple-400' },
            { id: 'aero', label: 'Aero Striker', icon: 'fa-fighter-jet', color: 'bg-cyan-900', text: 'text-cyan-400' }
        ];

        const BIBLE_BOOKS = [
            "Gênesis", "Êxodo", "Levítico", "Números", "Deuteronômio", "Josué", "Juízes", "Rute", "1 Samuel", "2 Samuel", "1 Reis", "2 Reis", "1 Crônicas", "2 Crônicas", "Esdras", "Neemias", "Ester", "Jó", "Salmos", "Provérbios", "Eclesiastes", "Cânticos", "Isaías", "Jeremias", "Lamentações", "Ezequiel", "Daniel", "Oseias", "Joel", "Amós", "Obadias", "Jonas", "Miqueias", "Naum", "Habacuque", "Sofonias", "Ageu", "Zacarias", "Malaquias", 
            "Mateus", "Marcos", "Lucas", "João", "Atos", "Romanos", "1 Coríntios", "2 Coríntios", "Gálatas", "Efésios", "Filipenses", "Colossenses", "1 Tessalonicenses", "2 Tessalonicenses", "1 Timóteo", "2 Timóteo", "Tito", "Filemom", "Hebreus", "Tiago", "1 Pedro", "2 Pedro", "1 João", "2 João", "3 João", "Judas", "Apocalipse"
        ];

        // --- UTILITÁRIOS ---
        const icons = {
            'dollar-sign': <><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></>,
            'pie-chart': <><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></>,
            'edit-2': <><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></>,
            'trash-2': <><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>,
            'plus': <><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>,
            'refresh-cw': <><path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path></>,
            'lock': <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></>,
            'file-text': <><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></>,
            'check': <polyline points="20 6 9 17 4 12"></polyline>,
            'calculator': <><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="14"></line><line x1="8" y1="14" x2="8" y2="14"></line><line x1="12" y1="14" x2="12" y2="14"></line><line x1="8" y1="18" x2="8" y2="18"></line><line x1="12" y1="18" x2="12" y2="18"></line><line x1="16" y1="18" x2="16" y2="18"></line></>,
            'x': <><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></>
        };

        const IconWrapper = ({ name, size = 16, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={{ display: 'inline-block', verticalAlign: 'middle' }}>
                {icons[name] || null}
            </svg>
        );

        function usePersistentState(key, initialValue) {
            const [state, setState] = useState(() => {
                try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : initialValue; } catch { return initialValue; }
            });
            useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch {} }, [key, state]);
            return [state, setState];
        }

        // --- COMPONENTES DAS 4 ABAS NOVAS ---
        
        // 1. ABA NOMES
        const NamesScreen = ({ onBack }) => {
            const [inputName, setInputName] = usePersistentState('userInputName', '');
            const [nameResult, setNameResult] = useState(null);

            return (
                <div className="max-w-2xl mx-auto space-y-6 animate-fadeIn p-4">
                    <button onClick={onBack} className="text-red-600 font-bold flex items-center gap-2 text-sm"><i className="fas fa-arrow-left"></i> Voltar</button>
                    <div className="bg-white p-8 rounded-xl shadow-lg text-center">
                        <h2 className="text-2xl font-bold mb-4 text-red-800"><i className="fas fa-signature"></i> Significado dos Nomes</h2>
                        <div className="flex gap-2">
                            <input type="text" value={inputName} onChange={(e)=>setInputName(e.target.value)} className="flex-1 p-3 border rounded shadow-inner" placeholder="Ex: Lucas, Maria..." />
                            <button onClick={()=>{
                                const res = nameDatabase[inputName.toLowerCase().trim()];
                                setNameResult(res ? {name: inputName, meaning: res} : {name: inputName, meaning: "O Senhor conhece o seu nome e tem um propósito glorioso para a sua vida!"});
                            }} className="bg-red-800 text-white px-6 rounded font-bold hover:bg-red-900 transition-colors">Ver</button>
                        </div>
                    </div>
                    {nameResult && <div className="bg-white p-6 rounded-xl border-l-4 border-yellow-500 shadow animate-fadeIn"><h3 className="font-bold text-lg mb-2 capitalize">{nameResult.name}</h3><p className="italic text-gray-700">{nameResult.meaning}</p></div>}
                </div>
            );
        };

        // 2. ABA QR CODE
        const QRCodeScreen = ({ onBack }) => {
            const [qrUrl, setQrUrl] = usePersistentState('qrUrl', '');
            const [qrWifiSsid, setQrWifiSsid] = usePersistentState('qrWifiSsid', '');
            const [qrWifiPass, setQrWifiPass] = usePersistentState('qrWifiPass', '');
            const [qrPixKey, setQrPixKey] = usePersistentState('qrPixKey', '');
            const [qrPixName, setQrPixName] = usePersistentState('qrPixName', '');
            const [qrPixCity, setQrPixCity] = usePersistentState('qrPixCity', '');
            const [qrPixAmount, setQrPixAmount] = usePersistentState('qrPixAmount', '');
            const qrCodeRef = useRef(null);

            const gerarQR = (text) => {
                if(!qrCodeRef.current) return;
                qrCodeRef.current.innerHTML = '';
                new QRCode(qrCodeRef.current, { text, width: 200, height: 200, colorDark: "#000000", colorLight: "#ffffff", correctLevel: QRCode.CorrectLevel.H });
            };

            const handleGerarPix = () => {
                if (!qrPixKey || !qrPixName || !qrPixCity) return alert("Preencha a chave, nome e cidade.");
                const info = [formatarEMV('00', 'br.gov.bcb.pix'), formatarEMV('01', qrPixKey)].join('');
                let brCode = [formatarEMV('00', '01'), formatarEMV('26', info), formatarEMV('52', '0000'), formatarEMV('53', '986')];
                if(qrPixAmount) brCode.push(formatarEMV('54', parseFloat(qrPixAmount).toFixed(2)));
                brCode.push(formatarEMV('58', 'BR'), formatarEMV('59', simplificarTexto(qrPixName).substring(0,25)), formatarEMV('60', simplificarTexto(qrPixCity).substring(0,15)), formatarEMV('62', formatarEMV('05', '***')), '6304');
                const stringPIX = brCode.join('');
                gerarQR(stringPIX + crc16(stringPIX));
            };

            return (
                <div className="max-w-4xl mx-auto space-y-6 animate-fadeIn p-4">
                    <button onClick={onBack} className="text-red-600 font-bold flex items-center gap-2 text-sm"><i className="fas fa-arrow-left"></i> Voltar</button>
                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="bg-white p-6 rounded-2xl shadow border-t-4 border-red-800 space-y-4">
                            <h3 className="font-bold flex items-center gap-2 text-red-800"><i className="fas fa-link"></i> Endereço Web</h3>
                            <input type="text" value={qrUrl} onChange={e=>setQrUrl(e.target.value)} placeholder="https://..." className="w-full p-3 border rounded shadow-inner" />
                            <button onClick={()=>gerarQR(qrUrl)} className="w-full bg-red-800 text-white py-3 rounded-xl font-bold hover:bg-red-900 shadow-md">Criar Código</button>
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow border-t-4 border-blue-600 space-y-4">
                            <h3 className="font-bold flex items-center gap-2 text-blue-800"><i className="fas fa-wifi"></i> Wi-Fi Direto</h3>
                            <div className="grid grid-cols-2 gap-2"><input type="text" value={qrWifiSsid} onChange={e=>setQrWifiSsid(e.target.value)} placeholder="Rede" className="p-2 border rounded" /><input type="password" value={qrWifiPass} onChange={e=>setQrWifiPass(e.target.value)} placeholder="Senha" className="p-2 border rounded" /></div>
                            <button onClick={()=>gerarQR(`WIFI:T:WPA;S:${qrWifiSsid};P:${qrWifiPass};;`)} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 shadow-md">Gerar Wi-Fi</button>
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow border-t-4 border-green-600 space-y-4 md:col-span-2">
                            <h3 className="font-bold flex items-center gap-2 text-green-800"><i className="fas fa-qrcode"></i> Pagamento PIX (Brasil)</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                <input type="text" value={qrPixKey} onChange={e=>setQrPixKey(e.target.value)} placeholder="Chave" className="p-2 border rounded text-xs" /><input type="text" value={qrPixName} onChange={e=>setQrPixName(e.target.value)} placeholder="Nome" className="p-2 border rounded text-xs" /><input type="text" value={qrPixCity} onChange={e=>setQrPixCity(e.target.value)} placeholder="Cidade" className="p-2 border rounded text-xs" /><input type="number" value={qrPixAmount} onChange={e=>setQrPixAmount(e.target.value)} placeholder="Valor" className="p-2 border rounded text-xs" />
                            </div>
                            <button onClick={handleGerarPix} className="w-full bg-green-700 text-white py-3 rounded-xl font-bold hover:bg-green-800 shadow-md">Criar Código PIX</button>
                        </div>
                    </div>
                    <div className="bg-white p-12 rounded-3xl shadow-xl flex flex-col items-center border border-gray-50"><div ref={qrCodeRef} className="border-8 border-gray-50 p-4 bg-white shadow-inner rounded-xl"></div><p className="mt-6 text-[10px] text-gray-400 uppercase font-bold tracking-[0.2em]">Digitalize para usar</p></div>
                </div>
            );
        };

        // 3. ABA RÁDIO
        const RadioScreen = ({ onBack }) => {
            const [isPlayingRadio, setIsPlayingRadio] = useState(false);
            const audioRef = useRef(null);

            return (
                <div className="max-w-xl mx-auto bg-gray-900 text-white p-12 rounded-[3rem] shadow-2xl text-center animate-fadeIn border border-gray-800 mt-6">
                    <button onClick={onBack} className="text-gray-400 font-bold flex items-center gap-2 text-sm mb-6"><i className="fas fa-arrow-left"></i> Voltar</button>
                    <div className="mb-12"><i className="fas fa-radio text-yellow-400 text-[100px] mx-auto animate-pulse"></i></div>
                    <h2 className="text-3xl font-bold mb-3">Rádio Gospel</h2><p className="text-gray-400 text-sm mb-12 uppercase tracking-widest font-inter">Louvores e Adoração 24h</p>
                    <div className="flex justify-center items-end gap-1 mb-12 h-16">{isPlayingRadio ? [...Array(6)].map((_,i)=><div key={i} className="sound-bar" style={{animationDuration: `${0.4 + Math.random()}s`, width: '8px'}}></div>) : <div className="h-1 w-40 bg-gray-800 rounded-full"></div>}</div>
                    <button onClick={()=>{if(isPlayingRadio) audioRef.current.pause(); else audioRef.current.play(); setIsPlayingRadio(!isPlayingRadio);}} className={`w-24 h-24 rounded-full flex items-center justify-center mx-auto shadow-xl transition-all transform hover:scale-110 active:scale-95 ${isPlayingRadio?'bg-yellow-400 text-gray-900':'bg-red-600 text-white'}`}><i className={`fas ${isPlayingRadio ? 'fa-stop' : 'fa-play'}`} style={{fontSize: '45px'}}></i></button>
                    <audio ref={audioRef} src="https://live.hunter.fm/gospel_stream?ag=mp3" crossOrigin="anonymous"></audio>
                </div>
            );
        };

        // 4. ABA DIÁRIO
        const DiaryScreen = ({ onBack }) => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [diaryEntries, setDiaryEntries] = usePersistentState('diary', {});
            const [diarySearchTerm, setDiarySearchTerm] = useState('');
            const [showToast, setShowToast] = useState(false);

            const formatDateKey = (date) => date.toISOString().split('T')[0];

            const exportDiary = () => {
                let content = "DIÁRIO DE ORAÇÃO - SISTEMA VIDA\n\n";
                Object.keys(diaryEntries).sort().forEach(date => {
                    content += `DATA: ${date}\n-------------------\n${diaryEntries[date]}\n\n`;
                });
                const blob = new Blob([content], { type: "text/plain" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `meu_diario_vida_${formatDateKey(new Date())}.txt`;
                link.click();
            };

            const diarySearchResults = useMemo(() => {
                if (!diarySearchTerm.trim()) return [];
                return Object.keys(diaryEntries)
                    .filter(date => diaryEntries[date].toLowerCase().includes(diarySearchTerm.toLowerCase()))
                    .map(date => ({ date, text: diaryEntries[date] }))
                    .sort((a,b) => b.date.localeCompare(a.date));
            }, [diarySearchTerm, diaryEntries]);

            return (
                <div className="max-w-5xl mx-auto space-y-8 animate-fadeIn p-4">
                    {showToast && (
                        <div className="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-2xl z-[100] animate-fadeIn flex items-center gap-2">
                            <i className="fas fa-check-circle"></i> <span>Guardado com sucesso!</span>
                        </div>
                    )}
                    <button onClick={onBack} className="text-red-600 font-bold flex items-center gap-2 text-sm"><i className="fas fa-arrow-left"></i> Voltar</button>
                    
                    <div className="grid md:grid-cols-12 gap-8">
                        {/* Lateral: Pesquisa e Histórico */}
                        <div className="md:col-span-4 space-y-6">
                            <div className="bg-white p-6 rounded-3xl shadow-lg border border-gray-100">
                                <h4 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"><i className="fas fa-search"></i> Pesquisar Notas</h4>
                                <input 
                                    type="text" 
                                    value={diarySearchTerm} 
                                    onChange={(e)=>setDiarySearchTerm(e.target.value)} 
                                    placeholder="Palavra-chave..." 
                                    className="w-full p-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-red-100 outline-none text-sm"
                                />
                            </div>

                            {diarySearchTerm && (
                                <div className="bg-white p-6 rounded-3xl shadow-lg border border-gray-100 max-h-[400px] overflow-y-auto space-y-4">
                                    <h4 className="text-xs font-bold text-red-800 uppercase tracking-widest mb-2">Resultados ({diarySearchResults.length})</h4>
                                    {diarySearchResults.map(res => (
                                        <div key={res.date} onClick={()=>{setCurrentDate(new Date(res.date)); setDiarySearchTerm('');}} className="p-3 bg-red-50 rounded-xl cursor-pointer hover:bg-red-100 transition-colors">
                                            <p className="text-[10px] font-bold text-red-800 mb-1">{new Date(res.date).toLocaleDateString('pt-PT')}</p>
                                            <p className="text-xs text-gray-600 line-clamp-2">{res.text}</p>
                                        </div>
                                    ))}
                                    {diarySearchResults.length === 0 && <p className="text-xs text-gray-400 italic">Nada encontrado.</p>}
                                </div>
                            )}

                            <div className="bg-gradient-to-br from-red-800 to-red-900 p-8 rounded-[2rem] text-white shadow-xl">
                                <h3 className="text-xl font-bold mb-2">Meu Legado</h3>
                                <p className="text-xs opacity-75 mb-6">Total de {Object.keys(diaryEntries).length} dias registados.</p>
                                <button onClick={exportDiary} className="w-full bg-white/10 hover:bg-white/20 p-4 rounded-2xl border border-white/20 font-bold text-sm transition-all flex items-center justify-center gap-3">
                                    <i className="fas fa-download"></i> Exportar Diário
                                </button>
                            </div>
                        </div>

                        {/* Área de Escrita Principal */}
                        <div className="md:col-span-8 bg-white p-10 rounded-[3rem] shadow-2xl space-y-8 border border-gray-100 relative">
                            <div className="flex justify-between items-center bg-gray-50 p-6 rounded-[2rem] border border-gray-100">
                                <button onClick={()=>{const d=new Date(currentDate); d.setDate(d.getDate()-1); setCurrentDate(d);}} className="p-3 border rounded-full bg-white shadow-sm hover:bg-gray-100 transition-all active:scale-90"><i className="fas fa-chevron-left"></i></button>
                                <div className="text-center">
                                    <h3 className="font-bold text-red-900 text-xl capitalize">{currentDate.toLocaleDateString('pt-PT', { weekday: 'long', day: 'numeric', month: 'long' })}</h3>
                                    <p className="text-[10px] text-gray-400 uppercase font-bold tracking-[0.2em] mt-2">Oração e Reflexão</p>
                                </div>
                                <button onClick={()=>{const d=new Date(currentDate); d.setDate(d.getDate()+1); setCurrentDate(d);}} className="p-3 border rounded-full bg-white shadow-sm hover:bg-gray-100 transition-all active:scale-90"><i className="fas fa-chevron-right"></i></button>
                            </div>
                            
                            <div className="relative group">
                                <textarea 
                                    value={diaryEntries[formatDateKey(currentDate)] || ""} 
                                    onChange={(e)=>setDiaryEntries({...diaryEntries, [formatDateKey(currentDate)]: e.target.value})}
                                    className="w-full h-[500px] p-10 border border-gray-100 rounded-[2.5rem] font-handwriting text-2xl focus:ring-8 focus:ring-red-50 outline-none resize-none shadow-inner leading-relaxed bg-[#fdfdfd] text-gray-700 placeholder-gray-300" 
                                    placeholder="Querido Pai Celestial, no dia de hoje eu..."
                                ></textarea>
                                <div className="absolute bottom-6 right-8 text-[10px] font-bold text-gray-300 uppercase tracking-widest">
                                    {(diaryEntries[formatDateKey(currentDate)] || "").length} caracteres
                                </div>
                            </div>

                            <div className="flex justify-between items-center px-4">
                                <p className="text-[10px] text-gray-400 italic">"Escreve a visão e torna-a bem legível..." Habacuque 2:2</p>
                                <button onClick={()=>{setShowToast(true); setTimeout(()=>setShowToast(false), 2000);}} className="bg-red-800 text-white px-10 py-3 rounded-full font-bold shadow-xl hover:bg-red-900 flex items-center gap-3 transition-all hover:scale-105 active:scale-95"><i className="fas fa-save"></i> Guardar Agora</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- COMPONENTES FINANCEIROS ---
        class ErrorBoundary extends Component {
            constructor(props) { super(props); this.state = { hasError: false }; }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            render() { if (this.state.hasError) return <div className="p-4 text-center text-red-800">Erro no módulo. Recarregue.</div>; return this.props.children; }
        }

        const DraggableCalculator = ({ onClose }) => {
            const [position, setPosition] = useState({ x: 20, y: 100 });
            const [isDragging, setIsDragging] = useState(false);
            const [rel, setRel] = useState({ x: 0, y: 0 });
            const [display, setDisplay] = useState('0');
            const [expression, setExpression] = useState('');

            const handleMouseDown = (e) => {
                if(e.target.closest('button')) return;
                setIsDragging(true);
                setRel({ x: (e.pageX || e.touches[0].pageX) - position.x, y: (e.pageY || e.touches[0].pageY) - position.y });
            };

            useEffect(() => {
                const handleMove = (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const pageX = e.pageX || (e.touches ? e.touches[0].pageX : 0);
                    const pageY = e.pageY || (e.touches ? e.touches[0].pageY : 0);
                    setPosition({ x: pageX - rel.x, y: pageY - rel.y });
                };
                const handleUp = () => setIsDragging(false);
                if (isDragging) {
                    window.addEventListener('mousemove', handleMove); window.addEventListener('mouseup', handleUp);
                    window.addEventListener('touchmove', handleMove, {passive: false}); window.addEventListener('touchend', handleUp);
                }
                return () => {
                    window.removeEventListener('mousemove', handleMove); window.removeEventListener('mouseup', handleUp);
                    window.removeEventListener('touchmove', handleMove); window.removeEventListener('touchend', handleUp);
                };
            }, [isDragging, rel]);

            const handleBtnClick = (val) => {
                if (val === 'C') { setDisplay('0'); setExpression(''); }
                else if (val === '=') {
                    try { const res = eval(expression.replace(/x/g, '*').replace(/%/g, '/100')); setDisplay(String(res)); setExpression(String(res)); }
                    catch { setDisplay('Erro'); setExpression(''); }
                } else {
                    const next = (display === '0' || display === 'Erro' ? '' : expression) + val;
                    setExpression(next); setDisplay(next);
                }
            };

            const buttons = ['C', '(', ')', '/', '7', '8', '9', 'x', '4', '5', '6', '-', '1', '2', '3', '+', '0', '.', '%', '='];

            return (
                <div className="fixed z-[60] bg-gray-900 rounded-xl shadow-2xl overflow-hidden border border-gray-700" style={{ left: position.x, top: position.y, width: '260px', touchAction: 'none' }}>
                    <div onMouseDown={handleMouseDown} onTouchStart={handleMouseDown} className="bg-gray-800 p-2 cursor-move flex justify-between items-center"><span className="text-gray-400 text-xs font-bold flex items-center gap-2"><IconWrapper name="calculator"/> Calc</span><button onClick={onClose} className="text-red-400"><IconWrapper name="x"/></button></div>
                    <div className="p-4 bg-gray-900 text-right"><div className="text-3xl text-white font-mono truncate">{display}</div></div>
                    <div className="grid grid-cols-4 gap-1 p-2 bg-gray-800">{buttons.map((btn, i) => <button key={i} onClick={() => handleBtnClick(btn)} className={`p-3 rounded font-bold text-lg ${btn === '=' ? 'bg-orange-500 text-white' : btn === 'C' ? 'bg-red-900 text-red-100' : 'bg-gray-700 text-white'}`}>{btn}</button>)}</div>
                </div>
            );
        };

        const SimplePieChart = ({ data, onSliceClick }) => {
            const validData = data.filter(d => d.value > 0);
            const total = validData.reduce((acc, item) => acc + item.value, 0);
            if (total === 0) return <div className="text-center text-gray-400 p-4 text-sm">Sem dados gráficos</div>;
            
            let cumulativeAngle = 0;
            return (
                <div className="flex flex-col items-center bg-white p-6 rounded-xl shadow border border-gray-100 mt-4 mb-4">
                    <h3 className="font-bold text-gray-700 mb-4 flex items-center gap-2"><IconWrapper name="pie-chart" className="text-purple-500"/> Distribuição</h3>
                    <div className="relative w-40 h-40">
                        <svg viewBox="-1 -1 2 2" style={{ transform: 'rotate(-90deg)', width: '100%', height: '100%' }}>
                            {validData.map((slice, index) => {
                                const startAngle = cumulativeAngle;
                                const sliceAngle = (slice.value / total) * 2 * Math.PI;
                                cumulativeAngle += sliceAngle;
                                const x1 = Math.cos(startAngle), y1 = Math.sin(startAngle);
                                const x2 = Math.cos(startAngle + sliceAngle), y2 = Math.sin(startAngle + sliceAngle);
                                const largeArcFlag = sliceAngle > Math.PI ? 1 : 0;
                                const pathData = validData.length === 1 ? null : `M 0 0 L ${x1} ${y1} A 1 1 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;
                                return validData.length === 1 ? 
                                    <circle key={index} cx="0" cy="0" r="1" fill={slice.color} onClick={() => onSliceClick && onSliceClick(slice.label)}/> : 
                                    <path key={index} d={pathData} fill={slice.color} stroke="white" strokeWidth="0.05" onClick={() => onSliceClick && onSliceClick(slice.label)}/>;
                            })}
                        </svg>
                    </div>
                    <div className="mt-4 w-full grid grid-cols-1 gap-2">
                        {data.map((item, i) => (
                            <div key={i} className="flex items-center justify-between p-2 rounded bg-gray-50 text-xs" onClick={() => onSliceClick && onSliceClick(item.label)}>
                                <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full" style={{backgroundColor: item.color}}></div><span className="text-gray-600 font-bold">{item.label}</span></div>
                                <span className="font-bold text-gray-800">R$ {item.value.toFixed(2)}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const FinancialApp = ({ onBack }) => {
            const [view, setView] = useState('transactions'); 
            const [showCalc, setShowCalc] = useState(false);
            const [financialEntries, setFinancialEntries] = usePersistentState('financialEntries_v4', []);
            const [userAssets, setUserAssets] = usePersistentState('userAssets_v3', []);
            const [userLoans, setUserLoans] = usePersistentState('userLoans_v3', []);
            const [userCards, setUserCards] = usePersistentState('userCards_v3', []);
            const [userInvestments, setUserInvestments] = usePersistentState('userInvestments_v1', []);
            const [userDebts, setUserDebts] = usePersistentState('userDebts_v3', []); 
            const [expandedCardId, setExpandedCardId] = useState(null);
            const [historyFilter, setHistoryFilter] = useState('all'); 
            const [editingId, setEditingId] = useState(null); 
            const [appPassword, setAppPassword] = usePersistentState('appPassword', ''); 
            const [isLocked, setIsLocked] = useState(false); 
            const [pinInput, setPinInput] = useState(''); 
            const [newPasswordInput, setNewPasswordInput] = useState(''); 
            const [finForm, setFinForm] = useState({ date: new Date().toISOString().split('T')[0], desc: '', value: '', type: 'expense', category: 'Outros', method: 'Dinheiro', installments: 1, cardId: '' });
            const [assetForm, setAssetForm] = useState({ name: '', value: '' });
            const [loanForm, setLoanForm] = useState({ name: '', desc: '', value: '', date: '' });
            const [cardForm, setCardForm] = useState({ name: '', limit: '', dueDay: '' });
            const [investmentForm, setInvestmentForm] = useState({ type: 'Poupança', name: '', value: '' });
            const [debtForm, setDebtForm] = useState({ name: '', totalValue: '', installments: '', startDate: '', dueDay: '' });

            useEffect(() => { if (localStorage.getItem('appPassword') && localStorage.getItem('appPassword') !== '""') setIsLocked(true); }, []);

            const summary = useMemo(() => {
                const realized = financialEntries.filter(e => e.status === 'paid');
                const inc = realized.filter(e => e.type === 'income').reduce((acc, c) => acc + c.value, 0);
                const exp = realized.filter(e => e.type === 'expense').reduce((acc, c) => acc + c.value, 0);
                const pending = financialEntries.filter(e => e.status === 'pending' && e.type === 'expense').reduce((acc, c) => acc + c.value, 0);
                return { income: inc, expense: exp, balance: inc - exp, pendingExpense: pending };
            }, [financialEntries]);

            const chartData = useMemo(() => {
                const receivable = userLoans.reduce((acc, c) => acc + c.value, 0);
                const cardDebt = financialEntries.filter(e => e.method === 'Cartão Crédito' && e.type === 'expense' && e.status === 'pending').reduce((acc, c) => acc + c.value, 0);
                return [ { label: 'Saldo', value: summary.balance, color: '#10B981' }, { label: 'A Receber', value: receivable, color: '#F59E0B' }, { label: 'Cartões', value: cardDebt, color: '#EF4444' } ];
            }, [userLoans, financialEntries, summary.balance]);

            // Funções Auxiliares
            const handleUnlock = () => { if (pinInput === appPassword) { setIsLocked(false); setPinInput(''); } else alert("Senha incorreta!"); };
            const handleSetPassword = () => { if (newPasswordInput.length < 4) return alert("Min 4 digitos"); setAppPassword(newPasswordInput); setNewPasswordInput(''); };
            const getTotalCardUsage = (id) => financialEntries.filter(e => e.method === 'Cartão Crédito' && e.cardId === id && e.status === 'pending').reduce((acc, c) => acc + c.value, 0);
            const getCurrentInvoiceValue = (id) => { const now = new Date(); return financialEntries.filter(e => e.method === 'Cartão Crédito' && e.cardId === id && e.type === 'expense' && (new Date(e.date).getMonth() === now.getMonth())).reduce((acc, c) => acc + c.value, 0); };
            const getCardName = (id) => userCards.find(c => c.id === id)?.name || 'Excluído';
            const deleteItem = (id, list, setList) => { if(confirm("Excluir?")) setList(list.filter(i => i.id !== id)); };
            const handleTrash = (entry) => {
                if (entry.status === 'paid') { if (confirm("Ocultar do histórico? (Saldo permanece)")) setFinancialEntries(financialEntries.map(e => e.id === entry.id ? { ...e, hidden: true } : e)); }
                else { if (confirm("Excluir pendência?")) setFinancialEntries(financialEntries.filter(e => e.id !== entry.id)); }
            };
            const toggleStatus = (id) => setFinancialEntries(financialEntries.map(e => e.id === id ? { ...e, status: e.status === 'paid' ? 'pending' : 'paid' } : e));
            
            // Adicionar Lançamento
            const handleAddEntry = () => {
                if (!finForm.desc || !finForm.value) return alert("Preencha descrição e valor");
                const val = parseFloat(finForm.value);
                if(editingId) {
                    setFinancialEntries(financialEntries.map(e => e.id === editingId ? { ...e, ...finForm, value: val, cardId: finForm.method === 'Cartão Crédito' ? finForm.cardId : null } : e));
                    setEditingId(null); setFinForm({ ...finForm, desc: '', value: '', installments: 1 }); return;
                }
                const num = parseInt(finForm.installments) || 1;
                const portion = val / num;
                const newEnt = [];
                let start = new Date(finForm.date.split('-').map(Number)); 
                
                const [y,m,d] = finForm.date.split('-').map(Number);
                let dateObj = new Date(y, m-1, d);

                if (finForm.method === 'Cartão Crédito' && finForm.cardId) {
                    const card = userCards.find(c => c.id === finForm.cardId);
                    if(card) {
                        const due = parseInt(card.dueDay);
                        let nextM = dateObj.getMonth() + 1;
                        let nextY = dateObj.getFullYear();
                        if(nextM > 11) { nextM = 0; nextY++; }
                        dateObj = new Date(nextY, nextM, due);
                    } else dateObj.setMonth(dateObj.getMonth() + 1);
                }

                for(let i=0; i<num; i++) {
                    const dt = new Date(dateObj);
                    if(['Cartão Crédito','Carnê/Boleto'].includes(finForm.method)) dt.setMonth(dateObj.getMonth() + i);
                    else if(i>0) dt.setMonth(dateObj.getMonth() + i);
                    
                    const stat = (['Dinheiro','Cartão Débito','Pix'].includes(finForm.method) && dt <= new Date()) ? 'paid' : 'pending';
                    newEnt.push({ id: Date.now()+i, date: dt.toISOString().split('T')[0], desc: num>1 ? `${finForm.desc} (${i+1}/${num})` : finForm.desc, value: portion, type: finForm.type, category: finForm.category, method: finForm.method, cardId: finForm.cardId, status: stat });
                }
                setFinancialEntries([...newEnt, ...financialEntries]);
                setFinForm({...finForm, desc:'', value:'', installments: 1});
                alert("Salvo!");
            };

            const exportData = () => { const blob = new Blob([JSON.stringify({financialEntries, userAssets, userLoans, userCards}, null, 2)], {type: "application/json"}); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = "backup_financeiro.json"; link.click(); };
            const importData = (e) => { const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = (evt) => { try { const d = JSON.parse(evt.target.result); if(confirm("Restaurar?")) { if(d.financialEntries) setFinancialEntries(d.financialEntries); if(d.userAssets) setUserAssets(d.userAssets); if(d.userLoans) setUserLoans(d.userLoans); if(d.userCards) setUserCards(d.userCards); alert("Feito!"); } } catch { alert("Erro"); } }; r.readAsText(f); };

            if (isLocked) return ( <div className="p-10 text-center animate-fadeIn"><div className="text-4xl text-red-800 mb-4"><i className="fas fa-lock"></i></div><h2 className="font-bold text-gray-700">Protegido</h2><input type="password" value={pinInput} onChange={e=>setPinInput(e.target.value)} className="border p-2 rounded mt-4 w-full text-center" placeholder="Senha" inputMode="numeric"/><button onClick={handleUnlock} className="bg-red-800 text-white w-full py-2 rounded mt-2">Abrir</button></div> );

            const filtered = financialEntries.filter(e => !e.hidden && (historyFilter === 'all' ? true : historyFilter === 'pending' ? e.status === 'pending' : e.status === 'paid'));

            return (
                <div className="animate-fadeIn pb-20 bg-white min-h-screen">
                    {/* Header do Módulo Financeiro Integrado */}
                    <div className="bg-white p-3 border-b sticky top-0 z-30 flex justify-between items-center shadow-sm">
                        <button onClick={onBack} className="text-red-600 font-bold flex items-center gap-2 text-sm"><i className="fas fa-arrow-left"></i> Voltar</button>
                        <div className="flex gap-2">
                            <button onClick={()=>setView('settings')} className="text-gray-500 p-2"><IconWrapper name="lock"/></button>
                            <button onClick={()=>setView('statement')} className="text-gray-500 p-2"><IconWrapper name="file-text"/></button>
                            <button onClick={()=>setShowCalc(!showCalc)} className="text-red-600 p-2"><IconWrapper name="calculator"/></button>
                            <label className="text-gray-500 p-2 cursor-pointer"><input type="file" onChange={importData} className="hidden"/><IconWrapper name="refresh-cw"/></label>
                        </div>
                    </div>

                    {showCalc && <DraggableCalculator onClose={()=>setShowCalc(false)}/>}

                    <div className="sticky top-12 z-20 bg-white shadow-sm overflow-x-auto whitespace-nowrap p-2 sticky-tabs">
                        {['transactions|Fluxo','cards|Cartões','investments|Invest.','debts|Dívidas','assets|Bens','loans|Receber'].map(t => {
                            const [id, lbl] = t.split('|');
                            return <button key={id} onClick={()=>setView(id)} className={`px-4 py-2 text-xs font-bold rounded-full mr-2 ${view===id ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-500'}`}>{lbl}</button>
                        })}
                    </div>

                    <div className="p-4">
                        {view === 'statement' && <div className="bg-white p-4 rounded shadow print-container"><h2 className="font-bold border-b pb-2 mb-4 flex justify-between">Extrato <button onClick={()=>window.print()} className="text-xs bg-gray-200 px-2 py-1 rounded no-print">Imprimir</button></h2><div className="space-y-2">{financialEntries.filter(e=>e.status==='paid').sort((a,b)=>new Date(b.date)-new Date(a.date)).map(e=><div key={e.id} className="flex justify-between text-xs border-b pb-1"><span>{new Date(e.date).toLocaleDateString()} - {e.desc}</span><span className="font-bold text-red-600">R$ {e.value.toFixed(2)}</span></div>)}</div></div>}
                        
                        {view === 'settings' && <div className="p-4 bg-gray-50 rounded text-center"><h3 className="font-bold mb-4">Segurança</h3>{appPassword ? <button onClick={()=>{if(confirm('Remover?')) setAppPassword('')}} className="bg-red-500 text-white w-full py-2 rounded">Remover Senha</button> : <div className="flex gap-2"><input type="password" value={newPasswordInput} onChange={e=>setNewPasswordInput(e.target.value)} placeholder="Nova Senha" className="border p-2 w-full rounded"/><button onClick={handleSetPassword} className="bg-blue-600 text-white px-4 rounded">Salvar</button></div>}<button onClick={exportData} className="mt-4 text-blue-500 underline text-sm block w-full">Fazer Backup dos Dados</button></div>}

                        {view === 'transactions' && (
                            <div className="space-y-4">
                                <div className="grid grid-cols-3 gap-2 text-center">
                                    <div className="bg-green-100 p-2 rounded border border-green-200"><div className="text-[10px] text-green-700 font-bold uppercase">Entradas</div><div className="text-xs font-bold text-green-800">R$ {summary.income.toFixed(2)}</div></div>
                                    <div className="bg-red-100 p-2 rounded border border-red-200"><div className="text-[10px] text-red-700 font-bold uppercase">Saídas</div><div className="text-xs font-bold text-red-800">R$ {summary.expense.toFixed(2)}</div></div>
                                    <div className="bg-white border p-2 rounded shadow-sm"><div className="text-[10px] text-gray-500 font-bold uppercase">Saldo</div><div className={`text-xs font-bold ${summary.balance>=0?'text-blue-600':'text-red-600'}`}>R$ {summary.balance.toFixed(2)}</div></div>
                                </div>
                                {summary.pendingExpense > 0 && <div className="bg-yellow-50 text-yellow-800 text-xs p-2 text-center rounded border border-yellow-200 font-bold">Pendente a Pagar: R$ {summary.pendingExpense.toFixed(2)}</div>}

                                <div className="bg-white p-3 rounded shadow border border-gray-100 space-y-2">
                                    <div className="flex justify-between"><h3 className="font-bold text-gray-700 text-sm">{editingId ? 'Editar' : 'Novo'}</h3>{editingId && <button onClick={()=>{setEditingId(null);setFinForm({...finForm, desc:'', value:''})}} className="text-xs text-red-500">Cancelar</button>}</div>
                                    <div className="flex gap-2"><input type="date" value={finForm.date} onChange={e=>setFinForm({...finForm, date:e.target.value})} className="border p-1 rounded text-sm w-full"/><input type="number" placeholder="R$" value={finForm.value} onChange={e=>setFinForm({...finForm, value:e.target.value})} className="border p-1 rounded text-sm w-full"/></div>
                                    <input type="text" placeholder="Descrição" value={finForm.desc} onChange={e=>setFinForm({...finForm, desc:e.target.value})} className="border p-1 rounded text-sm w-full"/>
                                    <div className="flex gap-2"><select value={finForm.category} onChange={e=>setFinForm({...finForm, category:e.target.value})} className="border p-1 rounded text-sm w-1/2"><option>Outros</option><option>Alimentação</option><option>Contas</option><option>Dízimo</option><option>Transporte</option><option>Saúde</option><option>Lazer</option></select><select value={finForm.method} onChange={e=>setFinForm({...finForm, method:e.target.value})} className="border p-1 rounded text-sm w-1/2"><option>Dinheiro</option><option>Cartão Crédito</option><option>Pix</option><option>Carnê/Boleto</option></select></div>
                                    {finForm.method==='Cartão Crédito' && <div className="flex gap-2"><select value={finForm.cardId} onChange={e=>setFinForm({...finForm, cardId:e.target.value})} className="border p-1 rounded text-sm w-full"><option value="">Cartão...</option>{userCards.map(c=><option key={c.id} value={c.id}>{c.name}</option>)}</select><input type="number" placeholder="Parc." value={finForm.installments} onChange={e=>setFinForm({...finForm, installments:e.target.value})} className="border p-1 rounded text-sm w-16"/></div>}
                                    {(finForm.method==='Carnê/Boleto' && !editingId) && <div className="flex items-center gap-2 text-xs text-blue-600 font-bold bg-blue-50 p-1 rounded">Parcelas: <input type="number" value={finForm.installments} onChange={e=>setFinForm({...finForm, installments:e.target.value})} className="border w-12"/></div>}
                                    <div className="flex gap-2 mt-2"><button onClick={()=>setFinForm({...finForm, type:'income'})} className={`flex-1 py-2 rounded text-xs font-bold ${finForm.type==='income'?'bg-green-500 text-white':'bg-gray-100'}`}>Receita</button><button onClick={()=>setFinForm({...finForm, type:'expense'})} className={`flex-1 py-2 rounded text-xs font-bold ${finForm.type==='expense'?'bg-red-500 text-white':'bg-gray-100'}`}>Despesa</button></div>
                                    <button onClick={handleAddEntry} className="w-full bg-gray-800 text-white py-3 rounded font-bold text-sm mt-2 flex justify-center gap-2"><IconWrapper name={editingId?'edit-2':'plus'}/> {editingId?'Atualizar':'Adicionar'}</button>
                                </div>

                                <div className="bg-white rounded shadow overflow-hidden">
                                    <div className="bg-gray-100 p-2 flex justify-between items-center"><span className="text-xs font-bold text-gray-500 uppercase">Histórico</span><div className="flex gap-1"><button onClick={()=>setHistoryFilter('all')} className="text-[10px] bg-white px-2 rounded border">Todos</button><button onClick={()=>setHistoryFilter('pending')} className="text-[10px] bg-yellow-50 px-2 rounded border">Pendentes</button></div></div>
                                    <ul className="divide-y divide-gray-50">
                                        {filtered.length===0 && <li className="p-4 text-center text-xs text-gray-400">Vazio</li>}
                                        {filtered.sort((a,b)=>new Date(a.date)-new Date(b.date)).map(e=>(
                                            <li key={e.id} className={`p-3 flex justify-between items-center ${e.status==='paid'?'opacity-50 bg-gray-50':''}`}>
                                                <div><div className="font-bold text-sm text-gray-800">{e.desc}</div><div className="text-[10px] text-gray-500">{new Date(e.date).toLocaleDateString()} • {e.category} {e.cardId && `• ${getCardName(e.cardId)}`}</div></div>
                                                <div className="text-right"><div className={`font-bold text-sm ${e.type==='income'?'text-green-600':'text-red-600'}`}>{e.type==='income'?'+':'-'} {e.value.toFixed(2)}</div><div className="flex gap-2 justify-end mt-1"><button onClick={()=>{setEditingId(e.id);setFinForm({...e, installments:1})}} className="text-blue-400"><IconWrapper name="edit-2" size={14}/></button><button onClick={()=>toggleStatus(e.id)} className={`text-${e.status==='paid'?'green':'gray'}-400`}><IconWrapper name="check" size={14}/></button><button onClick={()=>handleTrash(e)} className="text-red-300"><IconWrapper name="trash-2" size={14}/></button></div></div>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                <SimplePieChart data={chartData} onSliceClick={(l)=>{if(l==='Saldo')setView('transactions');else if(l==='Cartões')setView('cards');}}/>
                            </div>
                        )}

                        {view === 'cards' && (
                            <div className="space-y-4">
                                <div className="bg-white p-3 rounded shadow"><h3 className="font-bold text-purple-700 text-xs mb-2">Novo Cartão</h3><div className="flex gap-2 mb-2"><input placeholder="Nome" value={cardForm.name} onChange={e=>setCardForm({...cardForm, name:e.target.value})} className="border p-1 w-full text-sm"/><input type="number" placeholder="Dia Venc" value={cardForm.dueDay} onChange={e=>setCardForm({...cardForm, dueDay:e.target.value})} className="border p-1 w-16 text-sm"/></div><div className="flex gap-2"><input type="number" placeholder="Limite" value={cardForm.limit} onChange={e=>setCardForm({...cardForm, limit:e.target.value})} className="border p-1 w-full text-sm"/><button onClick={()=>{if(!cardForm.name)return; setUserCards([...userCards, {...cardForm, id: Date.now().toString()}]); setCardForm({name:'',limit:'',dueDay:''})}} className="bg-purple-600 text-white px-4 rounded text-xs font-bold">Add</button></div></div>
                                {userCards.map(c => {
                                    const used = getTotalCardUsage(c.id); const inv = getCurrentInvoiceValue(c.id); const pct = Math.min(100, (used/c.limit)*100);
                                    return <div key={c.id} className="bg-gradient-to-r from-gray-800 to-gray-700 text-white p-4 rounded-xl shadow relative" onClick={()=>setExpandedCardId(expandedCardId===c.id?null:c.id)}><div className="flex justify-between items-start"><div><h4 className="font-bold">{c.name}</h4><div className="text-[10px] opacity-70">Vence dia {c.dueDay}</div></div><button onClick={(e)=>{e.stopPropagation();deleteItem(c.id, userCards, setUserCards)}} className="text-gray-400"><IconWrapper name="trash-2"/></button></div><div className="grid grid-cols-2 gap-2 mt-3 mb-2 text-xs"><div><div className="opacity-70">Fatura Atual</div><div className="font-bold text-red-300">R$ {inv.toFixed(2)}</div></div><div className="text-right"><div>Disponível</div><div className="font-bold text-green-300">R$ {(c.limit-used).toFixed(2)}</div></div></div><div className="h-1 bg-gray-600 rounded overflow-hidden"><div className={`h-full ${pct>90?'bg-red-500':'bg-green-500'}`} style={{width:`${pct}%`}}></div></div>{expandedCardId===c.id && <div className="mt-2 pt-2 border-t border-gray-600"><div className="text-[10px] font-bold mb-1 uppercase opacity-70">Pendências Futuras</div>{financialEntries.filter(e=>e.cardId===c.id && e.status==='pending').map(e=><div key={e.id} className="flex justify-between text-xs py-1 border-b border-gray-600 border-opacity-30"><span>{e.desc}</span><span>{e.value.toFixed(2)}</span></div>)}</div>}</div>
                                })}
                            </div>
                        )}

                        {view === 'investments' && (
                            <div className="space-y-4">
                                <div className="bg-teal-600 text-white p-4 rounded-xl text-center shadow"><div className="text-xs uppercase opacity-70">Total Investido</div><div className="text-2xl font-bold">R$ {userInvestments.reduce((acc,c)=>acc+c.value,0).toFixed(2)}</div></div>
                                <div className="bg-white p-3 rounded shadow flex gap-2"><input placeholder="Nome" value={investmentForm.name} onChange={e=>setInvestmentForm({...investmentForm, name:e.target.value})} className="border p-1 w-full text-sm"/><input type="number" placeholder="Valor" value={investmentForm.value} onChange={e=>setInvestmentForm({...investmentForm, value:e.target.value})} className="border p-1 w-24 text-sm"/><button onClick={()=>{if(!investmentForm.name)return; setUserInvestments([...userInvestments, {...investmentForm, id:Date.now(), value:parseFloat(investmentForm.value)}]);}} className="bg-teal-600 text-white px-3 rounded font-bold text-xs">Ok</button></div>
                                {userInvestments.map(i=><div key={i.id} className="bg-white p-3 rounded shadow border-l-4 border-teal-500 flex justify-between items-center"><span className="font-bold text-gray-700 text-sm">{i.name}</span><div className="flex gap-2 items-center"><span className="font-bold text-teal-600 text-sm">R$ {i.value.toFixed(2)}</span><button onClick={()=>deleteItem(i.id, userInvestments, setUserInvestments)} className="text-gray-300"><IconWrapper name="trash-2"/></button></div></div>)}
                            </div>
                        )}

                        {(view === 'debts' || view === 'loans' || view === 'assets') && (
                            <div className="text-center text-gray-400 mt-10">
                                <IconWrapper name="lock" size={48}/>
                                <p className="mt-2 text-sm">Módulo simplificado para visualização.</p>
                                <p className="text-xs">Use a aba FLUXO para adicionar.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- MÓDULO ESTÚDIO ---
        // (Omitted for brevity, logic kept same as previous file)
        const StudioScreen = ({ onBack }) => {
            const [mode, setMode] = useState('editor'); // editor | preview
            const [streak, setStreak] = useState(0);
            const [textData, setTextData] = useState({ 
                titulo: 'Bom Dia', versiculo: '', referencia: '', mensagem: '', autor: 'Sistema Vida' 
            });
            const [style, setStyle] = useState({ 
                fontSize: 16, opacity: 90, blur: 0, theme: 't-clean', font: 'font-modern', 
                align: 'align-left', format: 'fmt-feed', frame: '', filter: '', dimmer: false, bgImage: '' 
            });
            const [sticker, setSticker] = useState('');
            const [showEmojis, setShowEmojis] = useState(false);
            const [toast, setToast] = useState('');
            
            // Dados estáticos
            const db = [
                { tags: "financeiro dinheiro sucesso", titulo: "Deus Proverá", ref: "Filipenses 4:19", vers: "O meu Deus suprirá todas as necessidades.", msg: "Sua conta bancária não limita o poder de Deus. A provisão está a caminho." },
                { tags: "sucesso trabalho foco", titulo: "Não Desista", ref: "Gálatas 6:9", vers: "Não nos cansemos de fazer o bem.", msg: "O sucesso é a soma de pequenos esforços repetidos dia após dia. Continue plantando." },
                { tags: "sucesso empreender", titulo: "Visão de Águia", ref: "", vers: "O futuro pertence àqueles que acreditam na beleza de seus sonhos.", msg: "Não conte seus planos para quem não tem visão para entendê-los. Trabalhe em silêncio." },
                { tags: "ansiedade medo paz", titulo: "Paz Real", ref: "João 14:27", vers: "Deixo-vos a paz, a minha paz vos dou.", msg: "Respire fundo. O controle do universo está nas mãos de quem te ama." },
                { tags: "ansiedade calma", titulo: "Um dia de cada vez", ref: "Mateus 6:34", vers: "Não vos inquieteis pelo dia de amanhã.", msg: "A preocupação não tira os problemas de amanhã, ela apenas tira a paz de hoje." },
                { tags: "família casa amor", titulo: "Lar Protegido", ref: "Josué 24:15", vers: "Eu e minha casa serviremos ao Senhor.", msg: "Deus está levantando muros de proteção ao redor da sua família hoje." },
                { tags: "saúde cura gym treino", titulo: "Força Renovada", ref: "Isaías 40:29", vers: "Ele fortalece o cansado e dá grande vigor ao que está sem forças.", msg: "Seu corpo é templo. Cuide dele com respeito e disciplina. Você é mais forte do que imagina." },
                { tags: "saúde cura", titulo: "Cura Divina", ref: "Jeremias 30:17", vers: "Restaurarei a sua saúde e curarei as suas feridas.", msg: "Para Deus, o diagnóstico médico é apenas um detalhe. Creia no milagre." },
                { tags: "gratidão fé", titulo: "Novo Fôlego", ref: "Lamentações 3:22", vers: "As misericórdias do Senhor são a causa de não sermos consumidos.", msg: "Você acordou! Isso é a prova de que Deus ainda não terminou com você." },
                { tags: "fé milagre", titulo: "Vai Acontecer", ref: "Hebreus 11:1", vers: "A fé é a certeza daquilo que esperamos.", msg: "O que parece impossível para você, para Deus é apenas o começo de um milagre." }
            ];
            const magicBackgrounds = ["https://images.unsplash.com/photo-1519681393798-3828fb4090bb?q=80&w=1000","https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=1000","https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=1000","https://images.unsplash.com/photo-1493246507139-91e8fad9978e?q=80&w=1000","https://images.unsplash.com/photo-1472214103451-9374bd1c798e?q=80&w=1000","https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1000","https://images.unsplash.com/photo-1513542789411-b6a5d4f31634?q=80&w=1000","https://images.unsplash.com/photo-1506260408121-e353d10b87c7?q=80&w=1000","https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=1000","https://images.unsplash.com/photo-1500673922987-e212871fec22?q=80&w=1000"];
            const emojis = ["🙏", "🙌", "✨", "❤️", "✝️", "🕊️", "📖", "🔥", "💡", "😊", "💪", "🛡️", "👑", "🌿", "🌟", "💖", "🤝", "😭", "🌻", "😇", "🦁", "🌈", "☀️", "🚀", "💰", "💼", "🧠"];

            // Init Logic
            useEffect(() => {
                let last = localStorage.getItem('lastVisit');
                let st = parseInt(localStorage.getItem('streak') || 0);
                const today = new Date().toDateString();
                if (last !== today) {
                    const yesterday = new Date(Date.now() - 86400000).toDateString();
                    if (last === yesterday) st++; else st = 1;
                    localStorage.setItem('lastVisit', today); localStorage.setItem('streak', st);
                }
                setStreak(st);
            }, []);

            // Effects
            const showToast = (msg) => { setToast(msg); setTimeout(() => setToast(''), 3000); };
            
            // Logic Functions
            const gerarConteudo = (term) => {
                const t = term ? term.toLowerCase() : '';
                const pool = t ? db.filter(i => i.tags.includes(t)) : db;
                const item = pool.length ? pool[Math.floor(Math.random() * pool.length)] : db[0];
                setTextData({ titulo: item.titulo, versiculo: item.vers, referencia: item.ref, mensagem: item.msg, autor: textData.autor });
                showToast("Texto Gerado!");
                if(t) setMode('preview');
            };
            const gerarAleatorio = () => {
                const item = db[Math.floor(Math.random() * db.length)];
                setTextData({ ...textData, titulo: item.titulo, versiculo: item.vers, referencia: item.ref, mensagem: item.msg });
                const themes = ['t-clean', 't-dark', 't-ocean', 't-nature', 't-sunset'];
                if(streak >= 3) themes.push('t-gold', 't-royal');
                setStyle(prev => ({ ...prev, theme: themes[Math.floor(Math.random() * themes.length)] }));
                showToast("✨ Inspiração!");
            };
            const magicBackground = () => {
                const img = magicBackgrounds[Math.floor(Math.random() * magicBackgrounds.length)];
                setStyle(prev => ({ ...prev, bgImage: `url(${img})`, theme: 't-dark', dimmer: true }));
                if(!textData.mensagem.includes('✨')) setTextData(prev => ({ ...prev, mensagem: prev.mensagem + " ✨" }));
                showToast("✨ Mágica Aplicada!");
            };
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = (evt) => {
                        setStyle(prev => ({ ...prev, bgImage: `url(${evt.target.result})`, theme: 't-dark', dimmer: true }));
                        showToast("Foto Carregada! 📸");
                    };
                    reader.readAsDataURL(file);
                }
            };
            const toggleFont = () => {
                const fonts = ['font-modern', 'font-classic', 'font-hand', 'font-bold', 'font-marker'];
                const idx = fonts.indexOf(style.font);
                setStyle(prev => ({ ...prev, font: fonts[(idx + 1) % fonts.length] }));
                showToast("Fonte alterada");
            };
            const baixar = async () => {
                showToast("Salvando...");
                const card = document.getElementById('card-capture');
                try {
                    const canvas = await html2canvas(card, { scale: 3, useCORS: true, allowTaint: true, backgroundColor: null });
                    const link = document.createElement('a'); link.download = 'sistema_vida_' + Date.now() + '.png'; link.href = canvas.toDataURL(); link.click();
                    showToast("Salvo na Galeria! 📥");
                } catch(e) { alert("Erro ao baixar."); }
            };
            
            const handleDragStart = (e) => {
                const el = e.currentTarget;
                const startX = e.touches ? e.touches[0].clientX : e.clientX;
                const startY = e.touches ? e.touches[0].clientY : e.clientY;
                const rect = el.getBoundingClientRect();
                
                const move = (ev) => {
                    ev.preventDefault();
                    const cx = ev.touches ? ev.touches[0].clientX : ev.clientX;
                    const cy = ev.touches ? ev.touches[0].clientY : ev.clientY;
                    el.style.transform = `translate(${cx - startX}px, ${cy - startY}px)`;
                };
                const stop = () => { window.removeEventListener('mousemove', move); window.removeEventListener('mouseup', stop); window.removeEventListener('touchmove', move); window.removeEventListener('touchend', stop); };
                window.addEventListener('mousemove', move); window.addEventListener('touchmove', move, {passive:false});
                window.addEventListener('mouseup', stop); window.addEventListener('touchend', stop);
            };

            const toggleTheme = () => {
                const body = document.querySelector('.studio-root');
                if (body) {
                    const current = body.getAttribute('data-theme');
                    body.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
                    showToast(current === 'light' ? "Modo Escuro" : "Modo Claro");
                }
            };

            return (
                <div className="studio-root" data-theme="light">
                    <div id="particles"></div>
                    <header className="studio-header">
                        <button onClick={onBack} className="text-red-600 font-bold flex items-center gap-2 text-sm"><i className="fas fa-arrow-left"></i> Voltar</button>
                        <div className="studio-brand"><span>Sistema Vida</span><span>Clean 31.1</span></div>
                        <div className="streak-badge" onClick={() => showToast(streak >= 3 ? "🔥 Você é VIP!" : `🔒 Falta ${3-streak} dias`)}><i className="fas fa-fire"></i> <span>{streak}</span> Dia</div>
                    </header>

                    <div className="studio-container">
                        {mode === 'editor' ? (
                            <div className="animate-fadeIn">
                                <div className="tools-section">
                                    <div className="section-title"><i className="fas fa-bolt" style={{color:'#f59e0b'}}></i> Gerador Rápido</div>
                                    <div className="search-row">
                                        <i className="fas fa-search search-icon"></i>
                                        <input type="text" id="temaBusca" className="search-input" placeholder="Sobre o que quer falar?" onKeyDown={(e)=>e.key==='Enter' && gerarConteudo(e.target.value)}/>
                                        <button className="btn-magic" onClick={()=>gerarConteudo(document.getElementById('temaBusca').value)}><i className="fas fa-wand-magic-sparkles"></i></button>
                                    </div>
                                    <div className="cat-scroll">
                                        {['Sucesso','Fé','Ansiedade','Gym','Amor','Gratidão'].map(t => <div key={t} className="cat-chip" onClick={()=>gerarConteudo(t)}>{t}</div>)}
                                    </div>
                                </div>
                                <div className="emoji-bar">
                                    <button type="button" className="btn-emoji-toggle" onClick={()=>setShowEmojis(!showEmojis)}><i className="far fa-smile"></i> Galeria de Emojis <i className="fas fa-chevron-down"></i></button>
                                    <div className={`emoji-grid ${showEmojis ? 'show' : ''}`}>
                                        {emojis.map(e => <div key={e} className="emoji-item" onClick={()=>{setTextData(prev=>({...prev, mensagem: prev.mensagem + e})); showToast("Emoji Adicionado!");}}>{e}</div>)}
                                    </div>
                                </div>
                                <div className="form-group"><div className="studio-label">Título</div><input type="text" value={textData.titulo} onChange={e=>setTextData({...textData, titulo:e.target.value})} className="track-input" placeholder="Ex: Bom Dia"/></div>
                                <div className="form-group"><div className="studio-label">Subtítulo / Versículo</div><textarea rows="2" value={textData.versiculo} onChange={e=>setTextData({...textData, versiculo:e.target.value})} className="track-input" placeholder="Uma frase curta..."/><input type="text" value={textData.referencia} onChange={e=>setTextData({...textData, referencia:e.target.value})} className="track-input" placeholder="Referência (Opcional)" style={{marginTop:8}}/></div>
                                <div className="form-group"><div className="studio-label">Mensagem Principal</div><textarea rows="5" value={textData.mensagem} onChange={e=>setTextData({...textData, mensagem:e.target.value})} className="track-input" placeholder="Sua mensagem inspiradora aqui..."/></div>
                                <div className="form-group"><div className="studio-label">Assinatura</div><input type="text" value={textData.autor} onChange={e=>setTextData({...textData, autor:e.target.value})} className="track-input" placeholder="Seu Nome"/></div>
                                <div style={{height: 80}}></div>
                            </div>
                        ) : (
                            <div className="animate-fadeIn">
                                <div className="top-nav-bar">
                                    <button className="btn-back" onClick={()=>setMode('editor')}><i className="fas fa-arrow-left"></i> Editar</button>
                                    <button className="btn-inspire" onClick={gerarAleatorio}><i className="fas fa-random"></i> Surpreenda-me</button>
                                </div>

                                <div className="slider-box">
                                    <div className="slider-row">
                                        <div className="slider-wrapper"><span className="slider-label">Tamanho</span><input type="range" min="12" max="40" value={style.fontSize} onChange={e=>setStyle({...style, fontSize:e.target.value})}/></div>
                                        <div className="slider-wrapper"><span className="slider-label">Opacidade</span><input type="range" min="0" max="100" value={style.opacity} onChange={e=>setStyle({...style, opacity:e.target.value})}/></div>
                                    </div>
                                    <div className="slider-wrapper"><span className="slider-label">Desfoque (Blur)</span><input type="range" min="0" max="10" value={style.blur} onChange={e=>setStyle({...style, blur:e.target.value})}/></div>
                                </div>

                                <div className="preview-container-3d" id="card-container-3d">
                                    <div id="card-capture" className={`card-preview-wrapper ${style.format} ${style.theme} ${style.font} ${style.align} ${style.frame} ${style.filter}`} style={{backgroundImage: style.bgImage, backgroundSize: 'cover', backgroundPosition: 'center'}}>
                                        <div className={`card-sticker draggable-item ${sticker ? 'visible' : ''}`} onMouseDown={handleDragStart} onTouchStart={handleDragStart}>{sticker}</div>
                                        <div className={`card-overlay ${style.dimmer ? 'dimmer-heavy' : ''}`} style={style.bgImage ? {backdropFilter: `blur(${style.blur}px)`, WebkitBackdropFilter: `blur(${style.blur}px)`} : {}}></div>
                                        <div className="card-content-layer" style={{fontSize: `${style.fontSize}px`}}>
                                            <div className={`pv-title draggable-item ${style.textGlow ? 'text-glow' : ''}`}>{textData.titulo}</div>
                                            <div className="pv-ref draggable-item">{textData.referencia}</div>
                                            <span className="pv-verse draggable-item">"{textData.versiculo}"</span>
                                            <div className="pv-msg draggable-item" style={{backgroundColor: `rgba(255,255,255, ${style.opacity / 100})`}}>{textData.mensagem}</div>
                                            <div className="pv-footer draggable-item"><i className="fas fa-heart" style={{color: 'var(--primary)'}}></i> <span>{textData.autor}</span> • <span>{new Date().toLocaleDateString('pt-BR')}</span></div>
                                        </div>
                                        <div className="music-overlay">
                                            <div className="music-bar"><div className="music-progress"></div></div>
                                            <div className="music-time"><span>1:34</span><span>3:45</span></div>
                                            <div className="music-controls"><i className="fas fa-backward-step"></i><i className="fas fa-circle-play" style={{fontSize: '2.5rem'}}></i><i className="fas fa-forward-step"></i></div>
                                        </div>
                                    </div>
                                </div>

                                <div className="format-bar">
                                    <div className={`fmt-btn ${style.format==='fmt-feed'?'active':''}`} onClick={()=>setStyle({...style, format:'fmt-feed'})}><i className="far fa-square"></i> Feed</div>
                                    <div className={`fmt-btn ${style.format==='fmt-music'?'active':''}`} onClick={()=>{setStyle({...style, format:'fmt-music'}); magicBackground();}}><i className="fab fa-spotify"></i> Music</div>
                                    <div className={`fmt-btn ${style.format==='fmt-story'?'active':''}`} onClick={()=>setStyle({...style, format:'fmt-story'})}><i className="fas fa-mobile-alt"></i> Stories</div>
                                </div>

                                <div className="section-title" style={{marginLeft: 5, marginBottom: 10}}>Molduras</div>
                                <div className="preview-controls" style={{paddingTop: 0, marginBottom: 20}}>
                                    <button className="tool-btn active" onClick={()=>setStyle({...style, frame:''})}>🚫</button>
                                    {['frame-white','frame-double','frame-black','frame-gold','frame-wood','frame-neon-pink','frame-neon-blue','frame-modern-y','frame-modern-x','frame-polaroid-clean'].map(f => (
                                        <button key={f} className="tool-btn" onClick={()=>setStyle({...style, frame:f})}>{f.replace('frame-','')}</button>
                                    ))}
                                </div>

                                <div className="scroll-tools">
                                    <div className="tool-row">
                                        <button className={`tool-btn ${!sticker?'active':''}`} onClick={()=>setSticker('')}><i className="fas fa-ban"></i></button>
                                        {['Bom Dia ☀️','Boa Noite 🌙','Gratidão 🙏','Fé em Deus ✝️','Versículo 📖'].map(s => <button key={s} className="tool-btn" onClick={()=>setSticker(s)}>{s}</button>)}
                                    </div>
                                    <div className="tool-row">
                                        <button className="tool-btn" onClick={toggleFont}><i className="fas fa-font"></i> Fonte</button>
                                        <button className="tool-btn" onClick={()=>setStyle({...style, align: style.align==='align-left'?'align-center':'align-left'})}><i className="fas fa-align-center"></i> Alinhar</button>
                                        <button className="tool-btn" onClick={()=>setStyle({...style, dimmer: !style.dimmer})}><i className="fas fa-adjust"></i> Sombra</button>
                                        <button className="tool-btn" onClick={()=>setStyle({...style, filter: style.filter==='filter-bw'?'':'filter-bw'})}>P&B</button>
                                    </div>
                                </div>

                                <div className="preview-controls">
                                    <button className="theme-btn upload-btn" onClick={()=>document.getElementById('bgInput').click()}><i className="fas fa-camera"></i></button>
                                    <input type="file" id="bgInput" accept="image/*" style={{display:'none'}} onChange={handleImageUpload}/>
                                    <button className="theme-btn magic-btn" onClick={magicBackground}><i className="fas fa-wand-magic-sparkles"></i></button>
                                    {['t-clean','t-dark','t-ocean','t-nature','t-sunset'].map(t => <div key={t} className={`theme-btn ${t} ${style.theme===t?'active':''}`} onClick={()=>setStyle({...style, theme:t, bgImage:''})}></div>)}
                                </div>

                                <div className="actions-grid">
                                    <button className="btn-action btn-audio" onClick={()=>{const u=new SpeechSynthesisUtterance(`${textData.titulo}. ${textData.mensagem}`); u.lang='pt-BR'; window.speechSynthesis.speak(u);}}><i className="fas fa-volume-up"></i> Ouvir</button>
                                    <button className="btn-action btn-share" onClick={baixar}><i className="fab fa-whatsapp"></i> Zap</button>
                                    <button className="btn-action btn-save" onClick={baixar}><i className="fas fa-download"></i> Salvar</button>
                                    <button className="btn-action btn-copy" onClick={()=>{navigator.clipboard.writeText(`*${textData.titulo}*\n"${textData.versiculo}"\n${textData.mensagem}`); showToast("Copiado!");}}><i className="fas fa-copy"></i> Copiar</button>
                                </div>
                                <div style={{height: 100}}></div>
                            </div>
                        )}
                    </div>

                    <nav className="bottom-nav">
                        <button className={`nav-item ${mode==='editor'?'active':''}`} onClick={()=>setMode('editor')}><i className="fas fa-pen"></i></button>
                        <button className={`nav-item ${mode==='preview'?'active':''}`} onClick={()=>setMode('preview')}><i className="fas fa-image"></i></button>
                        <button className="nav-item" onClick={toggleTheme}><i className="fas fa-moon"></i></button>
                    </nav>
                    {toast && <div id="toast" className="show"><i className="fas fa-info-circle"></i> <span>{toast}</span></div>}
                </div>
            );
        };

        // --- COMPONENTE PREGAÇÃO (PREGADOR PRO) ---
        // (Omitted for brevity, logic kept same as previous file)
        const PreachingScreen = ({ onBack }) => {
            const [draft, setDraft] = usePersistentState('sermonDraft', {
                title: '', bible: '', date: '', intro: '', illustration: '', conclusion: '',
                study_context: '', study_exegesis: '', study_refs: '', worship_songs: ''
            });
            const [points, setPoints] = usePersistentState('sermonPoints', [{ id: 1, title: '', content: '' }, { id: 2, title: '', content: '' }]);
            const [library, setLibrary] = usePersistentState('sermonLibrary', []);
            const [isPulpit, setIsPulpit] = useState(false);
            const [showLib, setShowLib] = useState(false);
            const [showImport, setShowImport] = useState(false);
            const [showStudy, setShowStudy] = useState(false);
            const [timer, setTimer] = useState({ running: false, seconds: 0 });
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [promptType, setPromptType] = useState('sermon');
            const [jsonInput, setJsonInput] = useState('');
            const timerRef = useRef(null);

            useEffect(() => {
                if (timer.running) {
                    timerRef.current = setInterval(() => setTimer(prev => ({ ...prev, seconds: prev.seconds + 1 })), 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [timer.running]);

            useEffect(() => {
                if (isPulpit) document.body.classList.add('pulpit-mode');
                else document.body.classList.remove('pulpit-mode');
                return () => document.body.classList.remove('pulpit-mode');
            }, [isPulpit]);

            const handleTimer = () => setTimer(prev => ({ ...prev, running: !prev.running }));
            const resetTimer = () => setTimer({ running: false, seconds: 0 });
            const formatTime = (s) => {
                const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = s % 60;
                return `${h > 0 ? h.toString().padStart(2,'0')+':' : ''}${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
            };

            const toggleNarration = () => {
                if (isSpeaking) { window.speechSynthesis.cancel(); setIsSpeaking(false); return; }
                let text = `${draft.title}. ${draft.bible}. Introdução: ${draft.intro}. `;
                points.forEach((p, i) => text += `Ponto ${i+1}: ${p.title}. ${p.content}. `);
                text += `Conclusão: ${draft.conclusion}`;
                const u = new SpeechSynthesisUtterance(text); u.lang = 'pt-BR';
                u.onend = () => setIsSpeaking(false);
                window.speechSynthesis.speak(u); setIsSpeaking(true);
            };

            const shareWA = () => {
                let msg = `*${draft.title.toUpperCase()}*\n📖 _${draft.bible}_\n\n*Introdução:*\n${draft.intro}\n\n`;
                points.forEach((p, i) => { if(p.title) msg += `*${i+1}. ${p.title}*\n${p.content}\n\n`; });
                if(draft.illustration) msg += `*Ilustração:*\n${draft.illustration}\n\n`;
                msg += `*Conclusão:*\n${draft.conclusion}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const saveLib = () => {
                if(!draft.title) return alert("Digite um título.");
                setLibrary([{ id: Date.now(), title: draft.title, dateSaved: new Date().toLocaleDateString(), data: { draft, points } }, ...library]);
                alert("Salvo!");
            };

            const loadLib = (item) => {
                if(confirm("Substituir atual?")) { setDraft(item.data.draft); setPoints(item.data.points); setShowLib(false); }
            };

            const processJson = () => {
                try {
                    let clean = jsonInput.trim().replace(/```json/g, '').replace(/```/g, '');
                    const first = clean.indexOf('{'), last = clean.lastIndexOf('}');
                    if (first !== -1 && last !== -1) clean = clean.substring(first, last + 1);
                    const d = JSON.parse(clean);
                    setDraft(prev => ({
                        ...prev,
                        title: d.title || prev.title, bible: d.bible_text || prev.bible,
                        intro: d.intro || prev.intro, illustration: d.illustration || prev.illustration,
                        conclusion: d.conclusion || prev.conclusion,
                        study_context: d.study_context || prev.study_context,
                        study_exegesis: d.study_exegesis || prev.study_exegesis,
                        study_refs: d.study_refs || prev.study_refs,
                        worship_songs: d.worship_songs || prev.worship_songs
                    }));
                    if(d.topics) setPoints(d.topics.map((t, i) => ({ id: Date.now()+i, title: t.title, content: t.content })));
                    if(d.study_context) setShowStudy(true);
                    setShowImport(false);
                    alert("Importado!");
                } catch(e) { alert("Erro no JSON."); }
            };

            const getPrompt = () => {
                const base = promptType === 'sermon' ? 
                    `Crie um esboço de pregação. TEMA: "${draft.title}". TEXTO: "${draft.bible}". JSON structure: { "title": "...", "bible_text": "...", "intro": "...", "topics": [{"title": "...", "content": "..."}], "illustration": "...", "conclusion": "..." }` :
                    `Crie um estudo bíblico profundo. TEMA: "${draft.title}". TEXTO: "${draft.bible}". JSON structure: { "title": "...", "bible_text": "...", "study_context": "...", "study_exegesis": "...", "study_refs": "...", "worship_songs": "...", "intro": "...", "topics": [{"title": "...", "content": "..."}], "illustration": "...", "conclusion": "..." }`;
                return base;
            };

            return (
                <div className={`preaching-container min-h-screen pb-20 ${isPulpit ? 'bg-black text-lime-200' : 'bg-gray-50'}`}>
                    {/* NAV */}
                    <nav className={`bg-slate-900 text-white p-3 shadow-lg sticky top-0 z-50 flex flex-col md:flex-row gap-3 items-center justify-between border-b-2 border-lime-500 ${isPulpit?'opacity-80 hover:opacity-100 transition':''}`}>
                        <div className="flex items-center gap-2 w-full md:w-auto justify-between">
                            <div className="flex items-center gap-2">
                                <button onClick={onBack} className="text-lime-400 mr-2"><i className="fas fa-arrow-left"></i></button>
                                <h1 className="font-bold text-lime-400">Pregador<span className="text-white">Pro</span></h1>
                            </div>
                            <button onClick={()=>setIsPulpit(!isPulpit)} className="md:hidden p-2 bg-slate-800 rounded text-lime-400"><i className="fas fa-expand"></i></button>
                        </div>
                        {(isPulpit || timer.running) && <div className="flex items-center gap-3 bg-black/50 px-4 py-1 rounded-full border border-lime-900"><span className="text-2xl font-mono font-bold text-lime-500">{formatTime(timer.seconds)}</span><button onClick={handleTimer}><i className={`fas ${timer.running?'fa-pause':'fa-play'} text-white`}></i></button><button onClick={resetTimer}><i className="fas fa-undo text-red-400"></i></button></div>}
                        <div className="flex gap-2 overflow-x-auto w-full md:w-auto pb-1 no-pulpit">
                            <button onClick={toggleNarration} className={`px-3 py-2 rounded text-sm font-bold flex items-center gap-1 ${isSpeaking?'bg-pink-600 animate-pulse':'bg-slate-800 text-lime-400'}`}><i className="fas fa-volume-up"></i></button>
                            <button onClick={()=>setShowLib(true)} className="px-3 py-2 bg-yellow-600 rounded text-white text-sm font-bold flex items-center gap-1"><i className="fas fa-book"></i> Biblio</button>
                            <button onClick={()=>setShowImport(true)} className="px-3 py-2 bg-lime-600 text-slate-900 rounded text-sm font-bold flex items-center gap-1"><i className="fas fa-robot"></i> IA</button>
                            <button onClick={()=>setShowStudy(!showStudy)} className="px-3 py-2 bg-blue-600 rounded text-white text-sm"><i className="fas fa-book-open"></i> Estudo</button>
                            <button onClick={shareWA} className="px-3 py-2 bg-green-600 rounded text-white text-sm"><i className="fab fa-whatsapp"></i></button>
                            <button onClick={()=>setIsPulpit(!isPulpit)} className="px-3 py-2 bg-indigo-600 rounded text-white text-sm"><i className="fas fa-expand"></i></button>
                            <button onClick={()=>window.print()} className="px-3 py-2 bg-slate-700 rounded text-white text-sm"><i className="fas fa-print"></i></button>
                            <button onClick={()=>{if(confirm('Limpar?')){setDraft({title:'',bible:'',date:'',intro:'',illustration:'',conclusion:'',study_context:'',study_exegesis:'',study_refs:'',worship_songs:''});setPoints([{id:1,title:'',content:''}]);}}} className="px-3 py-2 bg-red-600 rounded text-white text-sm"><i className="fas fa-trash"></i></button>
                        </div>
                    </nav>

                    <main className="max-w-4xl mx-auto p-4">
                        <div className={`card shadow-xl rounded-xl p-6 border-t-4 border-lime-500 transition-colors ${isPulpit?'bg-gray-900 border-none':'bg-white'}`}>
                            <div className="grid md:grid-cols-2 gap-4 mb-6 border-b border-gray-700/20 pb-6">
                                <div className="md:col-span-2">
                                    <label className="text-xs font-bold uppercase opacity-50 block mb-1">Título</label>
                                    <input type="text" value={draft.title} onChange={e=>setDraft({...draft, title:e.target.value})} placeholder="Ex: O Poder da Oração" className="w-full text-2xl font-bold bg-transparent border-b-2 border-lime-500/30 focus:border-lime-500 outline-none pb-2 preaching-input"/>
                                    <div className="preaching-print-only font-bold text-2xl mb-2">{draft.title}</div>
                                </div>
                                <div>
                                    <label className="text-xs font-bold uppercase opacity-50 block mb-1">Texto Bíblico</label>
                                    <div className="flex gap-2">
                                        <input type="text" value={draft.bible} onChange={e=>setDraft({...draft, bible:e.target.value})} placeholder="Ex: João 3:16" className="w-full bg-transparent border-b border-gray-500/30 focus:border-lime-500 outline-none pb-1 preaching-input"/>
                                        <button onClick={()=>window.open(`https://www.bibliaonline.com.br/acf/busca?q=${encodeURIComponent(draft.bible)}`,'_blank')} className="no-pulpit text-lime-600 text-xs font-bold bg-lime-100 px-2 rounded border border-lime-200">Ver</button>
                                    </div>
                                    <div className="preaching-print-only italic">{draft.bible}</div>
                                </div>
                                <div>
                                    <label className="text-xs font-bold uppercase opacity-50 block mb-1">Data/Ocasião</label>
                                    <input type="text" value={draft.date} onChange={e=>setDraft({...draft, date:e.target.value})} className="w-full bg-transparent border-b border-gray-500/30 focus:border-lime-500 outline-none pb-1 preaching-input"/>
                                    <div className="preaching-print-only">{draft.date}</div>
                                </div>
                            </div>

                            {showStudy && (
                                <div id="study-panel" className="mb-8 border-2 border-dashed border-blue-200 bg-blue-50 rounded-lg p-4 text-slate-800">
                                    <h2 className="text-blue-800 font-bold mb-2 flex items-center gap-2"><i className="fas fa-graduation-cap"></i> Aprofundamento</h2>
                                    <div className="space-y-3">
                                        <textarea value={draft.study_context} onChange={e=>setDraft({...draft, study_context:e.target.value})} placeholder="Contexto Histórico..." className="w-full p-2 rounded text-sm border border-blue-200"></textarea>
                                        <textarea value={draft.study_exegesis} onChange={e=>setDraft({...draft, study_exegesis:e.target.value})} placeholder="Exegese / Palavras-chave..." className="w-full p-2 rounded text-sm border border-blue-200"></textarea>
                                        <textarea value={draft.study_refs} onChange={e=>setDraft({...draft, study_refs:e.target.value})} placeholder="Referências Cruzadas..." className="w-full p-2 rounded text-sm border border-blue-200"></textarea>
                                        <textarea value={draft.worship_songs} onChange={e=>setDraft({...draft, worship_songs:e.target.value})} placeholder="Hinos sugeridos..." className="w-full p-2 rounded text-sm border border-purple-200 bg-purple-50"></textarea>
                                    </div>
                                </div>
                            )}

                            <div className="space-y-6">
                                <div>
                                    <div className="text-lime-600 font-bold uppercase text-xs mb-1 flex items-center gap-2"><i className="fas fa-bookmark"></i> Introdução</div>
                                    <textarea rows="4" value={draft.intro} onChange={e=>setDraft({...draft, intro:e.target.value})} className="w-full p-3 rounded-lg bg-black/5 border border-gray-500/20 focus:ring-2 focus:ring-lime-500/50 outline-none sermon-text text-lg leading-relaxed preaching-input" placeholder="Gancho inicial..."></textarea>
                                    <div className="preaching-print-only">{draft.intro}</div>
                                </div>

                                <div className="space-y-4">
                                    {points.map((p, idx) => (
                                        <div key={p.id} className="relative group">
                                            <div className="flex justify-between items-center mb-1">
                                                <h3 className="text-lime-600 font-bold uppercase text-sm flex items-center gap-2"><span className="bg-lime-100 text-lime-800 text-xs px-2 rounded-full border border-lime-300">{idx+1}</span> Tópico</h3>
                                                <button onClick={()=>{if(confirm('Excluir?'))setPoints(points.filter(x=>x.id!==p.id))}} className="text-red-400 opacity-0 group-hover:opacity-100 transition no-pulpit"><i className="fas fa-times"></i></button>
                                            </div>
                                            <input type="text" value={p.title} onChange={e=>{const n=[...points];n[idx].title=e.target.value;setPoints(n)}} placeholder="Título do Tópico" className="w-full font-bold text-lg mb-1 bg-transparent border-b border-gray-500/20 focus:border-lime-500 outline-none pb-1 preaching-input"/>
                                            <div className="preaching-print-only font-bold">{p.title}</div>
                                            <textarea rows="3" value={p.content} onChange={e=>{const n=[...points];n[idx].content=e.target.value;setPoints(n)}} placeholder="Desenvolvimento..." className="w-full p-3 rounded-lg bg-black/5 border border-gray-500/20 focus:ring-2 focus:ring-lime-500/50 outline-none sermon-text text-lg leading-relaxed preaching-input"></textarea>
                                            <div className="preaching-print-only">{p.content}</div>
                                        </div>
                                    ))}
                                    <button onClick={()=>setPoints([...points, {id:Date.now(), title:'', content:''}])} className="w-full py-2 border-2 border-dashed border-lime-300 text-lime-600 rounded-lg font-bold hover:bg-lime-50 transition no-pulpit">+ Adicionar Tópico</button>
                                </div>

                                <div className="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg">
                                    <label className="text-amber-700 text-xs font-bold uppercase mb-1 block">Ilustração</label>
                                    <textarea rows="2" value={draft.illustration} onChange={e=>setDraft({...draft, illustration:e.target.value})} className="w-full bg-transparent outline-none sermon-text text-lg text-slate-700 preaching-input" placeholder="História ou exemplo..."></textarea>
                                    <div className="preaching-print-only">{draft.illustration}</div>
                                </div>

                                <div>
                                    <div className="text-lime-600 font-bold uppercase text-xs mb-1 flex items-center gap-2 mt-4"><i className="fas fa-flag"></i> Conclusão</div>
                                    <textarea rows="4" value={draft.conclusion} onChange={e=>setDraft({...draft, conclusion:e.target.value})} className="w-full p-3 rounded-lg bg-black/5 border border-gray-500/20 focus:ring-2 focus:ring-lime-500/50 outline-none sermon-text text-lg leading-relaxed preaching-input" placeholder="Apelo final..."></textarea>
                                    <div className="preaching-print-only">{draft.conclusion}</div>
                                </div>
                            </div>
                        </div>
                    </main>

                    {/* MODALS */}
                    {showLib && (
                        <div className="modal-overlay">
                            <div className="bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full max-h-[80vh] flex flex-col border-t-8 border-yellow-500">
                                <div className="flex justify-between mb-4"><h3 className="font-bold text-lg">Biblioteca</h3><button onClick={()=>setShowLib(false)}><i className="fas fa-times"></i></button></div>
                                <button onClick={saveLib} className="bg-yellow-500 text-white w-full py-2 rounded font-bold mb-4 hover:bg-yellow-600">Salvar Atual</button>
                                <div className="flex-1 overflow-y-auto space-y-2">
                                    {library.length===0 && <p className="text-center text-gray-400 italic">Vazio</p>}
                                    {library.map(l=>(
                                        <div key={l.id} className="p-3 border rounded hover:bg-gray-50 flex justify-between items-center">
                                            <div className="overflow-hidden"><div className="font-bold truncate">{l.title || 'Sem Título'}</div><div className="text-xs text-gray-500">{l.dateSaved}</div></div>
                                            <div className="flex gap-2"><button onClick={()=>loadLib(l)} className="text-blue-500 px-2"><i className="fas fa-folder-open"></i></button><button onClick={()=>{if(confirm('Excluir?'))setLibrary(library.filter(x=>x.id!==l.id))}} className="text-red-500 px-2"><i className="fas fa-trash"></i></button></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {showImport && (
                        <div className="modal-overlay">
                            <div className="bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full border-t-8 border-lime-500">
                                <div className="flex justify-between mb-4"><h3 className="font-bold text-lg">Gerador IA</h3><button onClick={()=>setShowImport(false)}><i className="fas fa-times"></i></button></div>
                                <div className="flex gap-2 mb-4">
                                    <button onClick={()=>setPromptType('sermon')} className={`flex-1 py-1 rounded border ${promptType==='sermon'?'bg-lime-100 border-lime-300 font-bold':'border-gray-200'}`}>Pregação</button>
                                    <button onClick={()=>setPromptType('study')} className={`flex-1 py-1 rounded border ${promptType==='study'?'bg-lime-100 border-lime-300 font-bold':'border-gray-200'}`}>Estudo</button>
                                </div>
                                <div className="bg-gray-50 p-2 rounded text-xs mb-2 border">
                                    <p className="font-bold mb-1">1. Copie o comando:</p>
                                    <textarea readOnly value={getPrompt()} className="w-full h-16 bg-white border p-1 mb-1 resize-none text-gray-600"></textarea>
                                    <button onClick={()=>{navigator.clipboard.writeText(getPrompt()); alert("Copiado!");}} className="bg-lime-600 text-white w-full py-1 rounded text-xs font-bold">Copiar Prompt</button>
                                </div>
                                <div className="bg-white border-2 border-dashed border-gray-300 p-2 rounded">
                                    <p className="text-xs font-bold mb-1">2. Cole a resposta JSON aqui:</p>
                                    <textarea value={jsonInput} onChange={e=>setJsonInput(e.target.value)} className="w-full h-20 p-2 text-xs border rounded resize-none" placeholder="{ ... }"></textarea>
                                </div>
                                <button onClick={processJson} className="w-full bg-lime-600 hover:bg-lime-700 text-white py-2 rounded font-bold mt-4 shadow-lg">Gerar</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MÓDULO GAMES SCREEN (INTEGRAÇÃO) ---
        // (Omitted for brevity, logic kept same as previous file)
        const GamesScreen = ({ onBack }) => {
            const [activeGame, setActiveGame] = useState(null);
            const gameContainerRef = useRef(null);
            const cleanupRef = useRef(null);

            useEffect(() => {
                if (activeGame && gameContainerRef.current) {
                    gameContainerRef.current.innerHTML = '';
                    const startAudio = async () => { await Tone.start(); console.log('Áudio iniciado'); };
                    startAudio();
                    switch (activeGame.id) {
                        case 'damas': cleanupRef.current = typeof initDamas === 'function' ? initDamas(gameContainerRef.current) : null; break;
                        case 'forca': cleanupRef.current = typeof initForca === 'function' ? initForca(gameContainerRef.current) : null; break;
                        case 'memoria': cleanupRef.current = typeof initMemoria === 'function' ? initMemoria(gameContainerRef.current) : null; break;
                        case 'velha': cleanupRef.current = typeof initVelha === 'function' ? initVelha(gameContainerRef.current) : null; break;
                        case 'quiz': cleanupRef.current = typeof initQuiz === 'function' ? initQuiz(gameContainerRef.current) : null; break;
                        case 'aero': cleanupRef.current = typeof initAeroStriker === 'function' ? initAeroStriker(gameContainerRef.current) : null; break;
                        default: gameContainerRef.current.innerHTML = '<div class="text-white text-center p-10">Jogo não encontrado ou em manutenção.</div>';
                    }
                }
                return () => { if (cleanupRef.current) { cleanupRef.current(); cleanupRef.current = null; } };
            }, [activeGame]);

            const handleCloseGame = () => { setActiveGame(null); };

            if (activeGame) {
                return (
                    <div className="fixed inset-0 z-[100] bg-gray-900 flex flex-col h-full animate-fadeIn">
                        <div className="flex justify-between items-center p-4 bg-gray-800 border-b border-gray-700 shadow-md shrink-0">
                            <h2 className="text-xl font-bold text-white pixel-font truncate flex items-center gap-3">
                                <i className={`fas ${activeGame.icon} ${activeGame.text}`}></i>
                                {activeGame.label}
                            </h2>
                            <button onClick={handleCloseGame} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2 font-bold text-sm">
                                <i className="fas fa-times"></i> <span className="hidden sm:inline">SAIR</span>
                            </button>
                        </div>
                        <div id="game-content" ref={gameContainerRef} className="flex-grow w-full overflow-auto p-4 flex justify-center items-start md:items-center bg-gray-900"></div>
                    </div>
                );
            }

            return (
                <div className="animate-fadeIn pb-20 bg-gray-900 min-h-screen">
                    <header className="bg-gray-800 p-4 border-b border-gray-700 sticky top-0 z-10 flex items-center justify-between shadow-lg">
                         <button onClick={onBack} className="text-blue-400 font-bold flex items-center gap-2 text-sm hover:text-blue-300 transition">
                            <i className="fas fa-arrow-left"></i> Voltar
                        </button>
                        <h1 className="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 pixel-font">ARCADE HUB</h1>
                        <div className="w-10"></div>
                    </header>

                    <div className="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-4xl mx-auto mt-4">
                        {GAMES_LIST.map((game) => (
                            <div key={game.id} onClick={() => setActiveGame(game)} className="bg-gray-800 rounded-xl p-6 cursor-pointer border border-gray-700 hover:border-blue-500 hover:-translate-y-1 transition-all duration-200 shadow-lg group relative overflow-hidden">
                                <div className={`absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity ${game.text}`}><i className={`fas ${game.icon} text-6xl`}></i></div>
                                <div className={`h-12 w-12 rounded-full ${game.color} bg-opacity-20 flex items-center justify-center mb-4 group-hover:bg-opacity-40 transition-colors`}><i className={`fas ${game.icon} ${game.text} text-2xl`}></i></div>
                                <h3 className="text-lg font-bold text-white mb-1 group-hover:text-blue-300 transition-colors">{game.label}</h3>
                                <p className="text-gray-400 text-xs">Clique para jogar</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 4. COMPONENTES PRINCIPAIS ADICIONAIS ---
        const HomeScreen = ({ setActiveTab }) => (
            <div className="p-4 animate-fadeIn space-y-6">
                <div className="bg-gradient-to-r from-red-800 to-red-600 rounded-2xl p-6 text-white text-center shadow-lg transform transition hover:scale-[1.02]">
                    <h1 className="font-serif italic text-xl mb-2">"Lâmpada para os meus pés é a tua palavra."</h1>
                    <p className="text-xs uppercase opacity-70 font-bold">Salmos 119:105</p>
                </div>
                <div className="grid grid-cols-3 gap-3">
                    {NAV_ITEMS.filter(i => i.id !== 'home').map(item => (
                        <button key={item.id} onClick={() => setActiveTab(item.id)} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center gap-2 hover:bg-red-50 transition-colors active:scale-95">
                            <i className={`fas ${item.icon} text-red-600 text-xl`}></i>
                            <span className="text-xs font-bold text-gray-700">{item.label}</span>
                        </button>
                    ))}
                </div>
            </div>
        );

        const ScreenPlaceholder = ({ title, icon, onBack }) => (
            <div className="p-6 animate-fadeIn text-center mt-10">
                <button onClick={onBack} className="mb-8 text-red-600 font-bold flex items-center justify-center gap-2 mx-auto"><i className="fas fa-arrow-left"></i> Voltar</button>
                <div className="w-24 h-24 bg-gray-200 rounded-full mx-auto flex items-center justify-center text-5xl text-gray-400 mb-6"><i className={`fas ${icon}`}></i></div>
                <h2 className="text-2xl font-bold text-gray-700">{title}</h2>
                <p className="text-gray-500 mt-2">Módulo em construção.</p>
            </div>
        );

        const BibleScreen = ({ onBack }) => {
            const [book, setBook] = useState('Gênesis');
            const [chapter, setChapter] = useState(1);
            const [verses, setVerses] = useState([]);
            const [loading, setLoading] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [highlights, setHighlights] = useState(() => { try { return JSON.parse(localStorage.getItem('bible_highlights')) || {}; } catch { return {}; } });

            useEffect(() => {
                setLoading(true); window.speechSynthesis.cancel(); setIsSpeaking(false);
                fetch(`https://bible-api.com/${book}+${chapter}?translation=almeida`).then(res => res.json()).then(data => { setVerses(data.verses || []); setLoading(false); }).catch(() => { setVerses([{ text: "Erro de conexão." }]); setLoading(false); });
            }, [book, chapter]);

            const toggleAudio = () => {
                if (isSpeaking) { window.speechSynthesis.cancel(); setIsSpeaking(false); }
                else { const u = new SpeechSynthesisUtterance(verses.map(v => v.text).join(' ')); u.lang = 'pt-BR'; u.onend = () => setIsSpeaking(false); window.speechSynthesis.speak(u); setIsSpeaking(true); }
            };

            const toggleHighlight = (vNum) => {
                const k = `${book}-${chapter}-${vNum}`; const n = { ...highlights }; if (n[k]) delete n[k]; else n[k] = '#fef08a';
                setHighlights(n); localStorage.setItem('bible_highlights', JSON.stringify(n));
            };

            return (
                <div className="animate-fadeIn min-h-screen bg-white flex flex-col">
                    <div className="sticky top-0 bg-white border-b z-20 px-4 py-3 shadow-sm">
                        <div className="flex justify-between items-center mb-3">
                            <button onClick={() => { window.speechSynthesis.cancel(); onBack(); }} className="text-red-600 font-bold flex items-center gap-2 text-sm"><i className="fas fa-arrow-left"></i> Voltar</button>
                            <button onClick={toggleAudio} className={`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${isSpeaking ? 'bg-red-500 text-white animate-pulse' : 'bg-gray-100 text-gray-600'}`}><i className={`fas ${isSpeaking ? 'fa-stop' : 'fa-volume-high'}`}></i></button>
                        </div>
                        <div className="flex gap-2">
                            <select value={book} onChange={(e) => { setChapter(1); setBook(e.target.value); }} className="flex-1 p-2 bg-gray-50 border border-gray-200 rounded-lg font-bold text-gray-800 outline-none text-sm">{BIBLE_BOOKS.map(b => <option key={b} value={b}>{b}</option>)}</select>
                            <select value={chapter} onChange={(e) => setChapter(Number(e.target.value))} className="w-20 p-2 bg-gray-50 border border-gray-200 rounded-lg font-bold text-gray-800 outline-none text-sm">{[...Array(150)].map((_, i) => <option key={i+1} value={i+1}>{i+1}</option>)}</select>
                        </div>
                    </div>
                    <div className="p-5 pb-24 font-serif text-lg leading-relaxed text-gray-800 flex-grow">
                        {loading ? <div className="text-center py-20 text-gray-400"><i className="fas fa-circle-notch fa-spin text-3xl mb-3 text-red-300"></i><p>Carregando...</p></div> : verses.map((v, i) => { const vNum = i + 1; return <p key={i} onClick={() => toggleHighlight(vNum)} className="mb-3 cursor-pointer p-1 rounded hover:bg-gray-50" style={{ backgroundColor: highlights[`${book}-${chapter}-${vNum}`] || 'transparent' }}><sup className="text-red-500 font-bold text-xs mr-1">{vNum}</sup>{v.text}</p> })}
                    </div>
                </div>
            );
        };

        // --- 5. APP PRINCIPAL ---
        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const goHome = () => setActiveTab('home');

            // Header Principal é ocultado quando estamos no Estúdio, Financeiro, Jogo Ativo ou Pregação (que tem seu próprio header)
            const hideHeader = activeTab === 'financial' || activeTab === 'studio' || activeTab === 'preaching' || activeTab === 'games';

            return (
                <div className="min-h-screen bg-gray-50 max-w-md mx-auto shadow-2xl bg-white relative flex flex-col">
                    {!hideHeader && (
                        <header className="bg-red-800 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-md main-header-nav">
                            <div className="flex items-center gap-2"><i className="fas fa-layer-group"></i><span className="font-bold tracking-wide">Sistema Vida</span></div>
                            {activeTab !== 'home' && <button onClick={goHome} className="bg-red-900/50 w-8 h-8 rounded-full flex items-center justify-center text-sm hover:bg-red-700 transition"><i className="fas fa-home"></i></button>}
                        </header>
                    )}

                    <main className="flex-grow">
                        {activeTab === 'home' && <HomeScreen setActiveTab={setActiveTab} />}
                        {activeTab === 'bible' && <BibleScreen onBack={goHome} />}
                        {activeTab === 'financial' && <ErrorBoundary><FinancialApp onBack={goHome} /></ErrorBoundary>}
                        {activeTab === 'studio' && <StudioScreen onBack={goHome} />}
                        {activeTab === 'games' && <GamesScreen onBack={goHome} />}
                        {activeTab === 'preaching' && <PreachingScreen onBack={goHome} />}
                        
                        {/* NOVAS ABAS INTEGRADAS */}
                        {activeTab === 'names' && <NamesScreen onBack={goHome} />}
                        {activeTab === 'qrcode' && <QRCodeScreen onBack={goHome} />}
                        {activeTab === 'radio' && <RadioScreen onBack={goHome} />}
                        {activeTab === 'notes' && <DiaryScreen onBack={goHome} />}
                    </main>

                    {activeTab === 'home' && (
                        <footer className="w-full bg-white border-t p-3 text-center text-[10px] text-gray-400 uppercase tracking-widest">Sistema Vida v2.0 • Integrado</footer>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
