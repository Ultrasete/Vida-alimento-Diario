<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Vida - Alimento Di√°rio</title>
    
    <!-- Carregar React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Carregar Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Carregar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Biblioteca QR Code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Carregar Tone.js para √°udio dos Jogos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    
    <!-- Fonte Merriweather & Press Start 2P & Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        .font-serif { font-family: 'Merriweather', serif; }
        .font-handwriting { font-family: 'Courier New', Courier, monospace; }
        .font-arcade { font-family: 'Press Start 2P', cursive; }
        .font-inter { font-family: 'Inter', sans-serif; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* Anima√ß√£o das barras de √°udio */
        @keyframes sound-bar {
            0% { height: 10%; }
            50% { height: 100%; }
            100% { height: 10%; }
        }
        .sound-bar {
            width: 6px;
            background-color: #FCD34D; /* yellow-300 */
            border-radius: 99px;
            animation: sound-bar 0.8s infinite ease-in-out;
        }
        .sound-bar:nth-child(1) { animation-delay: 0.1s; }
        .sound-bar:nth-child(2) { animation-delay: 0.3s; }
        .sound-bar:nth-child(3) { animation-delay: 0.5s; }
        .sound-bar:nth-child(4) { animation-delay: 0.2s; }
        .sound-bar:nth-child(5) { animation-delay: 0.4s; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c0c0c0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }
        
        /* Cursor de movimento para o canvas */
        canvas.cursor-move { cursor: move; }

        /* --- Estilos do Jogo da Mem√≥ria (3D Flip) --- */
        .memory-card {
            perspective: 1000px;
            cursor: pointer;
        }
        .memory-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 0.5rem;
        }
        .memory-card.is-flipped .memory-card-inner {
            transform: rotateY(180deg);
        }
        .memory-card-front,
        .memory-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .memory-card-back {
            background-color: #3B82F6; /* blue-500 */
            color: white;
            font-size: 2rem;
            transform: rotateY(0deg);
        }
        .memory-card-front {
            background-color: #E5E7EB; /* gray-200 */
            color: #1F2937;
            font-size: 2.5rem;
            transform: rotateY(180deg);
        }

        /* --- Estilos da Forca --- */
        .hangman-part {
            transition: opacity 0.5s ease-in-out;
            stroke: #374151;
            stroke-width: 4;
            stroke-linecap: round;
        }

        @media print {
            .no-print { display: none !important; }
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; background: white; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, Component, useMemo, useCallback } = React;

        // --- ERROR BOUNDARY ---
        class ErrorBoundary extends Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            componentDidCatch(error, errorInfo) { this.setState({ error: error }); console.error(error, errorInfo); }
            render() {
                if (this.state.hasError) return <div className="p-8 text-center text-red-800"><h1>Algo correu mal.</h1><button onClick={()=>window.location.reload()} className="mt-4 bg-red-700 text-white px-4 py-2 rounded">Recarregar</button></div>;
                return this.props.children;
            }
        }
        
        // --- HOOK PERSIST√äNCIA ---
        function usePersistentState(key, initialValue) {
            const [state, setState] = useState(() => {
                try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : initialValue; } catch { return initialValue; }
            });
            useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch {} }, [key, state]);
            return [state, setState];
        }

        // --- SISTEMA DE SOM GERAL ---
        const playSoundEffect = (type) => {
            try {
                const now = Tone.now();
                if (type === 'quiz_correct') {
                    const osc = new Tone.Oscillator(600, "sine").toDestination();
                    osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                    osc.start().stop(now + 0.5);
                } else if (type === 'quiz_wrong') {
                    const osc = new Tone.Oscillator(150, "sawtooth").toDestination();
                    osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                    osc.start().stop(now + 0.3);
                } else if (type === 'quiz_win') {
                    const synth = new Tone.PolySynth(Tone.Synth).toDestination();
                    synth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "8n");
                } else if (type === 'hangman_correct') {
                    const synth = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 } }).toDestination();
                    synth.triggerAttackRelease('E5', '16n', now);
                } else if (type === 'hangman_wrong') {
                    const synth = new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.05, decay: 0.2, sustain: 0, release: 0.1 } }).toDestination();
                    synth.triggerAttackRelease('A2', '8n', now);
                } else if (type === 'hangman_win') {
                    const synth = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.05, decay: 0.5, sustain: 0, release: 0.1 } }).toDestination();
                    synth.triggerAttackRelease('C4', '8n', now);
                    synth.triggerAttackRelease('E4', '8n', now + 0.1);
                    synth.triggerAttackRelease('G4', '8n', now + 0.2);
                    synth.triggerAttackRelease('C5', '8n', now + 0.3);
                } else if (type === 'hangman_lose') {
                    const synth = new Tone.Synth({ oscillator: { type: 'sine' } }).toDestination();
                    synth.triggerAttackRelease('C4', '8n', now);
                    synth.triggerAttackRelease('Eb4', '8n', now + 0.1);
                    synth.triggerAttackRelease('Gb4', '8n', now + 0.2);
                    synth.triggerAttackRelease('A4', '8n', now + 0.3);
                }
            } catch (e) { console.error("Erro audio", e); }
        };

        // --- √çCONES SVG ---
        const icons = {
            'home': <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
            'book-open': <><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>,
            'heart': <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>,
            'dollar-sign': <><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></>,
            'activity': <path d="M22 12h-4l-3 9L9 3l-3 9H2" />,
            'sun': <><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></>,
            'edit-3': <><path d="M12 20h9" /><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z" /></>,
            'menu': <><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>,
            'x': <><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>,
            'chevron-left': <path d="m15 18-6-6 6-6" />,
            'chevron-right': <path d="m9 18 6-6-6-6" />,
            'image': <><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><circle cx="9" cy="9" r="2" /><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" /></>,
            'download': <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>,
            'sparkles': <><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M9 3v4" /><path d="M3 5h4" /><path d="M3 9h4" /></>,
            'user': <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
            'gamepad-2': <><line x1="6" x2="10" y1="12" y2="12" /><line x1="8" x2="8" y1="10" y2="14" /><line x1="15" x2="15.01" y1="13" y2="13" /><line x1="18" x2="18.01" y1="11" y2="11" /><rect width="20" height="12" x="2" y="6" rx="2" /></>,
            'radio': <><circle cx="12" cy="12" r="2" /><path d="M16.24 7.76a6 6 0 0 1 0 8.49" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /></>,
            'music': <><path d="M9 18V5l12-2v13" /><circle cx="6" cy="18" r="3" /><circle cx="18" cy="16" r="3" /></>,
            'megaphone': <><path d="m3 11 18-5v12L3 14v-3z" /><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6" /></>,
            'refresh-cw': <><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></>,
            'search': <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
            'printer': <><polyline points="6 9 6 2 18 2 18 9" /><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" /><rect width="12" height="8" x="6" y="14" /></>,
            'volume-2': <><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /></>,
            'square': <rect width="18" height="18" x="3" y="3" rx="2" />,
            'plus': <><path d="M5 12h14" /><path d="M12 5v14" /></>,
            'minus': <path d="M5 12h14" />,
            'check-circle': <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></>,
            'external-link': <><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" x2="21" y1="14" y2="3" /></>,
            'qr-code': <><rect width="5" height="5" x="3" y="3" rx="1" /><rect width="5" height="5" x="16" y="3" rx="1" /><rect width="5" height="5" x="3" y="16" rx="1" /><path d="M21 16h-3a2 2 0 0 0-2 2v3" /><path d="M21 21v.01" /><path d="M12 7v3a2 2 0 0 1-2 2H7" /><path d="M3 12h.01" /><path d="M12 3h.01" /><path d="M12 16v.01" /><path d="M16 12h1" /><path d="M21 12v.01" /><path d="M12 21v-1" /></>,
            'arrow-left': <><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></>,
            'share-2': <><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" /></>,
            'link': <><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></>,
            'calendar': <><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></>,
            'clock': <circle cx="12" cy="12" r="10" />,
            'grid': <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />,
            'anchor': <><circle cx="12" cy="5" r="3" /><line x1="12" y1="22" x2="12" y2="8" /><path d="M5 12H2a10 10 0 0 0 20 0h-3" /></>,
            'play': <polygon points="5 3 19 12 5 21 5 3" />,
            'pause': <><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></>,
            'trash-2': <><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>,
            'trending-up': <><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>,
            'trending-down': <><polyline points="23 18 13.5 8.5 8.5 13.5 1 6" /><polyline points="17 18 23 18 23 12" /></>,
            'credit-card': <><rect x="1" y="4" width="22" height="16" rx="2" ry="2" /><line x1="1" y1="10" x2="23" y2="10" /></>
        };

        const IconWrapper = ({ name, size = 24, className = "" }) => {
            const content = icons[name] || null;
            if (!content) return null;
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={{ display: 'inline-block', verticalAlign: 'middle' }}>
                    {content}
                </svg>
            );
        };

        // --- HELPERS ---
        function formatarEMV(id, value) { const length = ('00' + value.length).slice(-2); return `${id}${length}${value}`; }
        function simplificarTexto(text) { return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\s]/g, ''); }
        function crc16(data) { let crc = 0xFFFF; for (let i = 0; i < data.length; i++) { crc ^= data.charCodeAt(i) << 8; for (let j = 0; j < 8; j++) { crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1; } } return ('0000' + (crc & 0xFFFF).toString(16).toUpperCase()).slice(-4); }
        const formatDateKey = (date) => date.toISOString().split('T')[0];
        const formatDateDisplay = (date) => date.toLocaleDateString('pt-PT', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

        // --- DADOS PARA A FORCA ---
        const HANGMAN_CATEGORIES = {
            'FRUTAS': ['MELANCIA', 'ABACAXI', 'BANANA', 'MORANGO', 'LARANJA', 'UVA', 'MANGA', 'PERA', 'ABACATE', 'CUPUACU'],
            'ANIMAIS': ['CACHORRO', 'GIRAFA', 'ELEFANTE', 'LEAO', 'MACACO', 'TIGRE', 'ZEBRA', 'COELHO', 'GATO', 'ONCA'],
            'PA√çSES': ['BRASIL', 'ARGENTINA', 'CANADA', 'JAPAO', 'ITALIA', 'FRAN√áA', 'EGITO', 'ESPANHA', 'CHINA'],
            'CARROS': ['FUSCA', 'GOL', 'PALIO', 'ONIX', 'COROLLA', 'CIVIC', 'MUSTANG', 'CAMARO', 'SAVEIRO'],
            'OBJETOS': ['CADEIRA', 'MESA', 'COMPUTADOR', 'TELEFONE', 'LIVRO', 'GARRAFA', 'JANELA', 'PORTA', 'SOFA', 'TACA']
        };

        // --- DADOS NAV ---
        const NAV_ITEMS = [
            { id: 'home', label: 'In√≠cio', icon: 'home' },
            { id: 'bible', label: 'B√≠blia', icon: 'book-open' },
            { id: 'themes', label: 'Temas', icon: 'heart' },
            { id: 'share', label: 'Cart√µes', icon: 'image' },
            { id: 'names', label: 'Nomes', icon: 'user' },
            { id: 'finance', label: 'Financeiro', icon: 'dollar-sign' },
            { id: 'preaching', label: 'Prega√ß√£o', icon: 'megaphone' },
            { id: 'games', label: 'Jogos', icon: 'gamepad-2' },
            { id: 'qrcode', label: 'QR Code', icon: 'qr-code' },
            { id: 'radio', label: 'R√°dio', icon: 'radio' },
            { id: 'notes', label: 'Di√°rio', icon: 'calendar' }
        ];

        // --- BANCO DE DADOS E DADOS ---
        const preachingDatabase = [
             {
                ref: "Jo√£o 3:16",
                theme: "O Amor Incompar√°vel",
                text: "Porque Deus amou o mundo de tal maneira que deu o seu Filho unig√™nito...",
                explanation: `üìñ **Introdu√ß√£o**\nEste vers√≠culo √© o cora√ß√£o do Evangelho. Ele revela a profundidade do amor de Deus por uma humanidade ca√≠da.\n\n1Ô∏è‚É£ **A Fonte do Amor:** "Porque Deus amou..." O amor n√£o come√ßa em n√≥s, mas nEle. √â Sua natureza.\n2Ô∏è‚É£ **A Dimens√£o do Amor:** "...de tal maneira..." Um amor sem medidas, sacrificial e incondicional.\n3Ô∏è‚É£ **A A√ß√£o do Amor:** "...que deu o seu Filho..." Amor n√£o √© s√≥ sentimento, √© atitude. Deus deu o Seu melhor.\n4Ô∏è‚É£ **O Prop√≥sito:** "...para que todo aquele que nele cr√™ n√£o pere√ßa..." A salva√ß√£o est√° acess√≠vel a todos atrav√©s da f√©.\n\nüôå **Conclus√£o**\nN√£o rejeite este amor. Ele j√° fez tudo por voc√™. Receba a vida eterna hoje.`
            },
            {
                ref: "Salmos 23:1",
                theme: "O Pastor Suficiente",
                text: "O Senhor √© o meu pastor, nada me faltar√°.",
                explanation: `üìñ **Introdu√ß√£o**\nDavi, um pastor experiente, reconhece que ele mesmo √© uma ovelha sob o cuidado do Grande Pastor.\n\n1Ô∏è‚É£ **Relacionamento Pessoal:** "O Senhor √© o MEU pastor". N√£o √© um Deus distante, mas algu√©m √≠ntimo e pessoal.\n2Ô∏è‚É£ **Provis√£o Completa:** "Nada me faltar√°". N√£o significa luxo, mas que o essencial para a vida e a piedade ser√° suprido.\n3Ô∏è‚É£ **Descanso e Dire√ß√£o:** O pastor leva a √°guas tranquilas e guia pelas veredas da justi√ßa.\n\nüôå **Conclus√£o**\nSe voc√™ est√° ansioso, lembre-se de quem √© o seu Pastor. A ovelha n√£o se preocupa, ela apenas segue a voz do dono.`
            },
            {
                ref: "Filipenses 4:13",
                theme: "A Verdadeira For√ßa",
                text: "Tudo posso naquele que me fortalece.",
                explanation: `üìñ **Introdu√ß√£o**\nEste texto foi escrito por Paulo na pris√£o! N√£o √© sobre conquistar tudo o que queremos, mas sobre suportar tudo com Cristo.\n\n1Ô∏è‚É£ **O Contexto de Contentamento:** Paulo aprendeu a viver contente na fartura e na escassez.\n2Ô∏è‚É£ **A Fonte de Energia:** "Naquele". A for√ßa n√£o vem de "dentro" (autoajuda), vem de Cristo.\n3Ô∏è‚É£ **A Capacidade:** "Tudo posso" significa que posso enfrentar qualquer circunst√¢ncia sem perder a f√© ou a alegria.\n\nüôå **Conclus√£o**\nVoc√™ n√£o vai quebrar. A for√ßa de Cristo em voc√™ √© maior que a press√£o de fora.`
            }
        ];
        const bibleQuizDatabase = [
            { question: "Quem construiu a arca?", options: ["Mois√©s", "No√©", "Abra√£o", "Davi"], answer: 1 },
            { question: "Qual √© o primeiro livro da B√≠blia?", options: ["Mateus", "Apocalipse", "G√™nesis", "√äxodo"], answer: 2 },
            { question: "Quem derrotou o gigante Golias?", options: ["Davi", "Saul", "Salom√£o", "Sans√£o"], answer: 0 },
            { question: "Onde Jesus nasceu?", options: ["Nazar√©", "Jerusal√©m", "Bel√©m", "Galileia"], answer: 2 },
            { question: "Quem foi engolido por um grande peixe?", options: ["Pedro", "Jonas", "Paulo", "Jo√£o"], answer: 1 },
            { question: "Qual o nome da esposa de Abra√£o?", options: ["Raquel", "Rebeca", "Sara", "Lia"], answer: 2 },
            { question: "Quantos mandamentos Deus deu a Mois√©s?", options: ["5", "7", "10", "12"], answer: 2 },
            { question: "Quem traiu Jesus?", options: ["Pedro", "Judas Iscariotes", "Tiago", "Tom√©"], answer: 1 },
            { question: "Quem abriu o Mar Vermelho?", options: ["Elias", "Mois√©s", "Josu√©", "Ar√£o"], answer: 1 },
            { question: "Qual profeta foi levado ao c√©u numa carruagem de fogo?", options: ["Elias", "Eliseu", "Isa√≠as", "Jeremias"], answer: 0 }
        ];
        const radioStations = [
            { id: 1, name: "Melhores Louvores", videoId: "PLz8XQOhoC307g-L3L-WfQy5Cq-LdY_KzD", color: "bg-yellow-500" },
            { id: 2, name: "Adora√ß√£o Profunda", videoId: "PLz8XQOhoC305-qO9gV7z-XQy5Cq-LdY_K", color: "bg-red-700" },
            { id: 3, name: "Gospel Internacional", videoId: "PLz8XQOhoC306-qO9gV7z-XQy5Cq-LdY_K", color: "bg-gray-400" }
        ];
        
        // --- BASE DE DADOS DE VERS√çCULOS EXPANDIDA ---
        const verseDatabase = {
            motivacao: [
                { text: "Porque sou eu que conhe√ßo os planos que tenho para v√≥s, diz o Senhor, planos de fazer-vos prosperar e n√£o de causar dano, planos de dar-vos esperan√ßa e um futuro.", ref: "Jeremias 29:11" },
                { text: "Tudo posso naquele que me fortalece.", ref: "Filipenses 4:13" },
                { text: "Sede fortes e corajosos; n√£o temais, nem vos atemorizeis diante deles; porque o Senhor vosso Deus √© quem vai convosco. N√£o vos deixar√°, nem vos desamparar√°.", ref: "Deuteron√¥mio 31:6" },
                { text: "Mas os que esperam no Senhor renovar√£o as for√ßas, subir√£o com asas como √°guias; correr√£o, e n√£o se cansar√£o; caminhar√£o, e n√£o se fatigar√£o.", ref: "Isa√≠as 40:31" },
                { text: "N√£o fui eu que ordenei a voc√™? Seja forte e corajoso! N√£o se apavore nem desanime, pois o Senhor, o seu Deus, estar√° com voc√™ por onde voc√™ andar.", ref: "Josu√© 1:9" },
                { text: "Entrega o teu caminho ao Senhor; confia nele, e ele o far√°.", ref: "Salmos 37:5" },
                { text: "E Jesus, olhando para eles, disse-lhe: Aos homens √© isso imposs√≠vel, mas a Deus tudo √© poss√≠vel.", ref: "Mateus 19:26" },
                { text: "Mil cair√£o ao teu lado, e dez mil √† tua direita, mas n√£o chegar√° a ti.", ref: "Salmos 91:7" },
                { text: "O Senhor √© a minha luz e a minha salva√ß√£o; a quem temerei? O Senhor √© a for√ßa da minha vida; de quem me recearei?", ref: "Salmos 27:1" },
                { text: "Porque para Deus nada √© imposs√≠vel.", ref: "Lucas 1:37" },
                { text: "Ainda que eu andasse pelo vale da sombra da morte, n√£o temeria mal algum, porque tu est√°s comigo.", ref: "Salmos 23:4" },
                { text: "Vinde a mim, todos os que estais cansados e oprimidos, e eu vos aliviarei.", ref: "Mateus 11:28" },
                { text: "Mas, em todas estas coisas somos mais que vencedores, por aquele que nos amou.", ref: "Romanos 8:37" },
                { text: "O choro pode durar uma noite, mas a alegria vem pela manh√£.", ref: "Salmos 30:5" },
                { text: "Ora, a f√© √© a certeza daquilo que esperamos e a prova das coisas que n√£o vemos.", ref: "Hebreus 11:1" },
                { text: "N√£o andeis ansiosos por coisa alguma; antes em tudo sejam os vossos pedidos conhecidos diante de Deus pela ora√ß√£o e s√∫plica com a√ß√µes de gra√ßas.", ref: "Filipenses 4:6" },
                { text: "Confia no Senhor de todo o teu cora√ß√£o e n√£o te estribes no teu pr√≥prio entendimento.", ref: "Prov√©rbios 3:5" },
                { text: "Deus √© o nosso ref√∫gio e fortaleza, socorro bem presente na ang√∫stia.", ref: "Salmos 46:1" },
                { text: "Portanto, n√£o se preocupem com o amanh√£, pois o amanh√£ trar√° as suas pr√≥prias preocupa√ß√µes. Basta a cada dia o seu pr√≥prio mal.", ref: "Mateus 6:34" },
                { text: "Sabemos que Deus age em todas as coisas para o bem daqueles que o amam, dos que foram chamados de acordo com o seu prop√≥sito.", ref: "Romanos 8:28" }
            ],
            financeiro: [
                { text: "O rico domina sobre os pobres e o que toma emprestado √© servo do que empresta.", ref: "Prov√©rbios 22:7" },
                { text: "Honra ao Senhor com os teus bens, e com a primeira parte de todos os teus ganhos.", ref: "Prov√©rbios 3:9" },
                { text: "Pois qual de v√≥s, querendo edificar uma torre, n√£o se assenta primeiro a fazer as contas dos gastos?", ref: "Lucas 14:28" },
                { text: "O meu Deus suprir√° todas as vossas necessidades segundo as suas riquezas na gl√≥ria em Cristo Jesus.", ref: "Filipenses 4:19" },
                { text: "Lembra-te do Senhor teu Deus, porque √© ele que te d√° for√ßa para adquirires riquezas.", ref: "Deuteron√¥mio 8:18" },
                { text: "O Senhor te abrir√° o seu bom tesouro, o c√©u, para dar chuva √† tua terra no seu tempo, e para aben√ßoar toda a obra das tuas m√£os.", ref: "Deuteron√¥mio 28:12" },
                { text: "A b√™n√ß√£o do Senhor √© que enriquece; e n√£o traz consigo dores.", ref: "Prov√©rbios 10:22" },
                { text: "O homem fiel ser√° cumulado de b√™n√ß√£os, mas o que se apressa a enriquecer n√£o ficar√° impune.", ref: "Prov√©rbios 28:20" },
                { text: "Dai, e ser-vos-√° dado; boa medida, recalcada, sacudida e transbordando, vos deitar√£o no vosso rega√ßo.", ref: "Lucas 6:38" },
                { text: "Quem ama o dinheiro jamais dele se farta; e quem ama a abund√¢ncia nunca se farta da renda.", ref: "Eclesiastes 5:10" },
                { text: "Mais vale o pouco com o temor do Senhor, do que um grande tesouro onde h√° inquieta√ß√£o.", ref: "Prov√©rbios 15:16" },
                { text: "Trazei todos os d√≠zimos √† casa do tesouro, para que haja mantimento na minha casa.", ref: "Malaquias 3:10" },
                { text: "Bem-aventurado o homem que teme ao Senhor... Prosperidade e riquezas haver√° na sua casa.", ref: "Salmos 112:1-3" },
                { text: "Consagre ao Senhor tudo o que voc√™ faz, e os seus planos ser√£o bem-sucedidos.", ref: "Prov√©rbios 16:3" },
                { text: "A riqueza obtida com falsidade √© neblina que se dissipa e armadilha mortal.", ref: "Prov√©rbios 21:6" },
                { text: "N√£o amem o dinheiro e contentem-se com o que voc√™s t√™m.", ref: "Hebreus 13:5" },
                { text: "O pregui√ßoso deseja e nada tem, mas a alma dos diligentes engorda.", ref: "Prov√©rbios 13:4" },
                { text: "A riqueza de proced√™ncia v√£ diminuir√°, mas quem a ajunta com o pr√≥prio trabalho a aumentar√°.", ref: "Prov√©rbios 13:11" }
            ],
            espiritual: [
                { text: "Vinde a mim, todos os que estais cansados e oprimidos, e eu vos aliviarei.", ref: "Mateus 11:28" },
                { text: "Verdadeiramente ele tomou sobre si as nossas enfermidades, e as nossas dores levou sobre si.", ref: "Isa√≠as 53:4" },
                { text: "Sara os quebrantados de cora√ß√£o, e lhes ata as suas feridas.", ref: "Salmo 147:3" },
                { text: "Ele √© quem perdoa todas as tuas iniquidades; quem sara todas as tuas enfermidades.", ref: "Salmos 103:3" },
                { text: "A ora√ß√£o da f√© salvar√° o doente, e o Senhor o levantar√°.", ref: "Tiago 5:15" },
                { text: "Cura-me, Senhor, e sararei; salva-me, e serei salvo; porque tu √©s o meu louvor.", ref: "Jeremias 17:14" },
                { text: "Eis que eu trarei a ela sa√∫de e cura, e os sararei, e lhes manifestarei abund√¢ncia de paz e de verdade.", ref: "Jeremias 33:6" },
                { text: "Pelas suas pisaduras fomos sarados.", ref: "Isa√≠as 53:5" },
                { text: "O Senhor o sustentar√° no leito da enfermidade; tu o restaurar√°s da sua cama de doen√ßa.", ref: "Salmos 41:3" },
                { text: "N√£o temas, porque eu sou contigo; n√£o te assombres, porque eu sou teu Deus; eu te fortale√ßo, e te ajudo, e te sustento com a destra da minha justi√ßa.", ref: "Isa√≠as 41:10" },
                { text: "Visto que voc√™ √© precioso e honrado √† minha vista, e porque eu o amo...", ref: "Isa√≠as 43:4" },
                { text: "Lan√ßando sobre ele toda a vossa ansiedade, porque ele tem cuidado de v√≥s.", ref: "1 Pedro 5:7" },
                { text: "Deixo-vos a paz, a minha paz vos dou; n√£o vo-la dou como o mundo a d√°. N√£o se turbe o vosso cora√ß√£o, nem se atemorize.", ref: "Jo√£o 14:27" },
                { text: "Clama a mim, e responder-te-ei, e anunciar-te-ei coisas grandes e firmes que n√£o sabes.", ref: "Jeremias 33:3" },
                { text: "Porque eu, o Senhor teu Deus, te tomo pela tua m√£o direita; e te digo: N√£o temas, eu te ajudo.", ref: "Isa√≠as 41:13" },
                { text: "O Senhor est√° perto dos que t√™m o cora√ß√£o quebrantado e salva os de esp√≠rito abatido.", ref: "Salmos 34:18" }
            ],
            familia: [
                { text: "Cr√™ no Senhor Jesus e ser√°s salvo, tu e a tua casa.", ref: "Atos 16:31" },
                { text: "Educa a crian√ßa no caminho em que deve andar; e at√© quando envelhecer n√£o se desviar√° dele.", ref: "Prov√©rbios 22:6" },
                { text: "Acima de tudo, por√©m, tende amor intenso uns para com os outros, porque o amor cobre uma multid√£o de pecados.", ref: "1 Pedro 4:8" },
                { text: "Eu e a minha casa serviremos ao Senhor.", ref: "Josu√© 24:15" },
                { text: "E estas palavras, que hoje te ordeno, estar√£o no teu cora√ß√£o; e as ensinar√°s a teus filhos e delas falar√°s assentado em tua casa, e andando pelo caminho...", ref: "Deuteron√¥mio 6:6-7" },
                { text: "Honra a teu pai e a tua m√£e, para que se prolonguem os teus dias na terra que o Senhor teu Deus te d√°.", ref: "√äxodo 20:12" },
                { text: "A mulher s√°bia edifica a sua casa, mas a tola a derruba com as pr√≥prias m√£os.", ref: "Prov√©rbios 14:1" },
                { text: "Heran√ßa do Senhor s√£o os filhos; o fruto do ventre o seu galard√£o.", ref: "Salmos 127:3" },
                { text: "Oh! qu√£o bom e qu√£o suave √© que os irm√£os vivam em uni√£o.", ref: "Salmos 133:1" },
                { text: "Maridos, amem suas mulheres, assim como Cristo amou a igreja e entregou-se a si mesmo por ela.", ref: "Ef√©sios 5:25" },
                { text: "Filhos, obedecei em tudo a vossos pais, porque isto √© agrad√°vel ao Senhor.", ref: "Colossenses 3:20" },
                { text: "Se algu√©m n√£o cuida dos seus, e especialmente dos da sua pr√≥pria casa, negou a f√© e √© pior do que o descrente.", ref: "1 Tim√≥teo 5:8" },
                { text: "Coroa dos velhos s√£o os filhos dos filhos; e a gl√≥ria dos filhos s√£o seus pais.", ref: "Prov√©rbios 17:6" },
                { text: "O amor √© paciente, o amor √© bondoso. N√£o inveja, n√£o se vangloria, n√£o se orgulha.", ref: "1 Cor√≠ntios 13:4" },
                { text: "Suportem-se uns aos outros e perdoem as queixas que tiverem uns contra os outros. Perdoem como o Senhor lhes perdoou.", ref: "Colossenses 3:13" },
                { text: "A tua mulher ser√° como a videira frut√≠fera aos lados da tua casa; os teus filhos como plantas de oliveira √† roda da tua mesa.", ref: "Salmos 128:3" }
            ]
        };
        
        const offlineBible = {
            "G√™nesis": { 1: [{ number: 1, text: "No princ√≠pio criou Deus o c√©u e a terra." }] },
            "Salmos": { 23: [{ number: 1, text: "O SENHOR √© o meu pastor, nada me faltar√°." }] }
        };
        const bibleData = {
            "G√™nesis": { chapters: 50 }, "√äxodo": { chapters: 40 }, "Lev√≠tico": { chapters: 27 }, "N√∫meros": { chapters: 36 }, "Deuteron√¥mio": { chapters: 34 },
            "Josu√©": { chapters: 24 }, "Ju√≠zes": { chapters: 21 }, "Rute": { chapters: 4 }, "1 Samuel": { chapters: 31 }, "2 Samuel": { chapters: 24 },
            "1 Reis": { chapters: 22 }, "2 Reis": { chapters: 25 }, "1 Cr√¥nicas": { chapters: 29 }, "2 Cr√¥nicas": { chapters: 36 }, "Esdras": { chapters: 10 },
            "Neemias": { chapters: 13 }, "Ester": { chapters: 10 }, "J√≥": { chapters: 42 }, "Salmos": { chapters: 150 }, "Prov√©rbios": { chapters: 31 },
            "Eclesiastes": { chapters: 12 }, "C√¢nticos": { chapters: 8 }, "Isa√≠as": { chapters: 66 }, "Jeremias": { chapters: 52 }, "Lamenta√ß√µes": { chapters: 5 },
            "Ezequiel": { chapters: 48 }, "Daniel": { chapters: 12 }, "Oseias": { chapters: 14 }, "Joel": { chapters: 3 }, "Am√≥s": { chapters: 9 },
            "Obadias": { chapters: 1 }, "Jonas": { chapters: 4 }, "Miqueias": { chapters: 7 }, "Naum": { chapters: 3 }, "Habacuque": { chapters: 3 },
            "Sofonias": { chapters: 3 }, "Ageu": { chapters: 2 }, "Zacarias": { chapters: 14 }, "Malaquias": { chapters: 4 },
            "Mateus": { chapters: 28 }, "Marcos": { chapters: 16 }, "Lucas": { chapters: 24 }, "Jo√£o": { chapters: 21 }, "Atos": { chapters: 28 },
            "Romanos": { chapters: 16 }, "1 Cor√≠ntios": { chapters: 16 }, "2 Cor√≠ntios": { chapters: 13 }, "G√°latas": { chapters: 6 }, "Ef√©sios": { chapters: 6 },
            "Filipenses": { chapters: 4 }, "Colossenses": { chapters: 4 }, "1 Tessalonicenses": { chapters: 5 }, "2 Tessalonicenses": { chapters: 3 },
            "1 Tim√≥teo": { chapters: 6 }, "2 Tim√≥teo": { chapters: 4 }, "Tito": { chapters: 3 }, "Filemom": { chapters: 1 }, "Hebreus": { chapters: 13 },
            "Tiago": { chapters: 5 }, "1 Pedro": { chapters: 5 }, "2 Pedro": { chapters: 3 }, "1 Jo√£o": { chapters: 5 }, "2 Jo√£o": { chapters: 1 },
            "3 Jo√£o": { chapters: 1 }, "Judas": { chapters: 1 }, "Apocalipse": { chapters: 22 }
        };
        const bibleBooks = Object.keys(bibleData);
        const nameDatabase = {
            "ana": "Cheia de gra√ßa e compaix√£o.", "maria": "Senhora soberana.", "jo√£o": "Deus √© cheio de gra√ßa.", "lucas": "O iluminado.", "pedro": "Rocha.",
            "paulo": "Pequeno.", "mateus": "D√°diva de Deus.", "marcos": "Guerreiro."
        };
        const cardBackgrounds = [
            { id: 1, type: 'image', url: 'https://images.unsplash.com/photo-1493246507139-91e8fad9978e?auto=format&fit=crop&w=800&q=80', thumb: 'Montanha' },
            { id: 2, type: 'image', url: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=800&q=80', thumb: 'Praia' },
            { id: 3, type: 'image', url: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=800&q=80', thumb: 'C√©u' },
            { id: 5, type: 'gradient', gradient: 'linear-gradient(to right, #B8860B 0%, #FFD700 100%)', thumb: 'Ouro' },
            { id: 6, type: 'gradient', gradient: 'linear-gradient(135deg, #8B0000 0%, #DC143C 100%)', thumb: 'Sangue' },
            { id: 7, type: 'gradient', gradient: 'linear-gradient(120deg, #C0C0C0 0%, #E8E8E8 100%)', thumb: 'Prata' }
        ];

        // --- COMPONENTES AUXILIARES ---
        const ThemeCard = ({ title, iconName, category, color, onSelectVerse }) => {
            const [verse, setVerse] = useState(null);
            const generateVerse = () => {
                const list = verseDatabase[category];
                const random = list[Math.floor(Math.random() * list.length)];
                setVerse(random);
            };
            return (
                <div className={`bg-white rounded-xl shadow-lg overflow-hidden border-t-4 ${color} transition-all hover:shadow-xl`}>
                    <div className="p-6">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-xl font-bold text-gray-800 flex items-center gap-2"><IconWrapper name={iconName} className="text-gray-600" />{title}</h3>
                            <button onClick={generateVerse} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">Nova Palavra</button>
                        </div>
                        <div className="min-h-[120px] flex items-center justify-center bg-gray-50 rounded-lg p-4 relative">
                            {verse ? (
                                <div className="text-center animate-fadeIn">
                                    <p className="text-lg text-gray-700 italic mb-3">"{verse.text}"</p>
                                    <p className="text-sm font-bold text-gray-500 uppercase tracking-wider">{verse.ref}</p>
                                    {/* MUDAN√áA: Atualizado para enviar Vers√≠culo e Refer√™ncia separadamente */}
                                    <button onClick={() => onSelectVerse(verse.text, verse.ref)} className="mt-2 text-red-800 hover:text-red-900 text-sm font-bold flex items-center justify-center gap-1 mx-auto"><IconWrapper name="image" size={14} /> Criar Cart√£o</button>
                                </div>
                            ) : (
                                <p className="text-gray-400 text-sm text-center">Clique no bot√£o para receber uma palavra.</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        function EvangelicalSystem() {
            const [activeTab, setActiveTab] = useState('home');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [dailyVerse, setDailyVerse] = useState(null);
            
            // Estados Persistentes - DI√ÅRIO
            const [currentDate, setCurrentDate] = useState(new Date());
            const [diaryEntries, setDiaryEntries] = usePersistentState('userDiaryEntries', {});

            // Estados Persistentes - FINANCEIRO
            const [financialEntries, setFinancialEntries] = usePersistentState('financialEntries', []);
            const [finForm, setFinForm] = useState({ 
                date: new Date().toISOString().split('T')[0], 
                desc: '', 
                value: '', 
                type: 'expense', // 'income' or 'expense'
                category: 'Outros', 
                method: 'Dinheiro', 
                installments: 1, // Novo campo para parcelas
                status: 'paid' 
            });

            // Estados Persistentes - B√çBLIA (HIGHLIGHTS)
            const [highlights, setHighlights] = usePersistentState('bibleHighlights', {});
            const [activeHighlightColor, setActiveHighlightColor] = useState('#fef08a'); // Cor padr√£o (Amarelo)

            // ESTADOS JOGOS
            const [gameMode, setGameMode] = useState('menu'); // 'menu', 'quiz', 'memory', 'hangman'

            // --- QUIZ STATES ---
            const [currentQuizQuestions, setCurrentQuizQuestions] = useState([]);
            const [quizIndex, setQuizIndex] = useState(0);
            const [quizScore, setQuizScore] = useState(0);
            const [showQuizScore, setShowQuizScore] = useState(false);
            const [quizActive, setQuizActive] = useState(false);
            const [quizTimer, setQuizTimer] = useState(600);
            const [quizGameOver, setQuizGameOver] = useState(false);
            const [questionsAnsweredCount, setQuestionsAnsweredCount] = useState(0);

            // --- MEMORY GAME STATES ---
            const [memoryCards, setMemoryCards] = useState([]);
            const [memoryFlipped, setMemoryFlipped] = useState([]);
            const [memoryMatched, setMemoryMatched] = useState([]);
            const [memoryMoves, setMemoryMoves] = useState(0);
            const [memoryLock, setMemoryLock] = useState(false);
            const [memoryWin, setMemoryWin] = useState(false);

            // --- HANGMAN (FORCA) STATES - NOVO ---
            const [hangmanWord, setHangmanWord] = useState('');
            const [hangmanCategory, setHangmanCategory] = useState('');
            const [hangmanGuessed, setHangmanGuessed] = useState([]);
            const [hangmanWrong, setHangmanWrong] = useState([]);
            const [hangmanTimer, setHangmanTimer] = useState(120);
            const [hangmanActive, setHangmanActive] = useState(false);
            const [hangmanStatus, setHangmanStatus] = useState('playing'); // playing, won, lost

            // --- RADIO STATES ---
            const [isPlayingRadio, setIsPlayingRadio] = useState(false);
            const audioRef = useRef(null);

            // Outros Estados
            const [chapterContent, setChapterContent] = useState(null);
            const [loadingBible, setLoadingBible] = useState(false);
            const [bibleError, setBibleError] = useState(false);
            const [fontSize, setFontSize] = useState(18);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const isSpeakingRef = useRef(false); // Ref para evitar problema de closure
            const [voices, setVoices] = useState([]);
            const [selectedVoiceIndex, setSelectedVoiceIndex] = useState(0);
            const [selectedBg, setSelectedBg] = useState(cardBackgrounds[0]);
            const [nameResult, setNameResult] = useState(null);
            const [sermon, setSermon] = useState(null);
            const [showToast, setShowToast] = useState(false);
            const [imageSearchQuery, setImageSearchQuery] = useState("");
            const [searchingImage, setSearchingImage] = useState(false);
            const [bgList, setBgList] = useState(cardBackgrounds);
            const [customImageUrl, setCustomImageUrl] = useState(""); 
            const [showBibleNav, setShowBibleNav] = useState(false);
            
            // Ajustado para o centro do novo canvas 600x800 (Portrait)
            const [textPos, setTextPos] = usePersistentState('cardTextPos', { x: 300, y: 400 });
            
            const [textColor, setTextColor] = useState("#ffffff");
            const [isDragging, setIsDragging] = useState(false);
            
            // Estados Persistentes - Cart√µes (ATUALIZADO)
            const [cardVerse, setCardVerse] = usePersistentState('userCardVerse', '');
            const [cardRef, setCardRef] = usePersistentState('userCardRef', '');
            
            // Estados Persistentes - Configura√ß√µes
            const [inputName, setInputName] = usePersistentState('userInputName', '');
            const [qrUrl, setQrUrl] = usePersistentState('qrUrl', '');
            const [qrWifiSsid, setQrWifiSsid] = usePersistentState('qrWifiSsid', '');
            const [qrWifiPass, setQrWifiPass] = usePersistentState('qrWifiPass', '');
            const [qrPixKey, setQrPixKey] = usePersistentState('qrPixKey', '');
            const [qrPixName, setQrPixName] = usePersistentState('qrPixName', '');
            const [qrPixCity, setQrPixCity] = usePersistentState('qrPixCity', '');
            const [qrPixAmount, setQrPixAmount] = usePersistentState('qrPixAmount', '');
            const [selectedBook, setSelectedBook] = usePersistentState('lastBibleBook', 'G√™nesis');
            const [selectedChapter, setSelectedChapter] = usePersistentState('lastBibleChapter', 1);

            const canvasRef = useRef(null);
            const qrCodeRef = useRef(null);
            const qrInstance = useRef(null);
            const speechRef = useRef(null); // Ref for speech synthesis to prevent GC

            // Helpers for Diary
            const getCurrentDateKey = () => formatDateKey(currentDate);
            const getCurrentEntry = () => diaryEntries[getCurrentDateKey()] || "";
            const handleDiaryChange = (e) => { const val = e.target.value; setDiaryEntries(prev => ({ ...prev, [getCurrentDateKey()]: val })); };
            const changeDay = (days) => { const newDate = new Date(currentDate); newDate.setDate(newDate.getDate() + days); setCurrentDate(newDate); };
            const goToToday = () => setCurrentDate(new Date());

            // --- L√ìGICA FINANCEIRO ---
            const handleAddFinancialEntry = () => {
                if (!finForm.desc || !finForm.value) return alert("Preencha descri√ß√£o e valor.");
                
                const totalValue = parseFloat(finForm.value);
                const numInstallments = parseInt(finForm.installments) || 1;
                const installmentValue = totalValue / numInstallments;
                const newEntries = [];

                // Criar lan√ßamentos (parcelas)
                for (let i = 0; i < numInstallments; i++) {
                    // Calcular data do vencimento (m√™s a m√™s)
                    const entryDate = new Date(finForm.date);
                    entryDate.setMonth(entryDate.getMonth() + i);
                    
                    // Ajustar para n√£o pular dias em meses mais curtos (opcional simples)
                    // entryDate.setDate(new Date(finForm.date).getDate()); 

                    newEntries.push({
                        id: Date.now() + i, // ID √∫nico sequencial
                        date: entryDate.toISOString().split('T')[0],
                        desc: numInstallments > 1 ? `${finForm.desc} (${i + 1}/${numInstallments})` : finForm.desc,
                        value: installmentValue,
                        type: finForm.type,
                        category: finForm.category,
                        method: finForm.method,
                        status: i === 0 ? 'paid' : 'pending' // A primeira paga, as outras a vencer (opcional)
                    });
                }

                setFinancialEntries([...newEntries, ...financialEntries]);
                setFinForm({ ...finForm, desc: '', value: '', installments: 1 }); // Reset fields
                setShowToast(true); setTimeout(() => setShowToast(false), 2000);
            };

            const removeFinancialEntry = (id) => {
                setFinancialEntries(financialEntries.filter(e => e.id !== id));
            };

            const financialSummary = useMemo(() => {
                const income = financialEntries.filter(e => e.type === 'income').reduce((acc, curr) => acc + curr.value, 0);
                const expense = financialEntries.filter(e => e.type === 'expense').reduce((acc, curr) => acc + curr.value, 0);
                return { income, expense, balance: income - expense };
            }, [financialEntries]);

            // --- L√ìGICA DE BACKUP FINANCEIRO (ARQUIVO JSON) ---
            const exportFinancialData = () => {
                if (financialEntries.length === 0) return alert("N√£o h√° dados para exportar.");
                
                const dataStr = JSON.stringify(financialEntries, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup_financeiro_sistema_vida_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const importFinancialData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (Array.isArray(importedData)) {
                            // Valida√ß√£o b√°sica para garantir que o formato est√° correto
                            const isValid = importedData.every(item => item.date && item.desc && item.value !== undefined);
                            
                            if (isValid) {
                                if (confirm(`Encontrados ${importedData.length} registos. Deseja substituir os dados atuais ou adicionar aos existentes?\n\nOK = Substituir tudo\nCancelar = Adicionar aos existentes`)) {
                                    setFinancialEntries(importedData);
                                } else {
                                    // Adicionar, evitando duplicatas exatas de ID se houver
                                    const currentIds = new Set(financialEntries.map(f => f.id));
                                    const newEntries = importedData.filter(d => !currentIds.has(d.id));
                                    setFinancialEntries([...financialEntries, ...newEntries]);
                                }
                                alert("Backup restaurado com sucesso!");
                            } else {
                                alert("O arquivo parece n√£o conter dados financeiros v√°lidos deste sistema.");
                            }
                        } else {
                            alert("Formato de arquivo inv√°lido.");
                        }
                    } catch (error) {
                        console.error("Erro ao importar:", error);
                        alert("Erro ao ler o arquivo. Verifique se √© um backup v√°lido (.json).");
                    }
                };
                reader.readAsText(file);
                // Limpar o input para permitir selecionar o mesmo arquivo novamente se necess√°rio
                event.target.value = '';
            };

            // --- L√ìGICA RADIO ---
            const toggleRadio = () => {
                if (!audioRef.current) return;
                
                if (isPlayingRadio) {
                    audioRef.current.pause();
                } else {
                    const playPromise = audioRef.current.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.error("Erro ao tocar:", error);
                            alert("N√£o foi poss√≠vel reproduzir automaticamente. Verifique se o navegador permite √°udio.");
                        });
                    }
                }
                setIsPlayingRadio(!isPlayingRadio);
            };

            // --- L√ìGICA DO JOGO DA MEM√ìRIA ---
            const memoryEmojis = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº'];
            const startMemoryGame = () => {
                Tone.start();
                const shuffled = [...memoryEmojis, ...memoryEmojis].sort(() => Math.random() - 0.5).map((emoji, index) => ({ id: index, emoji, isFlipped: false, isMatched: false }));
                setMemoryCards(shuffled); setMemoryFlipped([]); setMemoryMatched([]); setMemoryMoves(0); setMemoryLock(false); setMemoryWin(false); setGameMode('memory');
            };
            const handleMemoryCardClick = (card) => {
                if (memoryLock || card.isFlipped || card.isMatched) return;
                const note = ['C4','D4','E4','F4','G4','A4','B4','C5'][memoryEmojis.indexOf(card.emoji)];
                try { const synth = new Tone.Synth().toDestination(); synth.triggerAttackRelease(note, "8n"); } catch(e){}
                const newCards = memoryCards.map(c => c.id === card.id ? { ...c, isFlipped: true } : c);
                setMemoryCards(newCards);
                const newFlipped = [...memoryFlipped, card];
                setMemoryFlipped(newFlipped);
                if (newFlipped.length === 2) {
                    setMemoryLock(true); setMemoryMoves(m => m + 1);
                    if (newFlipped[0].emoji === newFlipped[1].emoji) {
                        setMemoryCards(prev => prev.map(c => (c.id === newFlipped[0].id || c.id === newFlipped[1].id) ? { ...c, isMatched: true } : c));
                        setMemoryMatched(prev => [...prev, newFlipped[0].id, newFlipped[1].id]);
                        setMemoryFlipped([]); setMemoryLock(false);
                        try { const p = new Tone.PolySynth().toDestination(); p.triggerAttackRelease(['C4','E4','G4'], '8n'); } catch(e){}
                        if (newCards.filter(c => !c.isMatched).length === 2) { setTimeout(() => setMemoryWin(true), 500); }
                    } else {
                        try { const f = new Tone.MembraneSynth().toDestination(); f.triggerAttackRelease('C2', '8n'); } catch(e){}
                        setTimeout(() => { setMemoryCards(prev => prev.map(c => (c.id === newFlipped[0].id || c.id === newFlipped[1].id) ? { ...c, isFlipped: false } : c)); setMemoryFlipped([]); setMemoryLock(false); }, 1000);
                    }
                }
            };

            // --- L√ìGICA DO JOGO DA FORCA (NOVO) ---
            const startHangmanGame = () => {
                Tone.start();
                const categories = Object.keys(HANGMAN_CATEGORIES);
                const randomCat = categories[Math.floor(Math.random() * categories.length)];
                const wordList = HANGMAN_CATEGORIES[randomCat];
                const randomWord = wordList[Math.floor(Math.random() * wordList.length)];
                
                setHangmanCategory(randomCat);
                setHangmanWord(randomWord);
                setHangmanGuessed([]);
                setHangmanWrong([]);
                setHangmanTimer(120);
                setHangmanStatus('playing');
                setHangmanActive(true);
                setGameMode('hangman');
            };

            const handleHangmanGuess = (letter) => {
                if (hangmanStatus !== 'playing') return;
                
                // Reinicia o timer ao jogar (como pedido no c√≥digo original)
                setHangmanTimer(120);

                if (hangmanWord.includes(letter)) {
                    playSoundEffect('hangman_correct');
                    setHangmanGuessed(prev => [...prev, letter]);
                    
                    // Check Victory
                    const uniqueChars = [...new Set(hangmanWord.split(''))];
                    const allGuessed = uniqueChars.every(char => [...hangmanGuessed, letter].includes(char));
                    if (allGuessed) {
                        setHangmanStatus('won');
                        setHangmanActive(false);
                        playSoundEffect('hangman_win');
                    }
                } else {
                    playSoundEffect('hangman_wrong');
                    setHangmanWrong(prev => [...prev, letter]);
                    
                    // Check Defeat
                    if (hangmanWrong.length + 1 >= 6) {
                        setHangmanStatus('lost');
                        setHangmanActive(false);
                        playSoundEffect('hangman_lose');
                    }
                }
            };

            useEffect(() => {
                let interval;
                if (hangmanActive && hangmanTimer > 0) {
                    interval = setInterval(() => {
                        setHangmanTimer(prev => {
                            if (prev <= 1) {
                                setHangmanActive(false);
                                setHangmanStatus('lost');
                                playSoundEffect('hangman_lose');
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [hangmanActive, hangmanTimer]);

            // --- L√ìGICA DO QUIZ ---
            useEffect(() => {
                let interval;
                if (quizActive && quizTimer > 0) { interval = setInterval(() => setQuizTimer(p => p - 1), 1000); } 
                else if (quizTimer === 0 && quizActive) { setQuizActive(false); setQuizGameOver(true); playSoundEffect('quiz_wrong'); }
                return () => clearInterval(interval);
            }, [quizActive, quizTimer]);

            const startQuiz = () => {
                Tone.start();
                const shuffled = [...bibleQuizDatabase].sort(() => 0.5 - Math.random());
                setCurrentQuizQuestions(shuffled.slice(0, 10));
                setQuizIndex(0); setQuizScore(0); setQuestionsAnsweredCount(0); setQuizTimer(600); setQuizActive(true); setShowQuizScore(false); setQuizGameOver(false); setGameMode('quiz');
            };

            const handleQuizAnswer = (optionIndex) => {
                const isCorrect = optionIndex === currentQuizQuestions[quizIndex].answer;
                if (isCorrect) { setQuizScore(s => s + 10); playSoundEffect('quiz_correct'); } else { playSoundEffect('quiz_wrong'); }
                const nextCount = questionsAnsweredCount + 1;
                setQuestionsAnsweredCount(nextCount);
                if (nextCount >= 10) { setQuizActive(false); setShowQuizScore(true); playSoundEffect(quizScore >= 70 ? 'quiz_win' : 'quiz_wrong'); } 
                else { setQuizIndex(i => i + 1); }
            };

            const formatTime = (seconds) => { const mins = Math.floor(seconds / 60); const secs = seconds % 60; return `${mins}:${secs < 10 ? '0' : ''}${secs}`; };

            // Init Effects
            useEffect(() => {
                const randomVerse = verseDatabase.motivacao[0];
                setDailyVerse(randomVerse);
                // ATUALIZA√á√ÉO: Inicializa os novos estados de Vers√≠culo e Refer√™ncia
                if (!cardVerse) setCardVerse(randomVerse.text);
                if (!cardRef) setCardRef(randomVerse.ref);
                
                fetchChapter(selectedBook, selectedChapter);
                
                // MELHORIA DE VOZ: Tenta selecionar uma voz MASCULINA ou melhor automaticamente
                const loadVoices = () => { 
                    if ('speechSynthesis' in window) { 
                        const available = window.speechSynthesis.getVoices(); 
                        setVoices(available); 
                        
                        // Filtra vozes em Portugu√™s
                        const ptVoices = available.filter(v => v.lang.includes('pt'));
                        
                        // Lista de prefer√™ncia para tentar achar vozes masculinas ou de alta qualidade
                        const preferredNames = ["Daniel", "Felipe", "Ricardo", "Joaquim", "Microsoft", "Google"];
                        
                        let bestVoice = ptVoices[0]; // Fallback para a primeira voz PT encontrada
                        
                        // Tenta encontrar uma voz que corresponda √† lista de prefer√™ncia
                        for (const name of preferredNames) {
                            const found = ptVoices.find(v => v.name.includes(name));
                            if (found) {
                                bestVoice = found;
                                break; // Para na primeira encontrada (prioridade para masculinas)
                            }
                        }
                        
                        if (bestVoice) {
                            const index = available.indexOf(bestVoice);
                            setSelectedVoiceIndex(index !== -1 ? index : 0); 
                        }
                    } 
                };
                if ('speechSynthesis' in window) { loadVoices(); window.speechSynthesis.onvoiceschanged = loadVoices; }
                if (inputName) analyzeNames();
            }, []);

            // ATUALIZA√á√ÉO: Depend√™ncias para o desenho do cart√£o
            useEffect(() => { if (activeTab === 'share') drawCard(); }, [activeTab, cardVerse, cardRef, selectedBg, textPos, textColor]);

            const BackButton = () => (
                <button onClick={() => setActiveTab('home')} className="mb-4 flex items-center gap-2 text-red-800 hover:text-red-900 font-bold transition-colors">
                    <div className="p-1 bg-red-100 rounded-full"><IconWrapper name="arrow-left" size={20} /></div>
                    Voltar ao In√≠cio
                </button>
            );

            const normalizeBookName = (name) => name.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            const fetchChapter = async (book, chapter) => {
                setLoadingBible(true); setBibleError(false);
                try {
                    const safeBook = encodeURIComponent(normalizeBookName(book));
                    const response = await fetch(`https://bible-api.com/${safeBook}+${chapter}?translation=almeida`);
                    if (!response.ok) throw new Error("Erro");
                    const data = await response.json();
                    if (!data.verses) throw new Error("Dados inv√°lidos");
                    setChapterContent({ book: { name: book }, chapter: { number: chapter }, verses: data.verses.map(v => ({ number: v.verse, text: v.text.trim() })) });
                } catch (error) {
                    if (offlineBible[book] && offlineBible[book][chapter]) { setChapterContent({ book: { name: book }, chapter: { number: chapter }, verses: offlineBible[book][chapter] }); } 
                    else { setBibleError(true); setChapterContent({ book: { name: book }, chapter: { number: chapter }, verses: [{ number: 1, text: "Modo Offline. Verifique a internet." }] }); }
                } finally { setLoadingBible(false); }
            };

            const toggleNarrator = () => {
                if (!('speechSynthesis' in window)) return;
                
                if (isSpeaking) { 
                    window.speechSynthesis.cancel(); 
                    setIsSpeaking(false);
                    isSpeakingRef.current = false;
                } else {
                    if (!chapterContent || !chapterContent.verses) return;
                    setIsSpeaking(true);
                    isSpeakingRef.current = true;
                    
                    // L√≥gica para ler vers√≠culo por vers√≠culo para evitar timeout do navegador
                    let currentVerseIndex = 0;
                    
                    const speakNextVerse = () => {
                        if (!isSpeakingRef.current) return; // Checa o ref atualizado imediatamente
                        if (currentVerseIndex >= chapterContent.verses.length) {
                            setIsSpeaking(false);
                            isSpeakingRef.current = false;
                            return;
                        }

                        const verse = chapterContent.verses[currentVerseIndex];
                        // L√™ o n√∫mero do vers√≠culo e o texto, ou s√≥ o texto
                        const textToRead = `${verse.text}`;
                        const utterance = new SpeechSynthesisUtterance(textToRead);
                        
                        if (voices[selectedVoiceIndex]) {
                            utterance.voice = voices[selectedVoiceIndex];
                        }
                        
                        utterance.onend = () => {
                            currentVerseIndex++;
                            speakNextVerse();
                        };
                        
                        utterance.onerror = (e) => {
                            console.error("Erro na fala", e);
                            setIsSpeaking(false);
                            isSpeakingRef.current = false;
                        };

                        // Salva refer√™ncia global para prevenir Garbage Collection
                        speechRef.current = utterance;
                        window.speechSynthesis.speak(utterance);
                    };

                    // Inicia a leitura
                    window.speechSynthesis.cancel(); // Limpa fila anterior
                    speakNextVerse();
                }
            };

            // --- L√ìGICA DE MARCA-TEXTO (HIGHLIGHT) ---
            const highlightColors = [
                { color: '#fef08a', name: 'Amarelo', class: 'bg-yellow-200' },
                { color: '#bbf7d0', name: 'Verde', class: 'bg-green-200' },
                { color: '#bfdbfe', name: 'Azul', class: 'bg-blue-200' },
                { color: '#fbcfe8', name: 'Rosa', class: 'bg-pink-200' },
                { color: '#e9d5ff', name: 'Roxo', class: 'bg-purple-200' },
            ];

            const handleVerseMouseUp = (verseNum) => {
                const selection = window.getSelection();
                // Verifica se houve sele√ß√£o de texto OU se √© um clique direto no vers√≠culo (para facilitar mobile)
                // Permitimos marcar clicando no paragrafo todo se a inten√ß√£o for estudo
                
                if (!chapterContent) return;
                const bookName = chapterContent.book.name;
                const chapterNum = chapterContent.chapter.number;
                
                // CHAVE √öNICA BASEADA NO LIVRO E CAP√çTULO ATUAL
                const key = `${bookName}-${chapterNum}-${verseNum}`;
                
                setHighlights(prev => {
                    const newHighlights = { ...prev };
                    // Se j√° estiver marcado com a MESMA cor, remove (toggle off)
                    if (newHighlights[key] === activeHighlightColor) {
                        delete newHighlights[key];
                    } else {
                        // Se n√£o estiver marcado ou for outra cor, aplica a cor atual
                        newHighlights[key] = activeHighlightColor;
                    }
                    return newHighlights;
                });
                
                // Remove a sele√ß√£o azul nativa do navegador para mostrar o destaque
                if (selection) selection.removeAllRanges();
            };

            const getVerseHighlightStyle = (verseNum) => {
                if (!chapterContent) return {};
                const bookName = chapterContent.book.name;
                const chapterNum = chapterContent.chapter.number;
                
                const key = `${bookName}-${chapterNum}-${verseNum}`;
                const color = highlights[key];
                if (!color) return {};
                return { backgroundColor: color, paddingLeft: '8px', borderLeft: '4px solid rgba(0,0,0,0.1)' };
            };

            const analyzeNames = () => {
                if (!inputName.trim()) return;
                const names = inputName.trim().split(/\s+/);
                const foundResults = [];
                names.forEach(n => {
                    const cleanName = n.toLowerCase().replace(/[0-9]/g, '');
                    const foundKey = Object.keys(nameDatabase).find(key => key === cleanName || key.normalize("NFD").replace(/[\u0300-\u036f]/g, "") === cleanName.normalize("NFD").replace(/[\u0300-\u036f]/g, ""));
                    if (foundKey) { foundResults.push({ name: n.charAt(0).toUpperCase() + n.slice(1), meaning: nameDatabase[foundKey], found: true }); }
                });
                if (foundResults.length > 0) { setNameResult(foundResults); } 
                else { setNameResult([{ name: inputName, meaning: `Filho(a) amado(a) de Deus! O Senhor tem um prop√≥sito especial para ${inputName}, que √© ser luz onde estiver.`, found: false }]); }
            };

            const saveNote = () => { setShowToast(true); setTimeout(() => setShowToast(false), 3000); };

            // NOVO: Fun√ß√£o para abrir o Google Search
            const handleSearchImage = () => {
                if (!imageSearchQuery.trim()) { 
                    alert("Por favor, digite algo para pesquisar."); 
                    return; 
                }
                const searchQuery = encodeURIComponent(imageSearchQuery.trim());
                window.open(`https://www.google.com/search?q=${searchQuery}&tbm=isch`, '_blank');
            };

            const handleCustomImage = () => { if(!customImageUrl) { alert("Cole o link da imagem primeiro."); return; } const newBg = { id: Date.now(), type: 'image', url: customImageUrl, thumb: 'Link' }; setBgList([newBg, ...bgList]); setSelectedBg(newBg); };
            const handleFileUpload = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (evt) => { const newBg = { id: 'upload', type: 'image', url: evt.target.result, thumb: 'Upload' }; setBgList([newBg, ...bgList]); setSelectedBg(newBg); }; reader.readAsDataURL(file); } };

            const handleMouseDown = () => setIsDragging(true);
            const handleMouseUp = () => setIsDragging(false);
            // Os manipuladores de movimento s√£o mantidos, pois eles se baseiam no `canvas.width` e `canvas.height` atualizados em `drawCard`.
            const handleMouseMove = (e) => { 
                if (!isDragging || !canvasRef.current) return; 
                const canvas = canvasRef.current; 
                const rect = canvas.getBoundingClientRect(); 
                const scaleX = canvas.width / rect.width; 
                const scaleY = canvas.height / rect.height; 
                const x = (e.clientX - rect.left) * scaleX; 
                const y = (e.clientY - rect.top) * scaleY; 
                setTextPos({ x, y }); 
            };
            const handleTouchMove = (e) => { 
                if (!isDragging || !canvasRef.current) return; 
                e.preventDefault(); 
                const canvas = canvasRef.current; 
                const rect = canvas.getBoundingClientRect(); 
                const scaleX = canvas.width / rect.width; 
                const scaleY = canvas.height / rect.height; 
                const touch = e.touches[0]; 
                const x = (touch.clientX - rect.left) * scaleX; 
                const y = (touch.clientY - rect.top) * scaleY; 
                setTextPos({ x, y }); 
            };

            // L√ìGICA DE DESENHO DO CART√ÉO (ATUALIZADA PARA 600x800 PORTRAIT)
            const drawCard = () => {
                const canvas = canvasRef.current; if (!canvas) return;
                const ctx = canvas.getContext('2d'); 
                
                // Dimens√µes Verticais (Portrait) para celular/redes sociais
                const targetW = 600;
                const targetH = 800;

                canvas.width = targetW; 
                canvas.height = targetH;

                // Remapeia a posi√ß√£o do texto (armazenada em 800x600 ou default) para 600x800
                const scaledX = textPos.x * (targetW / 800); 
                const scaledY = textPos.y * (targetH / 600); 

                const renderText = () => { 
                    // Fundo escuro (overlay)
                    ctx.fillStyle = "rgba(0,0,0,0.4)"; 
                    ctx.fillRect(0,0,targetW,targetH); 
                    
                    ctx.fillStyle = textColor; 
                    ctx.textAlign = "center"; 

                    // --- 1. Renderizar Vers√≠culo (Fonte Grande) ---
                    const verseWords = cardVerse.split(' '); 
                    let line = ''; 
                    const verseLineHeight = 45; // Altura da linha para 36px de fonte
                    const verseLines = []; 
                    
                    ctx.font = `bold 36px 'Merriweather', serif`; // Fonte maior para melhor leitura

                    // Limite de largura para o texto (550px em 600px de largura)
                    for(let n = 0; n < verseWords.length; n++) { 
                        let testLine = line + verseWords[n] + ' '; 
                        let metrics = ctx.measureText(testLine); 
                        // Verifica se a linha ultrapassa a largura interna (550px)
                        if (metrics.width > 550 && n > 0) { 
                            verseLines.push(line); 
                            line = verseWords[n] + ' '; 
                        } else { 
                            line = testLine; 
                        } 
                    } 
                    verseLines.push(line); 
                    
                    // --- 2. Calcular Altura Total e Posi√ß√£o Inicial ---
                    const totalVerseHeight = verseLines.length * verseLineHeight;
                    const refLineHeight = 30; 
                    
                    let totalHeight = totalVerseHeight;

                    if (cardRef) {
                        totalHeight += refLineHeight + 20; // Espa√ßamento entre vers√≠culo e refer√™ncia
                    }

                    // Posi√ß√£o Y inicial: usa scaledY, menos metade da altura total do texto
                    let y = scaledY - (totalHeight / 2) + (verseLineHeight / 2); 
                    
                    // --- 3. Desenhar Vers√≠culo Linha por Linha ---
                    verseLines.forEach(l => { 
                        ctx.fillText(l, scaledX, y); 
                        y += verseLineHeight; 
                    }); 
                    
                    // --- 4. Desenhar Refer√™ncia (Fonte Menor) ---
                    if (cardRef) {
                        ctx.font = `bold 24px 'Inter', sans-serif`; // Fonte menor
                        ctx.fillText(`- ${cardRef}`, scaledX, y + 20); 
                    }
                };

                // L√≥gica de Carregamento de Imagem/Gradiente (ajustada para 600x800)
                if (selectedBg.type === 'image') { 
                    const img = new Image(); 
                    img.crossOrigin = "anonymous"; 
                    img.src = selectedBg.url; 
                    img.onload = () => { 
                        // L√≥gica de "cover" para preencher o canvas 600x800
                        const ratio = Math.max(targetW / img.width, targetH / img.height);
                        const newWidth = img.width * ratio;
                        const newHeight = img.height * ratio;
                        const xOffset = (targetW - newWidth) / 2;
                        const yOffset = (targetH - newHeight) / 2;

                        ctx.drawImage(img, xOffset, yOffset, newWidth, newHeight); 
                        renderText(); 
                    }; 
                    img.onerror = () => { 
                        ctx.fillStyle = "#333"; 
                        ctx.fillRect(0,0,targetW,targetH); 
                        renderText(); 
                    }; 
                } 
                else { 
                    const grd = ctx.createLinearGradient(0, 0, targetW, targetH); 
                    if (selectedBg.id === 5) { 
                        grd.addColorStop(0, "#B8860B"); grd.addColorStop(1, "#FFD700"); 
                    } else if (selectedBg.id === 6) { 
                        grd.addColorStop(0, "#8B0000"); grd.addColorStop(1, "#DC143C"); 
                    } else { 
                        grd.addColorStop(0, "#C0C0C0"); grd.addColorStop(1, "#E8E8E8"); 
                    } 
                    ctx.fillStyle = grd; 
                    ctx.fillRect(0,0,targetW,targetH); 
                    renderText(); 
                }
            };

            const downloadCard = () => { const canvas = canvasRef.current; if (!canvas) return; const link = document.createElement('a'); link.download = 'cartao.png'; link.href = canvas.toDataURL(); link.click(); };
            const shareCard = async () => { const canvas = canvasRef.current; if (!canvas) return; canvas.toBlob(async (blob) => { const file = new File([blob], "cartao_sistema_vida.png", { type: "image/png" }); if (navigator.share) { try { await navigator.share({ files: [file], title: 'Sistema Vida', text: `${cardVerse} - ${cardRef}` }); } catch (error) { console.log('Erro partilha:', error); } } else { alert("Partilha direta n√£o suportada. Baixe a imagem primeiro."); } }); };

            const gerarQRCodeVisual = (texto) => { if (!qrCodeRef.current) return;
                // LIMPAR O CONTAINER ANTES DE GERAR NOVO (FIX PARA BUGS DE QRCODE)
                qrCodeRef.current.innerHTML = '';
                new QRCode(qrCodeRef.current, { text: texto, width: 256, height: 256, colorDark: "#000000", colorLight: "#ffffff", correctLevel: QRCode.CorrectLevel.H });
            };
            
            const handleGerarUrl = () => { if(qrUrl) gerarQRCodeVisual(qrUrl); else alert("Digite uma URL."); };
            const handleGerarWifi = () => { if(qrWifiSsid) gerarQRCodeVisual(`WIFI:T:WPA;S:${qrWifiSsid};P:${qrWifiPass};;`); else alert("SSID √© obrigat√≥rio."); };
            const handleGerarPix = () => { if (!qrPixKey || !qrPixName || !qrPixCity) { alert("Chave, Nome e Cidade s√£o obrigat√≥rios."); return; } const merchantAccountInfo = [formatarEMV('00', 'br.gov.bcb.pix'), formatarEMV('01', qrPixKey)].join(''); let brCode = [formatarEMV('00', '01'), formatarEMV('26', merchantAccountInfo), formatarEMV('52', '0000'), formatarEMV('53', '986')]; if (qrPixAmount) { const valor = parseFloat(qrPixAmount.replace(",", ".")).toFixed(2); brCode.push(formatarEMV('54', valor)); } brCode.push(formatarEMV('58', 'BR')); brCode.push(formatarEMV('59', simplificarTexto(qrPixName).substring(0, 25))); brCode.push(formatarEMV('60', simplificarTexto(qrPixCity).substring(0, 15))); brCode.push(formatarEMV('62', formatarEMV('05', '***'))); brCode.push('6304'); const stringPIX = brCode.join(''); const brCodeCompleto = stringPIX + crc16(stringPIX); gerarQRCodeVisual(brCodeCompleto); };
            const downloadQRCode = () => { 
                if (!qrCodeRef.current) return;
                const img = qrCodeRef.current.querySelector('img'); 
                if (img) { const link = document.createElement('a'); link.href = img.src; link.download = 'qrcode.png'; link.click(); } 
            };

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    {showToast && (
                        <div className="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-2xl z-[100] animate-fadeIn flex items-center gap-2 no-print">
                            <IconWrapper name="check-circle" size={20} /><div><p className="font-bold">Salvo!</p><p className="text-sm">Dados guardados.</p></div>
                        </div>
                    )}
                    
                    {/* PLAYER DE R√ÅDIO PERSISTENTE - FORA DAS ABAS PARA N√ÉO PARAR */}
                    <div style={{display: 'none'}}>
                        <audio 
                            ref={audioRef} 
                            src="https://live.hunter.fm/gospel_stream?ag=mp3" 
                            crossOrigin="anonymous"
                            onPlay={() => setIsPlayingRadio(true)}
                            onPause={() => setIsPlayingRadio(false)}
                            onError={() => {
                                console.log("Erro no stream de √°udio");
                                setIsPlayingRadio(false);
                            }}
                        ></audio>
                    </div>

                    <header className="bg-red-800 text-white shadow-lg sticky top-0 z-50 no-print">
                        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setActiveTab('home')}>
                                <IconWrapper name="book-open" className="text-yellow-400" size={32} /><div><h1 className="text-2xl font-bold text-white">Sistema Vida</h1><p className="text-xs text-gray-200">Alimento Di√°rio</p></div>
                            </div>
                            <nav className="hidden xl:flex gap-4 text-sm font-medium overflow-x-auto">
                                {NAV_ITEMS.map(item => (
                                    <button key={item.id} onClick={() => setActiveTab(item.id)} className={`hover:text-yellow-300 whitespace-nowrap transition-colors duration-200 ${activeTab === item.id ? 'text-yellow-400 font-bold' : ''}`}>{item.label}</button>
                                ))}
                            </nav>
                            <button className="xl:hidden" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}><IconWrapper name="menu" /></button>
                        </div>
                        {mobileMenuOpen && (
                            <div className="xl:hidden bg-red-900 p-4 grid grid-cols-2 gap-2">
                                {NAV_ITEMS.map(item => (
                                    <button key={item.id} onClick={() => {setActiveTab(item.id); setMobileMenuOpen(false)}} className={`text-left p-2 rounded transition-colors ${activeTab === item.id ? 'bg-red-800 font-bold' : 'hover:bg-red-800'}`}>
                                        <div className="flex items-center gap-2"><IconWrapper name={item.icon} size={16} />{item.label}</div>
                                    </button>
                                ))}
                            </div>
                        )}
                    </header>
                    <main className="flex-grow container mx-auto px-4 py-8">
                        {/* --- CONTE√öDO ABAS --- */}
                        {activeTab === 'home' && (
                            <div className="space-y-8 animate-fadeIn">
                                <div className="bg-gradient-to-r from-red-800 to-red-600 rounded-2xl shadow-xl p-8 text-white text-center">
                                    <h2 className="text-2xl font-serif mb-4">"{dailyVerse?.text}"</h2>
                                    <button onClick={() => setActiveTab('bible')} className="bg-white text-red-800 px-6 py-2 rounded-full font-bold shadow hover:bg-gray-100 flex items-center justify-center gap-2 mx-auto"><IconWrapper name="book-open" size={18}/> Ler a B√≠blia</button>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {NAV_ITEMS.filter(i => i.id !== 'home').map(i => (
                                        <div key={i.id} onClick={()=>setActiveTab(i.id)} className="bg-white p-6 rounded-xl shadow text-center cursor-pointer hover:shadow-md transition-transform hover:scale-105">
                                            <div className={`w-12 h-12 mx-auto rounded-full flex items-center justify-center bg-red-100 text-red-800 mb-2`}><IconWrapper name={i.icon} /></div><h3 className="font-bold text-gray-700">{i.label}</h3>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {/* --- B√çBLIA --- */}
                        {activeTab === 'bible' && (
                            <div className="bg-white rounded-xl shadow-lg flex flex-col md:flex-row overflow-hidden animate-fadeIn h-[80vh] relative">
                                <div className="md:hidden p-4 bg-red-50 border-b flex justify-between items-center">
                                    <BackButton />
                                    <button onClick={() => setShowBibleNav(!showBibleNav)} className="px-4 py-2 bg-red-800 text-white rounded text-sm font-bold">
                                        {showBibleNav ? 'Ler Texto' : `${selectedBook} ${selectedChapter} ‚ñæ`}
                                    </button>
                                </div>
                                <div className={`w-full md:w-64 bg-gray-50 border-r p-4 overflow-y-auto transition-all duration-300 ease-in-out ${showBibleNav ? 'block' : 'hidden'} md:block`}>
                                    <div className="hidden md:block"><BackButton /></div>
                                    <select value={selectedBook} onChange={(e) => {
                                        const newBook = e.target.value;
                                        setSelectedBook(newBook);
                                        setSelectedChapter(1); 
                                        fetchChapter(newBook, 1);
                                    }} className="w-full p-2 mb-4 border rounded text-gray-800">{bibleBooks.map(b => <option key={b} value={b}>{b}</option>)}</select>
                                    <div className="grid grid-cols-5 gap-1">{[...Array(50)].map((_, i) => (<button key={i} onClick={() => {
                                        setSelectedChapter(i+1);
                                        fetchChapter(selectedBook, i+1); 
                                        setShowBibleNav(false);
                                    }} className={`p-1 text-xs rounded ${selectedChapter===i+1?'bg-yellow-500 text-white':'bg-gray-200 text-gray-700'}`}>{i+1}</button>))}</div>
                                    <div className="mt-4 pt-4 border-t"><label className="text-xs font-bold text-gray-500">VOZ</label><select className="w-full p-2 border rounded text-xs text-gray-800" onChange={(e)=>setSelectedVoiceIndex(e.target.value)}>{voices.map((v,k)=><option key={k} value={k}>{v.name.slice(0,20)}</option>)}</select></div>
                                </div>
                                <div className={`flex-1 p-8 overflow-y-auto relative bible-content-area ${showBibleNav ? 'hidden md:block' : 'block'}`}>
                                    {loadingBible ? <div className="text-center mt-20 text-gray-500">Carregando...</div> : chapterContent && (
                                        <>
                                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4 gap-4">
                                                <h2 className="text-3xl font-serif font-bold text-red-900">{chapterContent.book.name} {chapterContent.chapter.number}</h2>
                                                
                                                <div className="flex flex-col items-end gap-2">
                                                    {/* Seletor de Cor do Marca Texto */}
                                                    <div className="flex items-center gap-2 bg-gray-100 p-2 rounded-lg">
                                                        <span className="text-xs font-bold text-gray-500">Marcador:</span>
                                                        {highlightColors.map((c) => (
                                                            <button
                                                                key={c.color}
                                                                onClick={() => setActiveHighlightColor(c.color)}
                                                                className={`w-6 h-6 rounded-full border-2 transition-transform hover:scale-110 ${activeHighlightColor === c.color ? 'border-gray-600 scale-110 shadow-sm' : 'border-transparent'}`}
                                                                style={{ backgroundColor: c.color }}
                                                                title={c.name}
                                                            />
                                                        ))}
                                                    </div>
                                                    
                                                    <button onClick={toggleNarrator} className={`p-2 rounded-full flex items-center gap-2 text-sm font-bold transition-colors ${isSpeaking?'bg-red-100 text-red-600':'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>
                                                        <IconWrapper name={isSpeaking?'square':'volume-2'} size={16}/> {isSpeaking ? 'Parar Leitura' : 'Ouvir Cap√≠tulo'}
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div className="space-y-4 font-serif text-gray-800" style={{fontSize: fontSize}}>
                                                {chapterContent.verses?.map(v => (
                                                    <p 
                                                        key={v.number} 
                                                        onMouseUp={() => handleVerseMouseUp(v.number)}
                                                        style={getVerseHighlightStyle(v.number)}
                                                        className="p-1 rounded transition-all duration-300 cursor-text hover:bg-gray-50 leading-relaxed"
                                                        title="Selecione ou clique para marcar/desmarcar"
                                                    >
                                                        <span className="text-yellow-600 font-bold text-xs mr-2 select-none align-top">{v.number}</span>
                                                        {v.text}
                                                    </p>
                                                ))}
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        )}
                        {/* --- TEMAS --- */}
                        {activeTab === 'themes' && (
                            <div className="grid md:grid-cols-2 gap-6 animate-fadeIn">
                                <div className="col-span-full"><BackButton /></div>
                                {/* ATUALIZA√á√ÉO: Chama onSelectVerse com dois par√¢metros */}
                                <ThemeCard title="Financeiro & Prosperidade" iconName="dollar-sign" category="financeiro" color="border-yellow-500" onSelectVerse={(verse, ref) => { setCardVerse(verse); setCardRef(ref); setActiveTab('share'); }} />
                                <ThemeCard title="Cura & Conforto" iconName="activity" category="espiritual" color="border-red-600" onSelectVerse={(verse, ref) => { setCardVerse(verse); setCardRef(ref); setActiveTab('share'); }} />
                                <ThemeCard title="Motiva√ß√£o & F√©" iconName="sun" category="motivacao" color="border-yellow-400" onSelectVerse={(verse, ref) => { setCardVerse(verse); setCardRef(ref); setActiveTab('share'); }} />
                                <ThemeCard title="Fam√≠lia & Lar" iconName="heart" category="familia" color="border-red-400" onSelectVerse={(verse, ref) => { setCardVerse(verse); setCardRef(ref); setActiveTab('share'); }} />
                            </div>
                        )}
                        {/* --- SHARE/CART√ïES (ATUALIZADO) --- */}
                        {activeTab === 'share' && (
                            <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 animate-fadeIn">
                                <BackButton /><h2 className="text-2xl font-bold mb-6 flex items-center gap-2 text-red-800"><IconWrapper name="image" className="text-yellow-500"/> Criador de Cart√µes</h2>
                                <div className="grid md:grid-cols-2 gap-8">
                                    <div className="space-y-4">
                                        
                                        {/* NOVO CAMPO: Vers√≠culo */}
                                        <div>
                                            <label class="block text-sm font-bold text-gray-700 mb-1">Vers√≠culo</label>
                                            <textarea 
                                                value={cardVerse} 
                                                onChange={(e)=>setCardVerse(e.target.value)} 
                                                class="w-full p-3 border rounded h-32 text-gray-800" 
                                                placeholder="Digite a mensagem do vers√≠culo..."
                                            ></textarea>
                                        </div>

                                        {/* NOVO CAMPO: Refer√™ncia */}
                                        <div>
                                            <label class="block text-sm font-bold text-gray-700 mb-1">Refer√™ncia</label>
                                            <input 
                                                type="text" 
                                                value={cardRef} 
                                                onChange={(e)=>setCardRef(e.target.value)} 
                                                class="w-full p-3 border rounded text-gray-800" 
                                                placeholder="Ex: Jo√£o 3:16"
                                            />
                                        </div>

                                        {/* Cor do Texto (MANTIDO) */}
                                        <div class="flex items-center gap-3 mb-2 pt-2 border-t">
                                            <span class="text-sm font-bold text-gray-600">Cor do Texto:</span>
                                            {["#ffffff", "#000000", "#228B22", "#FFD700", "#C0C0C0", "#FF69B4", "#0000FF", "#FF0000", "#9370DB"].map(color => (
                                                <button key={color} onClick={() => setTextColor(color)} class={`w-6 h-6 rounded-full border ${textColor === color ? "ring-2 ring-offset-2 ring-gray-400" : ""}`} style={{backgroundColor: color}} title={color}></button>
                                            ))}
                                        </div>
                                        
                                        {/* Controles de Fundo (Simplificado) */}
                                        <div class="space-y-2 pt-2 border-t">
                                            <label class="block text-sm font-bold text-gray-700">Fundo:</label>
                                            <div class="flex gap-2">
                                                <input type="text" value={imageSearchQuery} onChange={(e)=>setImageSearchQuery(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSearchImage()} placeholder="Buscar fundo (Ex: Cruz)..." class="flex-1 p-2 border rounded text-sm text-gray-800" />
                                                {/* ALTERADO: Bot√£o Buscar para abrir Google */}
                                                <button 
                                                    onClick={handleSearchImage} 
                                                    class="bg-red-700 text-white px-4 py-2 rounded text-sm hover:bg-red-800 transition-colors flex items-center gap-2" 
                                                    title="Abrir pesquisa Google em nova aba"
                                                >
                                                    <IconWrapper name="search" size={16}/> Buscar
                                                </button>
                                            </div>
                                            <div class="flex gap-2">
                                                <input type="text" value={customImageUrl} onChange={(e)=>setCustomImageUrl(e.target.value)} placeholder="Ou cole um link de imagem aqui..." class="flex-1 p-2 border rounded text-sm text-gray-800" />
                                                <button onClick={handleCustomImage} class="bg-yellow-500 text-white px-4 py-2 rounded text-sm hover:bg-yellow-600 transition-colors flex items-center gap-2" title="Usar Link"><IconWrapper name="link" size={16}/> Usar</button>
                                            </div>
                                            <label class="bg-gray-200 text-gray-700 px-4 py-2 rounded cursor-pointer text-sm hover:bg-gray-300 transition-colors w-full text-center flex items-center justify-center gap-2" title="Carregar foto">
                                                <IconWrapper name="image" size={16}/> Carregar Imagem
                                                <input type="file" class="hidden" accept="image/*" onChange={handleFileUpload} />
                                            </label>
                                        </div>

                                        {/* Grid de Sele√ß√£o de Fundo (MANTIDO) */}
                                        <div class="grid grid-cols-4 gap-2 max-h-32 overflow-y-auto pt-2 border-t">{bgList.map(bg => (<div key={bg.id} onClick={()=>setSelectedBg(bg)} class={`h-12 bg-gray-200 cursor-pointer rounded border-2 ${selectedBg.id === bg.id ? 'border-yellow-500' : 'border-transparent'}`} style={{background: bg.type==='gradient'?bg.gradient:`url(${bg.url}) center/cover`}}></div>))}</div>
                                        
                                        {/* Bot√µes de A√ß√£o (AJUSTADO: Baixar e Enviar) */}
                                        <div class="flex gap-4 pt-2">
                                            <button onClick={downloadCard} class="flex-1 bg-red-700 text-white font-bold py-3 rounded hover:bg-red-800 flex justify-center gap-2 transition-colors">
                                                <IconWrapper name="download"/> Baixar
                                            </button>
                                            <button onClick={shareCard} class="flex-1 bg-green-600 text-white font-bold py-3 rounded hover:bg-green-700 flex justify-center gap-2 transition-colors">
                                                <IconWrapper name="share-2"/> Enviar
                                            </button>
                                        </div>
                                        <p class="text-xs text-gray-500 text-center">Para Instagram: Baixe a imagem e poste manualmente.</p>
                                    </div>
                                    
                                    {/* Lado Direito - Preview (AJUSTADO: Dica de arrastar) */}
                                    {/* Usamos max-w-full e max-h-full para manter a propor√ß√£o 600x800 */}
                                    <div class="flex justify-center items-center bg-gray-100 rounded border overflow-hidden relative">
                                        <canvas ref={canvasRef} class="max-w-full h-auto shadow-lg cursor-move" style={{maxHeight:'400px', touchAction: 'none'}} onMouseDown={handleMouseDown} onMouseMove={handleMouseMove} onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp} onTouchStart={handleMouseDown} onTouchMove={handleTouchMove} onTouchEnd={handleMouseUp}></canvas>
                                        <div class="absolute top-2 left-1/2 -translate-x-1/2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded pointer-events-none">Arraste o texto para mover</div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* --- NOMES --- */}
                        {activeTab === 'names' && (
                            <div className="max-w-2xl mx-auto space-y-8 animate-fadeIn">
                                <BackButton /><div className="bg-white p-8 rounded-xl shadow-lg text-center"><h2 className="text-2xl font-bold mb-4 text-red-800">Significado dos Nomes</h2><div className="flex gap-2"><input type="text" value={inputName} onChange={(e)=>setInputName(e.target.value)} className="flex-1 p-3 border rounded text-gray-800" placeholder="Digite o nome..." /><button onClick={analyzeNames} className="bg-red-700 text-white px-6 py-3 rounded font-bold hover:bg-red-800">Ver</button></div></div>
                                {nameResult && <div className="space-y-4">{nameResult.map((item, i) => (<div key={i} className="bg-white p-6 rounded shadow border-l-4 border-yellow-500"><h3 className="font-bold text-gray-800">{item.name}</h3><p className="text-gray-600">{item.meaning}</p></div>))}</div>}
                            </div>
                        )}
                        {/* --- FINANCEIRO (NOVO) --- */}
                        {activeTab === 'finance' && (
                            <div className="max-w-4xl mx-auto animate-fadeIn">
                                <BackButton />
                                
                                <div className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                                    <h2 className="text-2xl font-bold flex items-center gap-2 text-red-800">
                                        <IconWrapper name="dollar-sign" className="text-yellow-500"/> Agenda Financeira
                                    </h2>
                                    <div className="flex gap-2 w-full md:w-auto">
                                        <button 
                                            onClick={exportFinancialData} 
                                            className="flex-1 md:flex-none bg-green-600 text-white px-4 py-2 rounded-lg font-bold flex justify-center items-center gap-2 hover:bg-green-700 shadow-lg transition-all"
                                            title="Baixar arquivo para guardar"
                                        >
                                            <IconWrapper name="download" size={18} /> Baixar Backup
                                        </button>
                                        <label className="flex-1 md:flex-none bg-blue-600 text-white px-4 py-2 rounded-lg font-bold flex justify-center items-center gap-2 hover:bg-blue-700 shadow-lg transition-all cursor-pointer" title="Carregar arquivo salvo">
                                            <input type="file" accept=".json" onChange={importFinancialData} className="hidden" />
                                            <IconWrapper name="refresh-cw" size={18} /> Restaurar
                                        </label>
                                    </div>
                                </div>

                                {/* RESUMO CARDS */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                    <div className="bg-green-100 p-6 rounded-xl border border-green-200 shadow-sm">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-bold text-green-700">ENTRADAS</span>
                                            <IconWrapper name="trending-up" className="text-green-600" size={20}/>
                                        </div>
                                        <div className="text-2xl font-bold text-green-800">
                                            R$ {financialSummary.income.toFixed(2)}
                                        </div>
                                    </div>
                                    <div className="bg-red-100 p-6 rounded-xl border border-red-200 shadow-sm">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-bold text-red-700">SA√çDAS</span>
                                            <IconWrapper name="trending-down" className="text-red-600" size={20}/>
                                        </div>
                                        <div className="text-2xl font-bold text-red-800">
                                            R$ {financialSummary.expense.toFixed(2)}
                                        </div>
                                    </div>
                                    <div className={`bg-white p-6 rounded-xl border-l-4 shadow-sm ${financialSummary.balance >= 0 ? 'border-green-500' : 'border-red-500'}`}>
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-bold text-gray-600">SALDO ATUAL</span>
                                            <IconWrapper name="dollar-sign" className="text-gray-400" size={20}/>
                                        </div>
                                        <div className={`text-2xl font-bold ${financialSummary.balance >= 0 ? 'text-gray-800' : 'text-red-600'}`}>
                                            R$ {financialSummary.balance.toFixed(2)}
                                        </div>
                                    </div>
                                </div>

                                {/* FORMUL√ÅRIO */}
                                <div className="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
                                    <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">Nova Transa√ß√£o</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Data Vencimento</label>
                                            <input type="date" value={finForm.date} onChange={e => setFinForm({...finForm, date: e.target.value})} className="w-full p-2 border rounded bg-gray-50 text-gray-800" />
                                        </div>
                                        <div className="md:col-span-2">
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Descri√ß√£o</label>
                                            <input type="text" placeholder="Ex: D√≠zimo, Mercado..." value={finForm.desc} onChange={e => setFinForm({...finForm, desc: e.target.value})} className="w-full p-2 border rounded bg-gray-50 text-gray-800" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Valor Total (R$)</label>
                                            <input type="number" step="0.01" placeholder="0.00" value={finForm.value} onChange={e => setFinForm({...finForm, value: e.target.value})} className="w-full p-2 border rounded bg-gray-50 text-gray-800" />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Tipo</label>
                                            <div className="flex gap-2">
                                                <button onClick={() => setFinForm({...finForm, type: 'income'})} className={`flex-1 py-2 rounded text-sm font-bold ${finForm.type === 'income' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-600'}`}>Receita</button>
                                                <button onClick={() => setFinForm({...finForm, type: 'expense'})} className={`flex-1 py-2 rounded text-sm font-bold ${finForm.type === 'expense' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-600'}`}>Despesa</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Categoria</label>
                                            <select value={finForm.category} onChange={e => setFinForm({...finForm, category: e.target.value})} className="w-full p-2 border rounded bg-gray-50 text-gray-800">
                                                <option>D√≠zimo</option>
                                                <option>Oferta</option>
                                                <option>Alimenta√ß√£o</option>
                                                <option>Contas (√Ågua/Luz)</option>
                                                <option>Transporte</option>
                                                <option>Sa√∫de</option>
                                                <option>Lazer</option>
                                                <option>Sal√°rio</option>
                                                <option>Outros</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Pagamento</label>
                                            <select value={finForm.method} onChange={e => setFinForm({...finForm, method: e.target.value})} className="w-full p-2 border rounded bg-gray-50 text-gray-800">
                                                <option>Dinheiro</option>
                                                <option>Cart√£o Cr√©dito</option>
                                                <option>Cart√£o D√©bito</option>
                                                <option>Pix</option>
                                                <option>Transfer√™ncia</option>
                                            </select>
                                        </div>
                                        
                                        {/* Campo de Parcelas - S√≥ aparece se for Cart√£o Cr√©dito */}
                                        {finForm.method === 'Cart√£o Cr√©dito' && (
                                            <div>
                                                <label className="block text-xs font-bold text-gray-500 mb-1">Parcelas (x)</label>
                                                <input type="number" min="1" max="48" value={finForm.installments} onChange={e => setFinForm({...finForm, installments: e.target.value})} className="w-full p-2 border rounded bg-gray-50 text-gray-800" />
                                            </div>
                                        )}

                                        <div className={`flex items-end ${finForm.method !== 'Cart√£o Cr√©dito' ? 'md:col-span-1' : ''}`}>
                                            <button onClick={handleAddFinancialEntry} className="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                                                <IconWrapper name="plus" size={18}/> Adicionar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* LISTA DE TRANSA√á√ïES */}
                                <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-gray-50 text-gray-600 font-bold uppercase text-xs">
                                                <tr>
                                                    <th className="p-4">Vencimento</th>
                                                    <th className="p-4">Descri√ß√£o</th>
                                                    <th className="p-4">Categoria</th>
                                                    <th className="p-4">M√©todo</th>
                                                    <th className="p-4 text-right">Valor</th>
                                                    <th className="p-4 text-center">A√ß√£o</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-100">
                                                {financialEntries.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="6" className="p-8 text-center text-gray-400">Nenhuma movimenta√ß√£o registada.</td>
                                                    </tr>
                                                ) : (
                                                    financialEntries.sort((a,b) => new Date(a.date) - new Date(b.date)).map((item) => (
                                                        <tr key={item.id} className="hover:bg-gray-50 transition-colors">
                                                            <td className="p-4 text-gray-600 whitespace-nowrap">
                                                                {new Date(item.date).toLocaleDateString('pt-BR')}
                                                                {new Date(item.date) < new Date() && item.type === 'expense' && <span className="ml-2 text-[10px] text-red-500 bg-red-100 px-1 rounded">Vencido</span>}
                                                            </td>
                                                            <td className="p-4 font-medium text-gray-800">{item.desc}</td>
                                                            <td className="p-4 text-gray-500"><span className="px-2 py-1 bg-gray-100 rounded text-xs">{item.category}</span></td>
                                                            <td className="p-4 text-gray-500 flex items-center gap-1">
                                                                {item.method.includes('Cart√£o') && <IconWrapper name="credit-card" size={14}/>}
                                                                {item.method}
                                                            </td>
                                                            <td className={`p-4 text-right font-bold ${item.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                                                                {item.type === 'income' ? '+' : '-'} R$ {item.value.toFixed(2)}
                                                            </td>
                                                            <td className="p-4 text-center">
                                                                <button onClick={() => removeFinancialEntry(item.id)} className="text-red-400 hover:text-red-600 p-1 rounded hover:bg-red-50 transition-colors" title="Apagar">
                                                                    <IconWrapper name="trash-2" size={16}/>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* --- PREGA√á√ÉO --- */}
                        {activeTab === 'preaching' && (
                            <div className="max-w-2xl mx-auto bg-white rounded-xl shadow p-8 animate-fadeIn text-center">
                                <BackButton /><h2 className="text-2xl font-bold mb-6 flex justify-center gap-2 text-red-800"><IconWrapper name="megaphone" className="text-yellow-500"/> Prega√ß√£o</h2>
                                <button onClick={()=>{setSermon(preachingDatabase[Math.floor(Math.random()*preachingDatabase.length)])}} className="bg-red-700 text-white px-6 py-3 rounded-full font-bold shadow hover:bg-red-800 mb-6 flex items-center justify-center gap-2 mx-auto"><IconWrapper name="refresh-cw"/> Gerar Esbo√ßo</button>
                                {sermon && (<div className="text-left bg-gray-50 p-6 rounded border border-gray-200"><h3 className="text-xl font-bold mb-2 text-red-800">{sermon.ref}</h3><p className="italic text-gray-600 mb-4">"{sermon.text}"</p><p className="whitespace-pre-line text-gray-700">{sermon.explanation}</p></div>)}
                            </div>
                        )}
                        {/* --- JOGOS (QUIZ + MEMORY + FORCA) --- */}
                        {activeTab === 'games' && (
                            <div className="max-w-4xl mx-auto bg-white rounded-xl shadow p-8 animate-fadeIn text-center relative overflow-hidden min-h-[500px]">
                                <BackButton />
                                
                                {/* --- MENU DE JOGOS --- */}
                                {gameMode === 'menu' && (
                                    <div className="animate-fadeIn">
                                        <h2 className="text-2xl font-bold mb-8 text-red-800 flex justify-center items-center gap-2">
                                            <IconWrapper name="gamepad-2" className="text-yellow-500"/> √Årea de Jogos
                                        </h2>
                                        <div className="grid md:grid-cols-2 gap-6">
                                            <div onClick={startQuiz} className="bg-yellow-50 border-2 border-yellow-200 p-8 rounded-xl cursor-pointer hover:shadow-lg hover:scale-105 transition-transform">
                                                <div className="text-4xl mb-4">üìñ</div>
                                                <h3 className="text-xl font-bold text-gray-800 mb-2">Quiz B√≠blico</h3>
                                                <p className="text-gray-600 text-sm">Desafio de 10 minutos. Teste seus conhecimentos!</p>
                                            </div>
                                            <div onClick={startMemoryGame} className="bg-blue-50 border-2 border-blue-200 p-8 rounded-xl cursor-pointer hover:shadow-lg hover:scale-105 transition-transform">
                                                <div className="text-4xl mb-4">üê∂</div>
                                                <h3 className="text-xl font-bold text-gray-800 mb-2">Jogo da Mem√≥ria</h3>
                                                <p className="text-gray-600 text-sm">Encontre os pares dos animais. Com sons!</p>
                                            </div>
                                            {/* NOVO: JOGO DA FORCA */}
                                            <div onClick={startHangmanGame} className="bg-green-50 border-2 border-green-200 p-8 rounded-xl cursor-pointer hover:shadow-lg hover:scale-105 transition-transform md:col-span-2">
                                                <div className="text-4xl mb-4">‚öì</div>
                                                <h3 className="text-xl font-bold text-gray-800 mb-2">Jogo da Forca</h3>
                                                <p className="text-gray-600 text-sm">Adivinhe a palavra antes que o tempo acabe!</p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* --- QUIZ B√çBLICO --- */}
                                {gameMode === 'quiz' && (
                                    <div className="animate-fadeIn">
                                        <div className="flex justify-between items-center mb-6">
                                            <button onClick={() => setGameMode('menu')} className="text-sm font-bold text-gray-500 hover:text-gray-700">‚Üê Voltar</button>
                                            <h2 className="text-xl font-bold text-red-800">Quiz B√≠blico</h2>
                                            <div className="w-20"></div>
                                        </div>

                                        {!quizActive && !showQuizScore && !quizGameOver && (
                                            <div className="space-y-6">
                                                <p className="text-gray-600 mb-4">Responda a 10 perguntas sorteadas aleatoriamente. Cada acerto vale 10 pontos!</p>
                                                <button onClick={startQuiz} className="bg-red-700 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-red-800">INICIAR AGORA</button>
                                            </div>
                                        )}

                                        {quizActive && !showQuizScore && !quizGameOver && currentQuizQuestions.length > 0 && (
                                            <div>
                                                <div className="flex justify-between items-center mb-6 bg-gray-100 p-3 rounded-lg">
                                                    <div className="text-red-800 font-bold flex items-center gap-2"><div className="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>{formatTime(quizTimer)}</div>
                                                    <div className="text-gray-600 font-bold text-sm">Quest√£o {quizIndex + 1}/10</div>
                                                    <div className="text-yellow-600 font-bold">{quizScore} pts</div>
                                                </div>
                                                <h3 className="text-xl font-bold mb-8 text-gray-800 min-h-[60px] flex items-center justify-center">{currentQuizQuestions[quizIndex].question}</h3>
                                                <div className="grid gap-3">
                                                    {currentQuizQuestions[quizIndex].options.map((opt, i) => (
                                                        <button key={i} onClick={() => handleQuizAnswer(i)} className="p-4 border-2 border-gray-200 rounded-xl hover:bg-yellow-50 hover:border-yellow-500 font-medium text-gray-700 transition-all text-left relative group">
                                                            <span className="absolute left-4 font-bold text-gray-300 group-hover:text-yellow-600">{['A','B','C','D'][i]}</span><span className="pl-8">{opt}</span>
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        {showQuizScore && (
                                            <div className="py-8">
                                                <div className="mb-6">{quizScore >= 70 ? <IconWrapper name="check-circle" size={64} className="text-green-500 mx-auto mb-4"/> : <IconWrapper name="activity" size={64} className="text-yellow-500 mx-auto mb-4"/>}<h3 className="text-3xl font-bold text-gray-800 mb-2">{quizScore >= 70 ? "Parab√©ns!" : "Bom esfor√ßo!"}</h3></div>
                                                <div className="text-5xl font-arcade text-red-800 mb-8">{quizScore} <span className="text-lg font-sans text-gray-500">pontos</span></div>
                                                <button onClick={startQuiz} className="bg-yellow-500 text-white px-8 py-3 rounded-full font-bold hover:bg-yellow-600 shadow-lg flex items-center gap-2 mx-auto"><IconWrapper name="refresh-cw" size={20}/> Jogar Novamente</button>
                                            </div>
                                        )}
                                        {quizGameOver && (
                                            <div className="py-8">
                                                <div className="mb-6 text-red-600"><IconWrapper name="x" size={64} className="mx-auto mb-4"/><h3 className="text-3xl font-bold mb-2">Tempo Esgotado!</h3></div>
                                                <button onClick={startQuiz} className="bg-red-700 text-white px-8 py-3 rounded-full font-bold hover:bg-red-800 shadow-lg flex items-center gap-2 mx-auto"><IconWrapper name="refresh-cw" size={20}/> Tentar Novamente</button>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* --- JOGO DA MEM√ìRIA --- */}
                                {gameMode === 'memory' && (
                                    <div className="animate-fadeIn font-inter">
                                        <div className="flex justify-between items-center mb-6">
                                            <button onClick={() => setGameMode('menu')} className="text-sm font-bold text-gray-500 hover:text-gray-700">‚Üê Voltar</button>
                                            <h2 className="text-xl font-bold text-blue-600">Jogo da Mem√≥ria</h2>
                                            <div className="text-sm font-bold text-gray-600">Jogadas: {memoryMoves}</div>
                                        </div>

                                        {!memoryWin ? (
                                            <div className="grid grid-cols-4 gap-4 justify-center max-w-sm mx-auto">
                                                {memoryCards.map((card) => (
                                                    <div key={card.id} className={`memory-card h-20 w-full ${card.isFlipped || card.isMatched ? 'is-flipped' : ''}`} onClick={() => handleMemoryCardClick(card)}>
                                                        <div className="memory-card-inner">
                                                            <div className="memory-card-back flex items-center justify-center text-2xl font-bold">?</div>
                                                            <div className="memory-card-front flex items-center justify-center text-4xl">{card.emoji}</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="py-12">
                                                <h3 className="text-3xl font-bold text-blue-600 mb-4">Voc√™ Venceu!</h3>
                                                <button onClick={startMemoryGame} className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors text-lg">Reiniciar Jogo</button>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* --- JOGO DA FORCA (NOVO) --- */}
                                {gameMode === 'hangman' && (
                                    <div className="animate-fadeIn font-inter w-full max-w-4xl mx-auto">
                                         <div className="flex justify-between items-center mb-6">
                                            <button onClick={() => setGameMode('menu')} className="text-sm font-bold text-gray-500 hover:text-gray-700">‚Üê Voltar</button>
                                            <h2 className="text-xl font-bold text-blue-600">Jogo da Forca</h2>
                                            <div className={`text-xl font-bold ${hangmanTimer <= 10 ? 'text-red-600 animate-pulse' : 'text-blue-600'}`}>{formatTime(hangmanTimer)}</div>
                                        </div>
                                        
                                        {hangmanStatus === 'playing' ? (
                                            <div className="flex flex-col md:flex-row gap-8">
                                                {/* Coluna Esquerda: Forca */}
                                                <div className="flex-1 flex flex-col items-center">
                                                    <svg className="w-64 h-64 mb-4" viewBox="0 0 100 120">
                                                        <line x1="10" y1="115" x2="90" y2="115" stroke="#6B7280" strokeWidth="4" />
                                                        <line x1="30" y1="115" x2="30" y2="10" stroke="#6B7280" strokeWidth="4" />
                                                        <line x1="30" y1="10" x2="70" y2="10" stroke="#6B7280" strokeWidth="4" />
                                                        <line x1="70" y1="10" x2="70" y2="25" stroke="#6B7280" strokeWidth="4" />
                                                        
                                                        {/* Boneco Condicional */}
                                                        <circle cx="70" cy="35" r="10" className="hangman-part" style={{opacity: hangmanWrong.length >= 1 ? 1 : 0}} fill="none" />
                                                        <line x1="70" y1="45" x2="70" y2="75" className="hangman-part" style={{opacity: hangmanWrong.length >= 2 ? 1 : 0}} />
                                                        <line x1="70" y1="55" x2="55" y2="45" className="hangman-part" style={{opacity: hangmanWrong.length >= 3 ? 1 : 0}} />
                                                        <line x1="70" y1="55" x2="85" y2="45" className="hangman-part" style={{opacity: hangmanWrong.length >= 4 ? 1 : 0}} />
                                                        <line x1="70" y1="75" x2="55" y2="95" className="hangman-part" style={{opacity: hangmanWrong.length >= 5 ? 1 : 0}} />
                                                        <line x1="70" y1="75" x2="85" y2="95" className="hangman-part" style={{opacity: hangmanWrong.length >= 6 ? 1 : 0}} />
                                                    </svg>
                                                    <div className="text-red-500 font-bold text-xl mb-4">Erros: {hangmanWrong.length} / 6</div>
                                                    
                                                    {/* Palavra */}
                                                    <div className="flex flex-wrap justify-center gap-2 mb-4">
                                                        {hangmanWord.split('').map((char, idx) => (
                                                            <div key={idx} className={`w-8 h-10 md:w-10 md:h-12 border-b-4 flex items-center justify-center text-2xl font-bold ${hangmanGuessed.includes(char) ? 'border-blue-500 text-blue-600' : 'border-gray-300 text-transparent'}`}>
                                                                {char}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* Coluna Direita: Controles */}
                                                <div className="flex-1">
                                                    {hangmanWrong.length >= 3 && (
                                                        <div className="mb-4 bg-green-100 text-green-700 p-3 rounded-lg font-bold animate-fadeIn">
                                                            Dica: A categoria √© {hangmanCategory}
                                                        </div>
                                                    )}
                                                    <div className="flex flex-wrap justify-center gap-2">
                                                        {'ABCDEFGHIJKLMNOPQRSTUVWXYZ√á'.split('').map(letter => (
                                                            <button 
                                                                key={letter}
                                                                onClick={() => handleHangmanGuess(letter)}
                                                                disabled={hangmanGuessed.includes(letter) || hangmanWrong.includes(letter)}
                                                                className={`w-10 h-10 md:w-12 md:h-12 font-bold rounded-lg text-lg transition-all shadow-md ${
                                                                    hangmanGuessed.includes(letter) || hangmanWrong.includes(letter) 
                                                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed opacity-50' 
                                                                    : 'bg-blue-100 hover:bg-blue-200 text-blue-800 active:scale-95'
                                                                }`}
                                                            >
                                                                {letter}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="py-12 animate-fadeIn bg-white rounded-xl">
                                                <h3 className={`text-4xl font-bold mb-4 ${hangmanStatus === 'won' ? 'text-green-600' : 'text-red-600'}`}>
                                                    {hangmanStatus === 'won' ? 'Voc√™ Venceu!' : 'Fim de Jogo!'}
                                                </h3>
                                                <p className="text-gray-600 mb-2">A palavra era:</p>
                                                <p className="text-4xl font-bold text-blue-600 mb-8 tracking-widest">{hangmanWord}</p>
                                                <button onClick={startHangmanGame} className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-colors text-lg flex items-center gap-2 mx-auto">
                                                    <IconWrapper name="refresh-cw" size={24}/> Jogar Novamente
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                )}

                            </div>
                        )}
                        {/* --- QR CODE --- */}
                        {activeTab === 'qrcode' && (
                            <div className="max-w-4xl mx-auto space-y-8 animate-fadeIn">
                                <BackButton /><h2 className="text-2xl font-bold text-center mb-6 flex justify-center gap-2 text-red-800"><IconWrapper name="search" className="text-yellow-500"/> Gerador de QR Code</h2>
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div className="bg-white p-6 rounded-xl shadow"><h3 className="font-bold mb-4 text-gray-700">Site / Link</h3><input type="text" value={qrUrl} onChange={(e)=>setQrUrl(e.target.value)} placeholder="https://..." className="w-full p-2 border rounded mb-2 text-gray-800" /><button onClick={handleGerarUrl} className="w-full bg-red-700 text-white p-2 rounded hover:bg-red-800">Gerar</button></div>
                                    <div className="bg-white p-6 rounded-xl shadow"><h3 className="font-bold mb-4 text-gray-700">Wi-Fi</h3><input type="text" value={qrWifiSsid} onChange={(e)=>setQrWifiSsid(e.target.value)} placeholder="Nome da Rede" className="w-full p-2 border rounded mb-2 text-gray-800" /><input type="text" value={qrWifiPass} onChange={(e)=>setQrWifiPass(e.target.value)} placeholder="Senha" className="w-full p-2 border rounded mb-2 text-gray-800" /><button onClick={handleGerarWifi} className="w-full bg-red-700 text-white p-2 rounded hover:bg-red-800">Gerar</button></div>
                                    <div className="bg-white p-6 rounded-xl shadow md:col-span-2"><h3 className="font-bold mb-4 text-gray-700">PIX</h3><div className="grid md:grid-cols-2 gap-2"><input type="text" value={qrPixKey} onChange={(e)=>setQrPixKey(e.target.value)} placeholder="Chave Pix" className="w-full p-2 border rounded text-gray-800" /><input type="text" value={qrPixName} onChange={(e)=>setQrPixName(e.target.value)} placeholder="Nome Completo" className="w-full p-2 border rounded text-gray-800" /><input type="text" value={qrPixCity} onChange={(e)=>setQrPixCity(e.target.value)} placeholder="Cidade" className="w-full p-2 border rounded text-gray-800" /><input type="text" value={qrPixAmount} onChange={(e)=>setQrPixAmount(e.target.value)} placeholder="Valor (ex: 10,00)" className="w-full p-2 border rounded text-gray-800" /></div><button onClick={handleGerarPix} className="w-full bg-red-700 text-white p-2 rounded mt-2 hover:bg-red-800">Gerar PIX</button></div>
                                </div>
                                <div className="bg-white p-8 rounded-xl shadow flex flex-col items-center"><div id="qrcode-container" ref={qrCodeRef} className="mb-4"></div><div className="flex gap-2"><button onClick={downloadQRCode} className="bg-gray-200 px-4 py-2 rounded flex items-center gap-2 text-gray-700 hover:bg-gray-300"><IconWrapper name="download" size={16}/> Baixar</button><button onClick={()=>window.print()} className="bg-gray-200 px-4 py-2 rounded flex items-center gap-2 text-gray-700 hover:bg-gray-300"><IconWrapper name="printer" size={16}/> Imprimir</button></div></div>
                            </div>
                        )}
                        {/* --- R√ÅDIO --- */}
                        {activeTab === 'radio' && (
                            <div className="max-w-4xl mx-auto animate-fadeIn">
                                <BackButton /><h2 className="text-2xl font-bold text-center mb-6 flex justify-center gap-2 text-red-800"><IconWrapper name="radio" className="text-yellow-500"/> R√°dio Gospel</h2>
                                
                                {/* PLAYER AO VIVO (NOVO) */}
                                <div className="bg-gradient-to-r from-gray-900 to-gray-800 text-white rounded-xl shadow-xl overflow-hidden mb-8 border border-gray-700">
                                    <div className="p-6 md:p-8 flex flex-col items-center justify-center text-center">
                                        <div className="bg-red-600 text-xs font-bold px-3 py-1 rounded-full mb-4 animate-pulse">AO VIVO</div>
                                        <h3 className="text-2xl md:text-3xl font-bold mb-2">R√°dio Gospel 24h</h3>
                                        <p className="text-gray-400 text-sm mb-8">Louvor e Adora√ß√£o sem parar</p>
                                        
                                        {/* Visualizador de √Åudio Simulado */}
                                        <div className="h-12 flex items-center justify-center gap-1 mb-8">
                                            {isPlayingRadio ? (
                                                <>
                                                    <div className="sound-bar h-8"></div>
                                                    <div className="sound-bar h-12"></div>
                                                    <div className="sound-bar h-6"></div>
                                                    <div className="sound-bar h-10"></div>
                                                    <div className="sound-bar h-4"></div>
                                                </>
                                            ) : (
                                                <div className="h-1 w-32 bg-gray-700 rounded-full"></div>
                                            )}
                                        </div>

                                        <button 
                                            onClick={toggleRadio} 
                                            className={`w-20 h-20 rounded-full flex items-center justify-center transition-all transform hover:scale-110 shadow-lg ${isPlayingRadio ? 'bg-yellow-500 text-gray-900' : 'bg-red-600 text-white'}`}
                                        >
                                            {isPlayingRadio ? 
                                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></svg> 
                                                : 
                                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3" /></svg>
                                            }
                                        </button>
                                        
                                        <div className="mt-8 pt-6 border-t border-gray-700 w-full">
                                            <p className="text-xs text-gray-400 mb-2">Procurando a R√°dio Gospel Campinas?</p>
                                            <a 
                                                href="http://www.radiogospelcampinas.com.br/" 
                                                target="_blank" 
                                                rel="noopener noreferrer"
                                                className="inline-flex items-center gap-2 text-yellow-500 hover:text-yellow-400 font-bold text-sm underline"
                                            >
                                                <IconWrapper name="external-link" size={14}/> Ir para o Site Oficial (Link HTTP)
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* --- DI√ÅRIO --- */}
                        {activeTab === 'notes' && (
                            <div className="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow animate-fadeIn">
                                <BackButton />
                                <h2 className="text-2xl font-bold mb-4 flex items-center gap-2 text-red-800">
                                    <IconWrapper name="calendar" className="text-yellow-500"/> Di√°rio de Ora√ß√£o
                                </h2>
                                
                                <div className="flex items-center justify-between mb-4 bg-gray-50 p-3 rounded-lg border">
                                    <button onClick={() => changeDay(-1)} className="p-2 hover:bg-gray-200 rounded-full transition-colors text-gray-600">
                                        <IconWrapper name="chevron-left" />
                                    </button>
                                    
                                    <div className="text-center">
                                        <h3 className="font-bold text-lg text-gray-800 capitalize">{formatDateDisplay(currentDate)}</h3>
                                        {formatDateKey(currentDate) !== formatDateKey(new Date()) && (
                                            <button onClick={goToToday} className="text-xs text-red-600 font-bold hover:underline">
                                                Voltar para Hoje
                                            </button>
                                        )}
                                    </div>
                                    
                                    <button onClick={() => changeDay(1)} className="p-2 hover:bg-gray-200 rounded-full transition-colors text-gray-600">
                                        <IconWrapper name="chevron-right" />
                                    </button>
                                </div>

                                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                                    <p className="text-sm text-yellow-800">Escreva aqui as suas ora√ß√µes para este dia. Tudo √© salvo automaticamente.</p>
                                </div>
                                
                                <textarea 
                                    value={getCurrentEntry()} 
                                    onChange={handleDiaryChange} 
                                    className="w-full h-80 p-6 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none resize-none font-handwriting text-lg bg-gray-50 text-gray-800 leading-relaxed" 
                                    placeholder={`Querido Deus, neste dia ${currentDate.getDate()} eu quero...`}
                                ></textarea>
                                
                                <div className="mt-4 flex justify-between items-center">
                                    <span className="text-xs text-gray-400">Salvo automaticamente no navegador</span>
                                    <button onClick={saveNote} className="bg-red-700 text-white px-6 py-2 rounded font-bold hover:bg-red-800 flex items-center gap-2">
                                        <IconWrapper name="edit-3" size={16}/> Salvar Manualmente
                                    </button>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* --- RODAP√â / FOOTER --- */}
                    <footer className="bg-gray-900 text-gray-300 py-8 mt-auto no-print border-t border-gray-800">
                        <div className="container mx-auto px-4 text-center">
                            <p className="font-bold text-lg text-white mb-2">Direitos Autorais &copy; J√¢nio Carlos P J</p>
                            <p className="text-sm mb-4 text-gray-400">Sugest√£o e atualiza√ß√£o: 28/11/2025</p>
                            <a 
                                href="https://wa.me/5575998312170" 
                                target="_blank" 
                                rel="noopener noreferrer" 
                                className="inline-flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded-full hover:bg-green-700 transition-colors font-bold text-sm shadow-lg"
                            >
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                                WhatsApp: +55 (75) 99831-2170
                            </a>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><EvangelicalSystem /></ErrorBoundary>);
    </script>
</body>
</html>
